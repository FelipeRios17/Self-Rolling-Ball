<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.7"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Self Rolling Ball: Inc/Inertial_Control.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="Logo_2_150x149.png"/></td>
  <td id="projectalign">
   <div id="projectname">Self Rolling Ball<span id="projectnumber">&#160;Final</span>
   </div>
   <div id="projectbrief">Design and build of a structure, PCB, and software interface to create a robot which can be commanded direction and magnitude to roll at.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.7 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('_inertial___control_8h.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">Inertial_Control.h File Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;stdint.h&gt;</code><br />
<code>#include &quot;stm32f4xx.h&quot;</code><br />
<code>#include &quot;<a class="el" href="_motor___driver_8h_source.html">Motor_Driver.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_encoder_8h_source.html">Encoder.h</a>&quot;</code><br />
</div>
<p><a href="_inertial___control_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a04e09f38f531369c3fedf29af893cdc6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_inertial___control_8h.html#a04e09f38f531369c3fedf29af893cdc6">slow_start</a> (<a class="el" href="_encoder_8h.html#a3ebec30275bae864f195e84302a89dcb">enc_struct_t</a> <a class="el" href="structenc__struct.html">enc_struct</a>, <a class="el" href="_motor___driver_8h.html#ab4218a9ab8a5044265db55e3a5968d18">mot_struct_t</a> <a class="el" href="structmot__struct.html">mot_struct</a>, uint8_t direction)</td></tr>
<tr class="memdesc:a04e09f38f531369c3fedf29af893cdc6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Inertial Motor Control Header File for Function Prototypes.  <br /></td></tr>
<tr class="separator:a04e09f38f531369c3fedf29af893cdc6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aea874c4e1795b85f6cf6b0da53be4ef1"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_inertial___control_8h.html#aea874c4e1795b85f6cf6b0da53be4ef1">fast_break</a> (<a class="el" href="_encoder_8h.html#a3ebec30275bae864f195e84302a89dcb">enc_struct_t</a> <a class="el" href="structenc__struct.html">enc_struct</a>, <a class="el" href="_motor___driver_8h.html#ab4218a9ab8a5044265db55e3a5968d18">mot_struct_t</a> <a class="el" href="structmot__struct.html">mot_struct</a>)</td></tr>
<tr class="memdesc:aea874c4e1795b85f6cf6b0da53be4ef1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Brake the Inertial Wheel.  <br /></td></tr>
<tr class="separator:aea874c4e1795b85f6cf6b0da53be4ef1"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="aea874c4e1795b85f6cf6b0da53be4ef1" name="aea874c4e1795b85f6cf6b0da53be4ef1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aea874c4e1795b85f6cf6b0da53be4ef1">&#9670;&#160;</a></span>fast_break()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t fast_break </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_encoder_8h.html#a3ebec30275bae864f195e84302a89dcb">enc_struct_t</a>&#160;</td>
          <td class="paramname"><em>enc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="_motor___driver_8h.html#ab4218a9ab8a5044265db55e3a5968d18">mot_struct_t</a>&#160;</td>
          <td class="paramname"><em>mot</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Brake the Inertial Wheel. </p>
<p>This function reverses the current duty cycle by setting new duty cycle to maximum but opposite. It continues at this duty until the velocity of the wheel changes sign at which time the duty will be set to zero. Also has a cnt function to set duty to zero if remote ever becomes unresponsive during operation. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">enc</td><td>This is the encoder declaration in <a class="el" href="_encoder_8h.html">Encoder.h</a>. </td></tr>
    <tr><td class="paramname">mot</td><td>This is the motor declaration in <a class="el" href="_motor___driver_8h.html">Motor_Driver.h</a>. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>This is not run on a timer, but rather uses HAL_GetTick() to find run its control. </dd></dl>

<p class="definition">Definition at line <a class="el" href="_inertial___control_8cpp_source.html#l00117">117</a> of file <a class="el" href="_inertial___control_8cpp_source.html">Inertial_Control.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  118</span>{</div>
<div class="line"><span class="lineno">  119</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="_inertial___control_8cpp.html#af94e9b15df6dcb73388729ba9d072474">sign_flag</a> == 1) <span class="comment">// Negative duty</span></div>
<div class="line"><span class="lineno">  120</span>    {</div>
<div class="line"><span class="lineno">  121</span>        <a class="code hl_variable" href="_inertial___control_8cpp.html#a007758b592b6a902b598f3a1a56e8b34">curr_tick</a> = HAL_GetTick();</div>
<div class="line"><span class="lineno">  122</span>        <a class="code hl_variable" href="_inertial___control_8cpp.html#a99b7a4242bf291fbf63e417a7e81af7f">curr_pos</a> = <a class="code hl_function" href="_encoder_8h.html#abd2fb1adb01681818acafd7b0923d0d1">position</a>(enc);</div>
<div class="line"><span class="lineno">  123</span>        <a class="code hl_variable" href="_inertial___control_8cpp.html#a42cb2726b7b8fc175a3b4cc9d4cbf807">act_vel</a> = (<a class="code hl_variable" href="_inertial___control_8cpp.html#a99b7a4242bf291fbf63e417a7e81af7f">curr_pos</a> - <a class="code hl_variable" href="_inertial___control_8cpp.html#ae337975c15dcb3d1b4df2a0049b281c2">prev_pos</a>)*1000/(<a class="code hl_variable" href="_inertial___control_8cpp.html#a007758b592b6a902b598f3a1a56e8b34">curr_tick</a> - <a class="code hl_variable" href="_inertial___control_8cpp.html#a67df3f0b197403e1cf8f865c4b40b3fc">prev_tick</a>);</div>
<div class="line"><span class="lineno">  124</span> </div>
<div class="line"><span class="lineno">  125</span>        mot.<a class="code hl_variable" href="structmot__struct.html#a6d5d2b3c382b6f76003fbd21dcd0f3a9">duty</a> = 100;</div>
<div class="line"><span class="lineno">  126</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="_inertial___control_8cpp.html#a42cb2726b7b8fc175a3b4cc9d4cbf807">act_vel</a> &gt;= 0)</div>
<div class="line"><span class="lineno">  127</span>        {</div>
<div class="line"><span class="lineno">  128</span>            mot.<a class="code hl_variable" href="structmot__struct.html#a6d5d2b3c382b6f76003fbd21dcd0f3a9">duty</a> = 0;</div>
<div class="line"><span class="lineno">  129</span>            <a class="code hl_variable" href="_inertial___control_8cpp.html#a514d060291cffde52e284baacd9d8b98">first_time</a> = 1;</div>
<div class="line"><span class="lineno">  130</span>            <a class="code hl_variable" href="_inertial___control_8cpp.html#af94e9b15df6dcb73388729ba9d072474">sign_flag</a> = 0;</div>
<div class="line"><span class="lineno">  131</span>            <a class="code hl_variable" href="_inertial___control_8cpp.html#ac6ea77dfb0623a64b3904fb0848bed6a">turn_flag</a> = 0;</div>
<div class="line"><span class="lineno">  132</span>        }</div>
<div class="line"><span class="lineno">  133</span>        <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  134</span>        {</div>
<div class="line"><span class="lineno">  135</span>            <a class="code hl_variable" href="_inertial___control_8cpp.html#a67df3f0b197403e1cf8f865c4b40b3fc">prev_tick</a> = <a class="code hl_variable" href="_inertial___control_8cpp.html#a007758b592b6a902b598f3a1a56e8b34">curr_tick</a>;</div>
<div class="line"><span class="lineno">  136</span>            <a class="code hl_variable" href="_inertial___control_8cpp.html#ae337975c15dcb3d1b4df2a0049b281c2">prev_pos</a> = <a class="code hl_variable" href="_inertial___control_8cpp.html#a99b7a4242bf291fbf63e417a7e81af7f">curr_pos</a>;</div>
<div class="line"><span class="lineno">  137</span>            <a class="code hl_variable" href="_inertial___control_8cpp.html#a884497f3269a8ae82bcd0a4814997702">cnt</a>++;</div>
<div class="line"><span class="lineno">  138</span>        }</div>
<div class="line"><span class="lineno">  139</span>        <a class="code hl_function" href="_motor___driver_8h.html#a297c32137676ce38a4cf1e4c6ab18234">set_duty</a>(mot);</div>
<div class="line"><span class="lineno">  140</span>    }</div>
<div class="line"><span class="lineno">  141</span>    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  142</span>    {</div>
<div class="line"><span class="lineno">  143</span>        <a class="code hl_variable" href="_inertial___control_8cpp.html#a007758b592b6a902b598f3a1a56e8b34">curr_tick</a> = HAL_GetTick();</div>
<div class="line"><span class="lineno">  144</span>        <a class="code hl_variable" href="_inertial___control_8cpp.html#a99b7a4242bf291fbf63e417a7e81af7f">curr_pos</a> = <a class="code hl_function" href="_encoder_8h.html#abd2fb1adb01681818acafd7b0923d0d1">position</a>(enc);</div>
<div class="line"><span class="lineno">  145</span>        <a class="code hl_variable" href="_inertial___control_8cpp.html#a42cb2726b7b8fc175a3b4cc9d4cbf807">act_vel</a> = (<a class="code hl_variable" href="_inertial___control_8cpp.html#a99b7a4242bf291fbf63e417a7e81af7f">curr_pos</a> - <a class="code hl_variable" href="_inertial___control_8cpp.html#ae337975c15dcb3d1b4df2a0049b281c2">prev_pos</a>)*1000/(<a class="code hl_variable" href="_inertial___control_8cpp.html#a007758b592b6a902b598f3a1a56e8b34">curr_tick</a> - <a class="code hl_variable" href="_inertial___control_8cpp.html#a67df3f0b197403e1cf8f865c4b40b3fc">prev_tick</a>);</div>
<div class="line"><span class="lineno">  146</span> </div>
<div class="line"><span class="lineno">  147</span>        mot.<a class="code hl_variable" href="structmot__struct.html#a6d5d2b3c382b6f76003fbd21dcd0f3a9">duty</a> = -100;</div>
<div class="line"><span class="lineno">  148</span> </div>
<div class="line"><span class="lineno">  149</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="_inertial___control_8cpp.html#a42cb2726b7b8fc175a3b4cc9d4cbf807">act_vel</a> &lt;= 0)</div>
<div class="line"><span class="lineno">  150</span>        {</div>
<div class="line"><span class="lineno">  151</span>            mot.<a class="code hl_variable" href="structmot__struct.html#a6d5d2b3c382b6f76003fbd21dcd0f3a9">duty</a> = 0;</div>
<div class="line"><span class="lineno">  152</span>            <a class="code hl_variable" href="_inertial___control_8cpp.html#a514d060291cffde52e284baacd9d8b98">first_time</a> = 1;</div>
<div class="line"><span class="lineno">  153</span>            <a class="code hl_variable" href="_inertial___control_8cpp.html#af94e9b15df6dcb73388729ba9d072474">sign_flag</a> = 0;</div>
<div class="line"><span class="lineno">  154</span>            <a class="code hl_variable" href="_inertial___control_8cpp.html#ac6ea77dfb0623a64b3904fb0848bed6a">turn_flag</a> = 0;</div>
<div class="line"><span class="lineno">  155</span>            <a class="code hl_variable" href="_inertial___control_8cpp.html#a42cb2726b7b8fc175a3b4cc9d4cbf807">act_vel</a> = 0;</div>
<div class="line"><span class="lineno">  156</span>        }</div>
<div class="line"><span class="lineno">  157</span>        <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  158</span>        {</div>
<div class="line"><span class="lineno">  159</span>            <a class="code hl_variable" href="_inertial___control_8cpp.html#a67df3f0b197403e1cf8f865c4b40b3fc">prev_tick</a> = <a class="code hl_variable" href="_inertial___control_8cpp.html#a007758b592b6a902b598f3a1a56e8b34">curr_tick</a>;</div>
<div class="line"><span class="lineno">  160</span>            <a class="code hl_variable" href="_inertial___control_8cpp.html#ae337975c15dcb3d1b4df2a0049b281c2">prev_pos</a> = <a class="code hl_variable" href="_inertial___control_8cpp.html#a99b7a4242bf291fbf63e417a7e81af7f">curr_pos</a>;</div>
<div class="line"><span class="lineno">  161</span>            <a class="code hl_variable" href="_inertial___control_8cpp.html#a884497f3269a8ae82bcd0a4814997702">cnt</a>++;</div>
<div class="line"><span class="lineno">  162</span>        }</div>
<div class="line"><span class="lineno">  163</span>        <a class="code hl_function" href="_motor___driver_8h.html#a297c32137676ce38a4cf1e4c6ab18234">set_duty</a>(mot);</div>
<div class="line"><span class="lineno">  164</span>    }</div>
<div class="line"><span class="lineno">  165</span> </div>
<div class="line"><span class="lineno">  166</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="_inertial___control_8cpp.html#a884497f3269a8ae82bcd0a4814997702">cnt</a> &gt;= 15)</div>
<div class="line"><span class="lineno">  167</span>    {</div>
<div class="line"><span class="lineno">  168</span>        HAL_GPIO_WritePin(GPIOC, <a class="code hl_define" href="main_8h.html#af4bcaf9b7b85b14fe36c054d7da44f3c">led_Pin</a>, GPIO_PIN_RESET);</div>
<div class="line"><span class="lineno">  169</span>        mot.<a class="code hl_variable" href="structmot__struct.html#a6d5d2b3c382b6f76003fbd21dcd0f3a9">duty</a> = 0;</div>
<div class="line"><span class="lineno">  170</span>        <a class="code hl_function" href="_motor___driver_8h.html#a297c32137676ce38a4cf1e4c6ab18234">set_duty</a>(mot);</div>
<div class="line"><span class="lineno">  171</span>        <a class="code hl_variable" href="_inertial___control_8cpp.html#a514d060291cffde52e284baacd9d8b98">first_time</a> = 1;</div>
<div class="line"><span class="lineno">  172</span>        <a class="code hl_variable" href="_inertial___control_8cpp.html#af94e9b15df6dcb73388729ba9d072474">sign_flag</a> = 0;</div>
<div class="line"><span class="lineno">  173</span>        <a class="code hl_variable" href="_inertial___control_8cpp.html#ac6ea77dfb0623a64b3904fb0848bed6a">turn_flag</a> = 0;</div>
<div class="line"><span class="lineno">  174</span>        <a class="code hl_variable" href="_inertial___control_8cpp.html#a884497f3269a8ae82bcd0a4814997702">cnt</a>  = 0;</div>
<div class="line"><span class="lineno">  175</span>    }</div>
<div class="line"><span class="lineno">  176</span> </div>
<div class="line"><span class="lineno">  177</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="_inertial___control_8cpp.html#ac6ea77dfb0623a64b3904fb0848bed6a">turn_flag</a>;</div>
<div class="line"><span class="lineno">  178</span>}</div>
<div class="ttc" id="a_encoder_8h_html_abd2fb1adb01681818acafd7b0923d0d1"><div class="ttname"><a href="_encoder_8h.html#abd2fb1adb01681818acafd7b0923d0d1">position</a></div><div class="ttdeci">int32_t position(enc_struct_t enc_struct)</div><div class="ttdoc">Read the Encoder.</div><div class="ttdef"><b>Definition</b> <a href="_encoder_8cpp_source.html#l00043">Encoder.cpp:43</a></div></div>
<div class="ttc" id="a_inertial___control_8cpp_html_a007758b592b6a902b598f3a1a56e8b34"><div class="ttname"><a href="_inertial___control_8cpp.html#a007758b592b6a902b598f3a1a56e8b34">curr_tick</a></div><div class="ttdeci">int32_t curr_tick</div><div class="ttdef"><b>Definition</b> <a href="_inertial___control_8cpp_source.html#l00029">Inertial_Control.cpp:29</a></div></div>
<div class="ttc" id="a_inertial___control_8cpp_html_a42cb2726b7b8fc175a3b4cc9d4cbf807"><div class="ttname"><a href="_inertial___control_8cpp.html#a42cb2726b7b8fc175a3b4cc9d4cbf807">act_vel</a></div><div class="ttdeci">int32_t act_vel</div><div class="ttdef"><b>Definition</b> <a href="_inertial___control_8cpp_source.html#l00038">Inertial_Control.cpp:38</a></div></div>
<div class="ttc" id="a_inertial___control_8cpp_html_a514d060291cffde52e284baacd9d8b98"><div class="ttname"><a href="_inertial___control_8cpp.html#a514d060291cffde52e284baacd9d8b98">first_time</a></div><div class="ttdeci">uint32_t first_time</div><div class="ttdef"><b>Definition</b> <a href="_inertial___control_8cpp_source.html#l00032">Inertial_Control.cpp:32</a></div></div>
<div class="ttc" id="a_inertial___control_8cpp_html_a67df3f0b197403e1cf8f865c4b40b3fc"><div class="ttname"><a href="_inertial___control_8cpp.html#a67df3f0b197403e1cf8f865c4b40b3fc">prev_tick</a></div><div class="ttdeci">int32_t prev_tick</div><div class="ttdoc">Inertial wheel driver class with all required functions.</div><div class="ttdef"><b>Definition</b> <a href="_inertial___control_8cpp_source.html#l00028">Inertial_Control.cpp:28</a></div></div>
<div class="ttc" id="a_inertial___control_8cpp_html_a884497f3269a8ae82bcd0a4814997702"><div class="ttname"><a href="_inertial___control_8cpp.html#a884497f3269a8ae82bcd0a4814997702">cnt</a></div><div class="ttdeci">uint32_t cnt</div><div class="ttdef"><b>Definition</b> <a href="_inertial___control_8cpp_source.html#l00043">Inertial_Control.cpp:43</a></div></div>
<div class="ttc" id="a_inertial___control_8cpp_html_a99b7a4242bf291fbf63e417a7e81af7f"><div class="ttname"><a href="_inertial___control_8cpp.html#a99b7a4242bf291fbf63e417a7e81af7f">curr_pos</a></div><div class="ttdeci">int32_t curr_pos</div><div class="ttdef"><b>Definition</b> <a href="_inertial___control_8cpp_source.html#l00031">Inertial_Control.cpp:31</a></div></div>
<div class="ttc" id="a_inertial___control_8cpp_html_ac6ea77dfb0623a64b3904fb0848bed6a"><div class="ttname"><a href="_inertial___control_8cpp.html#ac6ea77dfb0623a64b3904fb0848bed6a">turn_flag</a></div><div class="ttdeci">uint32_t turn_flag</div><div class="ttdef"><b>Definition</b> <a href="_inertial___control_8cpp_source.html#l00036">Inertial_Control.cpp:36</a></div></div>
<div class="ttc" id="a_inertial___control_8cpp_html_ae337975c15dcb3d1b4df2a0049b281c2"><div class="ttname"><a href="_inertial___control_8cpp.html#ae337975c15dcb3d1b4df2a0049b281c2">prev_pos</a></div><div class="ttdeci">int32_t prev_pos</div><div class="ttdef"><b>Definition</b> <a href="_inertial___control_8cpp_source.html#l00030">Inertial_Control.cpp:30</a></div></div>
<div class="ttc" id="a_inertial___control_8cpp_html_af94e9b15df6dcb73388729ba9d072474"><div class="ttname"><a href="_inertial___control_8cpp.html#af94e9b15df6dcb73388729ba9d072474">sign_flag</a></div><div class="ttdeci">uint32_t sign_flag</div><div class="ttdef"><b>Definition</b> <a href="_inertial___control_8cpp_source.html#l00035">Inertial_Control.cpp:35</a></div></div>
<div class="ttc" id="a_motor___driver_8h_html_a297c32137676ce38a4cf1e4c6ab18234"><div class="ttname"><a href="_motor___driver_8h.html#a297c32137676ce38a4cf1e4c6ab18234">set_duty</a></div><div class="ttdeci">void set_duty(mot_struct_t mot_objs)</div><div class="ttdoc">Set Motor Duty Cycle.</div><div class="ttdef"><b>Definition</b> <a href="_motor___driver_8c_source.html#l00042">Motor_Driver.c:42</a></div></div>
<div class="ttc" id="amain_8h_html_af4bcaf9b7b85b14fe36c054d7da44f3c"><div class="ttname"><a href="main_8h.html#af4bcaf9b7b85b14fe36c054d7da44f3c">led_Pin</a></div><div class="ttdeci">#define led_Pin</div><div class="ttdef"><b>Definition</b> <a href="main_8h_source.html#l00062">main.h:62</a></div></div>
<div class="ttc" id="astructmot__struct_html_a6d5d2b3c382b6f76003fbd21dcd0f3a9"><div class="ttname"><a href="structmot__struct.html#a6d5d2b3c382b6f76003fbd21dcd0f3a9">mot_struct::duty</a></div><div class="ttdeci">int32_t duty</div><div class="ttdef"><b>Definition</b> <a href="_motor___driver_8h_source.html#l00023">Motor_Driver.h:23</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a04e09f38f531369c3fedf29af893cdc6" name="a04e09f38f531369c3fedf29af893cdc6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a04e09f38f531369c3fedf29af893cdc6">&#9670;&#160;</a></span>slow_start()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void slow_start </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_encoder_8h.html#a3ebec30275bae864f195e84302a89dcb">enc_struct_t</a>&#160;</td>
          <td class="paramname"><em>enc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="_motor___driver_8h.html#ab4218a9ab8a5044265db55e3a5968d18">mot_struct_t</a>&#160;</td>
          <td class="paramname"><em>mot</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>direction</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Inertial Motor Control Header File for Function Prototypes. </p>
<p>Inertial Motor Control Header File for Function Prototypes.</p>
<p>This function starts up the inertial wheel at a slow rate so as to avoid introducing too much angular momentum at system startup. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">enc</td><td>This is the encoder declaration in <a class="el" href="_encoder_8h.html">Encoder.h</a>. </td></tr>
    <tr><td class="paramname">mot</td><td>This is the motor declaration in <a class="el" href="_motor___driver_8h.html">Motor_Driver.h</a>. </td></tr>
    <tr><td class="paramname">direction</td><td>This is the flag that is sent from the remote letting the robot know which direction to spin the wheel. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>This is not run on a timer, but rather uses HAL_GetTick() to find run its control. </dd></dl>
<dl class="section attention"><dt>Attention</dt><dd>This code was still in development at time of project completion. When run, the robot would start spinning in the direction of startup, then begin spinning in reverse at break which ultimately led to the bot returning to its original position. This still needs tuning. </dd></dl>

<p class="definition">Definition at line <a class="el" href="_inertial___control_8cpp_source.html#l00062">62</a> of file <a class="el" href="_inertial___control_8cpp_source.html">Inertial_Control.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   63</span>{</div>
<div class="line"><span class="lineno">   64</span>    <span class="comment">// 2400 ticks/s is 100% duty</span></div>
<div class="line"><span class="lineno">   65</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="_inertial___control_8cpp.html#a514d060291cffde52e284baacd9d8b98">first_time</a> == 1)</div>
<div class="line"><span class="lineno">   66</span>    {</div>
<div class="line"><span class="lineno">   67</span>        <a class="code hl_function" href="_encoder_8h.html#ab0f543e038e32f7ed468532b5b77caa7">zero</a>(enc);</div>
<div class="line"><span class="lineno">   68</span>        <a class="code hl_variable" href="_inertial___control_8cpp.html#ae337975c15dcb3d1b4df2a0049b281c2">prev_pos</a> = 0;</div>
<div class="line"><span class="lineno">   69</span>        <a class="code hl_variable" href="_inertial___control_8cpp.html#a514d060291cffde52e284baacd9d8b98">first_time</a> = 0;</div>
<div class="line"><span class="lineno">   70</span>        <a class="code hl_variable" href="_inertial___control_8cpp.html#ac6ea77dfb0623a64b3904fb0848bed6a">turn_flag</a> = 1;</div>
<div class="line"><span class="lineno">   71</span>        <a class="code hl_variable" href="_inertial___control_8cpp.html#acc060445a2d7f1874f41dd76face8487">first_tick</a> = HAL_GetTick();</div>
<div class="line"><span class="lineno">   72</span>        <a class="code hl_variable" href="_inertial___control_8cpp.html#a67df3f0b197403e1cf8f865c4b40b3fc">prev_tick</a> = <a class="code hl_variable" href="_inertial___control_8cpp.html#acc060445a2d7f1874f41dd76face8487">first_tick</a>;</div>
<div class="line"><span class="lineno">   73</span>    }</div>
<div class="line"><span class="lineno">   74</span>    <a class="code hl_variable" href="_inertial___control_8cpp.html#a007758b592b6a902b598f3a1a56e8b34">curr_tick</a> = HAL_GetTick();</div>
<div class="line"><span class="lineno">   75</span>    <a class="code hl_variable" href="_inertial___control_8cpp.html#a99b7a4242bf291fbf63e417a7e81af7f">curr_pos</a> = <a class="code hl_function" href="_encoder_8h.html#abd2fb1adb01681818acafd7b0923d0d1">position</a>(enc);</div>
<div class="line"><span class="lineno">   76</span>    <a class="code hl_variable" href="_inertial___control_8cpp.html#a42cb2726b7b8fc175a3b4cc9d4cbf807">act_vel</a> = (<a class="code hl_variable" href="_inertial___control_8cpp.html#a99b7a4242bf291fbf63e417a7e81af7f">curr_pos</a> - <a class="code hl_variable" href="_inertial___control_8cpp.html#ae337975c15dcb3d1b4df2a0049b281c2">prev_pos</a>)*1000/(<a class="code hl_variable" href="_inertial___control_8cpp.html#a007758b592b6a902b598f3a1a56e8b34">curr_tick</a> - <a class="code hl_variable" href="_inertial___control_8cpp.html#a67df3f0b197403e1cf8f865c4b40b3fc">prev_tick</a>);</div>
<div class="line"><span class="lineno">   77</span>    <span class="comment">// Target velocity if based on 1-exp(-0.5t) curve</span></div>
<div class="line"><span class="lineno">   78</span>    <a class="code hl_variable" href="_inertial___control_8cpp.html#a7360c90b45e89aa08e2fe0fe76be6e00">tar_vel</a> = (1 - exp((<span class="keywordtype">double</span>)(-0.5*(<a class="code hl_variable" href="_inertial___control_8cpp.html#a007758b592b6a902b598f3a1a56e8b34">curr_tick</a> - <a class="code hl_variable" href="_inertial___control_8cpp.html#acc060445a2d7f1874f41dd76face8487">first_tick</a>)))) * 2400;</div>
<div class="line"><span class="lineno">   79</span>    <a class="code hl_variable" href="_inertial___control_8cpp.html#ac49b413febda9f85b78e5e87e98efcd2">err_vel</a> = <a class="code hl_variable" href="_inertial___control_8cpp.html#a7360c90b45e89aa08e2fe0fe76be6e00">tar_vel</a> - <a class="code hl_variable" href="_inertial___control_8cpp.html#a42cb2726b7b8fc175a3b4cc9d4cbf807">act_vel</a>;</div>
<div class="line"><span class="lineno">   80</span> </div>
<div class="line"><span class="lineno">   81</span>    <a class="code hl_variable" href="_inertial___control_8cpp.html#ab6a8993805fd7b50a32669337ca3a37a">duty</a> = (<a class="code hl_variable" href="_inertial___control_8cpp.html#ac49b413febda9f85b78e5e87e98efcd2">err_vel</a> * 1) / 24; <span class="comment">// Kp = 1</span></div>
<div class="line"><span class="lineno">   82</span> </div>
<div class="line"><span class="lineno">   83</span>    <span class="keywordflow">if</span> (direction == 2)</div>
<div class="line"><span class="lineno">   84</span>    {</div>
<div class="line"><span class="lineno">   85</span>        mot.<a class="code hl_variable" href="structmot__struct.html#a6d5d2b3c382b6f76003fbd21dcd0f3a9">duty</a> = <a class="code hl_variable" href="_inertial___control_8cpp.html#ab6a8993805fd7b50a32669337ca3a37a">duty</a>;</div>
<div class="line"><span class="lineno">   86</span>    }</div>
<div class="line"><span class="lineno">   87</span>    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">   88</span>    {</div>
<div class="line"><span class="lineno">   89</span>        mot.<a class="code hl_variable" href="structmot__struct.html#a6d5d2b3c382b6f76003fbd21dcd0f3a9">duty</a> = -<a class="code hl_variable" href="_inertial___control_8cpp.html#ab6a8993805fd7b50a32669337ca3a37a">duty</a>;</div>
<div class="line"><span class="lineno">   90</span>    }</div>
<div class="line"><span class="lineno">   91</span> </div>
<div class="line"><span class="lineno">   92</span>    <a class="code hl_function" href="_motor___driver_8h.html#a297c32137676ce38a4cf1e4c6ab18234">set_duty</a>(mot);</div>
<div class="line"><span class="lineno">   93</span>    sprintf((<span class="keywordtype">char</span>*)<a class="code hl_variable" href="_inertial___control_8cpp.html#a22d79f0ec1c73ae2e5b03c9f61abc36b">uart_msgs</a>,<span class="stringliteral">&quot;direction: %d\r\n\n&quot;</span>, direction);</div>
<div class="line"><span class="lineno">   94</span>    CDC_Transmit_FS((uint8_t*)<a class="code hl_variable" href="_inertial___control_8cpp.html#a22d79f0ec1c73ae2e5b03c9f61abc36b">uart_msgs</a>, strlen((<span class="keywordtype">char</span>*)<a class="code hl_variable" href="_inertial___control_8cpp.html#a22d79f0ec1c73ae2e5b03c9f61abc36b">uart_msgs</a>));</div>
<div class="line"><span class="lineno">   95</span> </div>
<div class="line"><span class="lineno">   96</span>    <a class="code hl_variable" href="_inertial___control_8cpp.html#a67df3f0b197403e1cf8f865c4b40b3fc">prev_tick</a> = <a class="code hl_variable" href="_inertial___control_8cpp.html#a007758b592b6a902b598f3a1a56e8b34">curr_tick</a>;</div>
<div class="line"><span class="lineno">   97</span>    <a class="code hl_variable" href="_inertial___control_8cpp.html#ae337975c15dcb3d1b4df2a0049b281c2">prev_pos</a> = <a class="code hl_variable" href="_inertial___control_8cpp.html#a99b7a4242bf291fbf63e417a7e81af7f">curr_pos</a>;</div>
<div class="line"><span class="lineno">   98</span> </div>
<div class="line"><span class="lineno">   99</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="_inertial___control_8cpp.html#ab6a8993805fd7b50a32669337ca3a37a">duty</a> &lt; 0)</div>
<div class="line"><span class="lineno">  100</span>    {</div>
<div class="line"><span class="lineno">  101</span>        <a class="code hl_variable" href="_inertial___control_8cpp.html#af94e9b15df6dcb73388729ba9d072474">sign_flag</a> = 1; <span class="comment">// Negative</span></div>
<div class="line"><span class="lineno">  102</span>    }</div>
<div class="line"><span class="lineno">  103</span> </div>
<div class="line"><span class="lineno">  104</span>}</div>
<div class="ttc" id="a_encoder_8h_html_ab0f543e038e32f7ed468532b5b77caa7"><div class="ttname"><a href="_encoder_8h.html#ab0f543e038e32f7ed468532b5b77caa7">zero</a></div><div class="ttdeci">void zero(enc_struct_t enc_struct)</div><div class="ttdoc">Zero the Encoder.</div><div class="ttdef"><b>Definition</b> <a href="_encoder_8cpp_source.html#l00054">Encoder.cpp:54</a></div></div>
<div class="ttc" id="a_inertial___control_8cpp_html_a22d79f0ec1c73ae2e5b03c9f61abc36b"><div class="ttname"><a href="_inertial___control_8cpp.html#a22d79f0ec1c73ae2e5b03c9f61abc36b">uart_msgs</a></div><div class="ttdeci">uint8_t uart_msgs[60]</div><div class="ttdef"><b>Definition</b> <a href="_inertial___control_8cpp_source.html#l00045">Inertial_Control.cpp:45</a></div></div>
<div class="ttc" id="a_inertial___control_8cpp_html_a7360c90b45e89aa08e2fe0fe76be6e00"><div class="ttname"><a href="_inertial___control_8cpp.html#a7360c90b45e89aa08e2fe0fe76be6e00">tar_vel</a></div><div class="ttdeci">int32_t tar_vel</div><div class="ttdef"><b>Definition</b> <a href="_inertial___control_8cpp_source.html#l00039">Inertial_Control.cpp:39</a></div></div>
<div class="ttc" id="a_inertial___control_8cpp_html_ab6a8993805fd7b50a32669337ca3a37a"><div class="ttname"><a href="_inertial___control_8cpp.html#ab6a8993805fd7b50a32669337ca3a37a">duty</a></div><div class="ttdeci">int32_t duty</div><div class="ttdef"><b>Definition</b> <a href="_inertial___control_8cpp_source.html#l00041">Inertial_Control.cpp:41</a></div></div>
<div class="ttc" id="a_inertial___control_8cpp_html_ac49b413febda9f85b78e5e87e98efcd2"><div class="ttname"><a href="_inertial___control_8cpp.html#ac49b413febda9f85b78e5e87e98efcd2">err_vel</a></div><div class="ttdeci">int32_t err_vel</div><div class="ttdef"><b>Definition</b> <a href="_inertial___control_8cpp_source.html#l00040">Inertial_Control.cpp:40</a></div></div>
<div class="ttc" id="a_inertial___control_8cpp_html_acc060445a2d7f1874f41dd76face8487"><div class="ttname"><a href="_inertial___control_8cpp.html#acc060445a2d7f1874f41dd76face8487">first_tick</a></div><div class="ttdeci">uint32_t first_tick</div><div class="ttdef"><b>Definition</b> <a href="_inertial___control_8cpp_source.html#l00033">Inertial_Control.cpp:33</a></div></div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_f93dfce691d792349f1c14ede440e2e6.html">Inc</a></li><li class="navelem"><a class="el" href="_inertial___control_8h.html">Inertial_Control.h</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.7 </li>
  </ul>
</div>
</body>
</html>
