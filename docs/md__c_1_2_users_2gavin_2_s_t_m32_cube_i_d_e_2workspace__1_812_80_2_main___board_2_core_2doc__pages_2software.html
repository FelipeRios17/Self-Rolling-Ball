<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.7"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Self Rolling Ball: md__c_1_2_users_2gavin_2_s_t_m32_cube_i_d_e_2workspace__1_812_80_2_main___board_2_core_2doc__pages_2software</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="Logo_2_150x149.png"/></td>
  <td id="projectalign">
   <div id="projectname">Self Rolling Ball<span id="projectnumber">&#160;Final</span>
   </div>
   <div id="projectbrief">Design and build of a structure, PCB, and software interface to create a robot which can be commanded direction and magnitude to roll at.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.7 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md__c_1_2_users_2gavin_2_s_t_m32_cube_i_d_e_2workspace__1_812_80_2_main___board_2_core_2doc__pages_2software.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">md__c_1_2_users_2gavin_2_s_t_m32_cube_i_d_e_2workspace__1_812_80_2_main___board_2_core_2doc__pages_2software</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#Robot">IMU Control</a></li>
<li class="level1"><a href="#Inertial">Wheel Control</a></li>
<li class="level1"><a href="#Photo">Processing</a></li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="Software"></a> </p>
<h1><a class="anchor" id="Robot"></a>
IMU Control</h1>
<h1><a class="anchor" id="Inertial"></a>
Wheel Control</h1>
<h1><a class="anchor" id="Photo"></a>
Processing</h1>
<div class="fragment"><div class="line"><span class="keyword">def </span>photo_process(prev):</div>
<div class="line">    <span class="keyword">import</span> numpy <span class="keyword">as</span> np</div>
<div class="line">    <span class="keyword">import</span> random</div>
<div class="line">    <span class="keyword">import</span> cv2</div>
<div class="line"> </div>
<div class="line">    image = cv2.imread(<span class="stringliteral">&quot;test2.png&quot;</span>)</div>
<div class="line">    gray = cv2.cvtColor(image, cv2.COLOR_BGR2GRAY)</div>
<div class="line">    <span class="comment"># blurred = cv2.GaussianBlur(gray, (5, 5), 0)</span></div>
<div class="line">    thresh = cv2.threshold(gray, 220, 255, cv2.THRESH_BINARY)[1]</div>
<div class="line">    </div>
<div class="line">    thresh = cv2.erode(thresh, <span class="keywordtype">None</span>, iterations=2)</div>
<div class="line">    thresh = cv2.dilate(thresh, <span class="keywordtype">None</span>, iterations=2)</div>
<div class="line">    </div>
<div class="line"> </div>
<div class="line">    cnt = cv2.findContours(thresh, cv2.RETR_EXTERNAL, cv2.CHAIN_APPROX_SIMPLE)[0]</div>
<div class="line">    </div>
<div class="line">    <span class="comment"># If we have multiple contours, most likely closer to light source, so increase brightness cutoff</span></div>
<div class="line">    <span class="keywordflow">if</span> len(cnt) &gt; 2:</div>
<div class="line">        thresh = cv2.threshold(gray, 240, 255, cv2.THRESH_BINARY)[1]</div>
<div class="line">        thresh = cv2.erode(thresh, <span class="keywordtype">None</span>, iterations=2)</div>
<div class="line">        thresh = cv2.dilate(thresh, <span class="keywordtype">None</span>, iterations=2)</div>
<div class="line">        cnt = cv2.findContours(thresh, cv2.RETR_EXTERNAL, cv2.CHAIN_APPROX_SIMPLE)[0]</div>
<div class="line">    </div>
<div class="line">    <span class="comment"># If we still have multiple contours, check to see if we have recorded a previous area</span></div>
<div class="line">    <span class="comment"># If yes, then find areas in new list greater than previous but less than a max area of</span></div>
<div class="line">    <span class="comment"># 200. If no, then select the smallest area out of the group</span></div>
<div class="line">    <span class="keywordflow">if</span> len(cnt) &gt; 1:</div>
<div class="line">        areas = [0]*len(cnt)</div>
<div class="line">        <span class="keywordflow">for</span> idx, val <span class="keywordflow">in</span> enumerate(cnt):</div>
<div class="line">            areas[idx] = cv2.contourArea(val)</div>
<div class="line">        <span class="keywordflow">if</span> prev == 0:</div>
<div class="line">            area = min(areas)</div>
<div class="line">            M = cv2.moments(cnt[areas.index(area)])</div>
<div class="line">        <span class="keywordflow">else</span>:</div>
<div class="line">            <span class="keywordflow">for</span> idx, a <span class="keywordflow">in</span> enumerate(areas):</div>
<div class="line">                <span class="keywordflow">if</span> a &gt; prev <span class="keywordflow">and</span> a &lt; 200:</div>
<div class="line">                    area = a</div>
<div class="line">                    M = cv2.moments(cnt[idx])</div>
<div class="line">                    <span class="keywordflow">break</span></div>
<div class="line">    <span class="keywordflow">else</span>:</div>
<div class="line">        M = cv2.moments(thresh)</div>
<div class="line">        area = cv2.contourArea(cnt[0])</div>
<div class="line"> </div>
<div class="line">    cv2.imshow(<span class="stringliteral">&quot;image&quot;</span>, thresh)</div>
<div class="line">    cv2.waitKey(0)</div>
<div class="line">     </div>
<div class="line">    <span class="comment"># Calculate x,y coordinate of center</span></div>
<div class="line">    cX = int(M[<span class="stringliteral">&quot;m10&quot;</span>] / M[<span class="stringliteral">&quot;m00&quot;</span>])</div>
<div class="line">    cY = int(M[<span class="stringliteral">&quot;m01&quot;</span>] / M[<span class="stringliteral">&quot;m00&quot;</span>])</div>
<div class="line">    </div>
<div class="line">    print(<span class="stringliteral">&quot;X: %d&quot;</span> %cX)</div>
<div class="line">    print(<span class="stringliteral">&quot;Y: %d&quot;</span> %cY)</div>
<div class="line">    print(<span class="stringliteral">&quot;Area: %d&quot;</span> %area)</div>
<div class="line"> </div>
<div class="line">    <span class="comment"># put text</span></div>
<div class="line">    cv2.circle(image, (cX, cY), 10, (0, 0, 255), 2)</div>
<div class="line">    </div>
<div class="line"> </div>
<div class="line">    cv2.imshow(<span class="stringliteral">&quot;image&quot;</span>, image)</div>
<div class="line">    cv2.waitKey(0)</div>
<div class="line">    cv2.destroyAllWindows()</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> cX, cY, area</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">def </span>server_post (duty1, duty2, duty3, duty4):</div>
<div class="line">    <span class="keyword">import</span> MySQLdb</div>
<div class="line">    </div>
<div class="line">    db = MySQLdb.connect(<span class="stringliteral">&quot;localhost&quot;</span>,<span class="stringliteral">&quot;root&quot;</span>,<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;duty_cycle&quot;</span>)</div>
<div class="line">    insertrec = db.cursor()</div>
<div class="line"> </div>
<div class="line">    sqlquery = <span class="stringliteral">&quot;INSERT INTO dht11 (duty1, duty2, duty3) VALUES (&quot;</span> + str(duty1) + <span class="stringliteral">&quot;, &quot;</span> + str(duty2) + <span class="stringliteral">&quot;, &quot;</span> + str(duty3) + <span class="stringliteral">&quot;)&quot;</span></div>
<div class="line">    insertrec.execute(sqlquery)</div>
<div class="line">    db.commit()</div>
<div class="line">    db.close()</div>
<div class="line">    print(<span class="stringliteral">&#39;Record created successfully&#39;</span>) </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">def </span>photo_retrieve (URL):</div>
<div class="line">    <span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</div>
<div class="line">    <span class="keyword">import</span> urllib.request</div>
<div class="line">    <span class="keyword">import</span> time</div>
<div class="line">    </div>
<div class="line">    driver = webdriver.Chrome()</div>
<div class="line">    driver.get(URL) <span class="comment"># &quot;http://192.168.1.110/&quot;</span></div>
<div class="line">    driver.maximize_window()</div>
<div class="line">    time.sleep(5)</div>
<div class="line">    button = driver.find_element(<span class="stringliteral">&quot;id&quot;</span>, <span class="stringliteral">&quot;get-still&quot;</span>)</div>
<div class="line">    button.click()</div>
<div class="line"> </div>
<div class="line">    img = driver.find_element(<span class="stringliteral">&quot;id&quot;</span>, <span class="stringliteral">&quot;stream&quot;</span>)</div>
<div class="line">    src = img.get_attribute(<span class="stringliteral">&#39;src&#39;</span>)</div>
<div class="line">    urllib.request.urlretrieve(src, <span class="stringliteral">&quot;test.png&quot;</span>)</div>
<div class="line"> </div>
<div class="line">    driver.close()</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> __name__ == <span class="stringliteral">&quot;__main__&quot;</span>:</div>
<div class="line">    </div>
<div class="line">    </div>
<div class="line">    cx, cy, area = photo_process(20)</div>
</div><!-- fragment --><h1><a class="anchor" id="Design"></a>
Flaws</h1>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.7 </li>
  </ul>
</div>
</body>
</html>
