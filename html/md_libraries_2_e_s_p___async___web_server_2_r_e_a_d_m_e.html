<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.7"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Self Rolling Ball: ESPAsyncWebServer</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="Logo_2_150x149.png"/></td>
  <td id="projectalign">
   <div id="projectname">Self Rolling Ball<span id="projectnumber">&#160;Final</span>
   </div>
   <div id="projectbrief">Design and build of a structure, PCB, and software interface to create a robot which can be commanded direction and magnitude to roll at.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.7 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_libraries_2_e_s_p___async___web_server_2_r_e_a_d_m_e.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">ESPAsyncWebServer</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md3"></a><a href="https://travis-ci.org/me-no-dev/ESPAsyncWebServer"><img src="https://travis-ci.org/me-no-dev/ESPAsyncWebServer.svg?branch=master" alt="Build Status" style="pointer-events: none;" class="inline"/></a> <img src="https://github.com/me-no-dev/ESPAsyncWebServer/workflows/ESP%20Async%20Web%20Server%20CI/badge.svg" alt="" style="pointer-events: none;" class="inline"/> <a href="https://www.codacy.com/manual/me-no-dev/ESPAsyncWebServer?utm_source=github.com&amp;utm_medium=referral&amp;utm_content=me-no-dev/ESPAsyncWebServer&amp;utm_campaign=Badge_Grade"><img src="https://api.codacy.com/project/badge/Grade/395dd42cfc674e6ca2e326af3af80ffc" alt="Codacy Badge" class="inline"/></a></p>
<p>For help and support <a href="https://gitter.im/me-no-dev/ESPAsyncWebServer?utm_source=badge&amp;utm_medium=badge&amp;utm_campaign=pr-badge&amp;utm_content=badge"><img src="https://badges.gitter.im/me-no-dev/ESPAsyncWebServer.svg" alt="Join the chat at https://gitter.im/me-no-dev/ESPAsyncWebServer" style="pointer-events: none;" class="inline"/></a></p>
<p>Async HTTP and WebSocket Server for ESP8266 Arduino</p>
<p>For ESP8266 it requires <a href="https://github.com/me-no-dev/ESPAsyncTCP">ESPAsyncTCP</a> To use this library you might need to have the latest git versions of <a href="https://github.com/esp8266/Arduino">ESP8266</a> Arduino Core</p>
<p>For ESP32 it requires <a href="https://github.com/me-no-dev/AsyncTCP">AsyncTCP</a> to work To use this library you might need to have the latest git versions of <a href="https://github.com/espressif/arduino-esp32">ESP32</a> Arduino Core</p>
<h1><a class="anchor" id="autotoc_md4"></a>
Table of contents</h1>
<ul>
<li>ESPAsyncWebServer<ul>
<li>Table of contents</li>
<li>Installation<ul>
<li>Using PlatformIO</li>
</ul>
</li>
<li>Why should you care</li>
<li>Important things to remember</li>
<li>Principles of operation<ul>
<li>The Async Web server</li>
<li>Request Life Cycle</li>
<li>Rewrites and how do they work</li>
<li>Handlers and how do they work</li>
<li>Responses and how do they work</li>
<li>Template processing</li>
</ul>
</li>
<li>Libraries and projects that use AsyncWebServer</li>
<li>Request Variables<ul>
<li>Common Variables</li>
<li>Headers</li>
<li>GET, POST and FILE parameters</li>
<li>FILE Upload handling</li>
<li>Body data handling</li>
<li>JSON body handling with ArduinoJson</li>
</ul>
</li>
<li>Responses<ul>
<li>Redirect to another URL</li>
<li>Basic response with HTTP Code</li>
<li>Basic response with HTTP Code and extra headers</li>
<li>Basic response with string content</li>
<li>Basic response with string content and extra headers</li>
<li>Send large webpage from PROGMEM</li>
<li>Send large webpage from PROGMEM and extra headers</li>
<li>Send large webpage from PROGMEM containing templates</li>
<li>Send large webpage from PROGMEM containing templates and extra headers</li>
<li>Send binary content from PROGMEM</li>
<li>Respond with content coming from a Stream</li>
<li>Respond with content coming from a Stream and extra headers</li>
<li>Respond with content coming from a Stream containing templates</li>
<li>Respond with content coming from a Stream containing templates and extra headers</li>
<li>Respond with content coming from a File</li>
<li>Respond with content coming from a File and extra headers</li>
<li>Respond with content coming from a File containing templates</li>
<li>Respond with content using a callback</li>
<li>Respond with content using a callback and extra headers</li>
<li>Respond with content using a callback containing templates</li>
<li>Respond with content using a callback containing templates and extra headers</li>
<li>Chunked Response</li>
<li>Chunked Response containing templates</li>
<li>Print to response</li>
<li>ArduinoJson Basic Response</li>
<li>ArduinoJson Advanced Response</li>
</ul>
</li>
<li>Serving static files<ul>
<li>Serving specific file by name</li>
<li>Serving files in directory</li>
<li>Serving static files with authentication</li>
<li>Specifying Cache-Control header</li>
<li>Specifying Date-Modified header</li>
<li>Specifying Template Processor callback</li>
</ul>
</li>
<li>Param Rewrite With Matching</li>
<li>Using filters<ul>
<li>Serve different site files in AP mode</li>
<li>Rewrite to different index on AP</li>
<li>Serving different hosts</li>
<li>Determine interface inside callbacks</li>
</ul>
</li>
<li>Bad Responses<ul>
<li>Respond with content using a callback without content length to HTTP/1.0 clients</li>
</ul>
</li>
<li>Async WebSocket Plugin<ul>
<li>Async WebSocket Event</li>
<li>Methods for sending data to a socket client</li>
<li>Direct access to web socket message buffer</li>
<li>Limiting the number of web socket clients</li>
</ul>
</li>
<li>Async Event Source Plugin<ul>
<li>Setup Event Source on the server</li>
<li>Setup Event Source in the browser</li>
</ul>
</li>
<li>Scanning for available WiFi Networks</li>
<li>Remove handlers and rewrites</li>
<li>Setting up the server<ul>
<li>Setup global and class functions as request handlers</li>
<li>Methods for controlling websocket connections</li>
<li>Adding Default Headers</li>
<li>Path variable</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md5"></a>
Installation</h1>
<h2><a class="anchor" id="autotoc_md6"></a>
Using PlatformIO</h2>
<p><a href="http://platformio.org">PlatformIO</a> is an open source ecosystem for IoT development with cross platform build system, library manager and full support for Espressif ESP8266/ESP32 development. It works on the popular host OS: Mac OS X, Windows, Linux 32/64, Linux ARM (like Raspberry Pi, BeagleBone, CubieBoard).</p>
<ol type="1">
<li>Install <a href="http://platformio.org/platformio-ide">PlatformIO IDE</a></li>
<li>Create new project using "PlatformIO Home &gt; New Project"</li>
<li>Update dev/platform to staging version:<ul>
<li><a href="http://docs.platformio.org/en/latest/platforms/espressif8266.html#using-arduino-framework-with-staging-version">Instruction for Espressif 8266</a></li>
<li><a href="http://docs.platformio.org/en/latest/platforms/espressif32.html#using-arduino-framework-with-staging-version">Instruction for Espressif 32</a></li>
</ul>
</li>
</ol>
<p>Add "ESP Async WebServer" to project using <a href="http://docs.platformio.org/page/projectconf.html">Project Configuration File <code>platformio.ini</code></a> and <a href="http://docs.platformio.org/page/projectconf/section_env_library.html#lib-deps">lib_deps</a> option:</p>
<div class="fragment"><div class="line">[env:myboard]</div>
<div class="line">platform = espressif...</div>
<div class="line">board = ...</div>
<div class="line">framework = arduino</div>
<div class="line"> </div>
<div class="line"># using the latest stable version</div>
<div class="line">lib_deps = ESP Async WebServer</div>
<div class="line"> </div>
<div class="line"># or using GIT Url (the latest development version)</div>
<div class="line">lib_deps = https://github.com/me-no-dev/ESPAsyncWebServer.git</div>
</div><!-- fragment --><ol type="1">
<li>Happy coding with PlatformIO!</li>
</ol>
<h1><a class="anchor" id="autotoc_md7"></a>
Why should you care</h1>
<ul>
<li>Using asynchronous network means that you can handle more than one connection at the same time</li>
<li>You are called once the request is ready and parsed</li>
<li>When you send the response, you are immediately ready to handle other connections while the server is taking care of sending the response in the background</li>
<li>Speed is OMG</li>
<li>Easy to use API, HTTP Basic and Digest MD5 Authentication (default), ChunkedResponse</li>
<li>Easily extendible to handle any type of content</li>
<li>Supports Continue 100</li>
<li>Async WebSocket plugin offering different locations without extra servers or ports</li>
<li>Async EventSource (Server-Sent Events) plugin to send events to the browser</li>
<li>URL Rewrite plugin for conditional and permanent url rewrites</li>
<li>ServeStatic plugin that supports cache, Last-Modified, default index and more</li>
<li>Simple template processing engine to handle templates</li>
</ul>
<h1><a class="anchor" id="autotoc_md8"></a>
Important things to remember</h1>
<ul>
<li>This is fully asynchronous server and as such does not run on the loop thread.</li>
<li>You can not use yield or delay or any function that uses them inside the callbacks</li>
<li>The server is smart enough to know when to close the connection and free resources</li>
<li>You can not send more than one response to a single request</li>
</ul>
<h1><a class="anchor" id="autotoc_md9"></a>
Principles of operation</h1>
<h2><a class="anchor" id="autotoc_md10"></a>
The Async Web server</h2>
<ul>
<li>Listens for connections</li>
<li>Wraps the new clients into <code>Request</code></li>
<li>Keeps track of clients and cleans memory</li>
<li>Manages <code>Rewrites</code> and apply them on the request url</li>
<li>Manages <code>Handlers</code> and attaches them to Requests</li>
</ul>
<h2><a class="anchor" id="autotoc_md11"></a>
Request Life Cycle</h2>
<ul>
<li>TCP connection is received by the server</li>
<li>The connection is wrapped inside <code>Request</code> object</li>
<li>When the request head is received (type, url, get params, http version and host), the server goes through all <code>Rewrites</code> (in the order they were added) to rewrite the url and inject query parameters, next, it goes through all attached <code>Handlers</code>(in the order they were added) trying to find one that <code>canHandle</code> the given request. If none are found, the default(catch-all) handler is attached.</li>
<li>The rest of the request is received, calling the <code>handleUpload</code> or <code>handleBody</code> methods of the <code>Handler</code> if they are needed (POST+File/Body)</li>
<li>When the whole request is parsed, the result is given to the <code>handleRequest</code> method of the <code>Handler</code> and is ready to be responded to</li>
<li>In the <code>handleRequest</code> method, to the <code>Request</code> is attached a <code>Response</code> object (see below) that will serve the response data back to the client</li>
<li>When the <code>Response</code> is sent, the client is closed and freed from the memory</li>
</ul>
<h2><a class="anchor" id="autotoc_md12"></a>
Rewrites and how do they work</h2>
<ul>
<li>The <code>Rewrites</code> are used to rewrite the request url and/or inject get parameters for a specific request url path.</li>
<li>All <code>Rewrites</code> are evaluated on the request in the order they have been added to the server.</li>
<li>The <code>Rewrite</code> will change the request url only if the request url (excluding get parameters) is fully match the rewrite url, and when the optional <code>Filter</code> callback return true.</li>
<li>Setting a <code>Filter</code> to the <code>Rewrite</code> enables to control when to apply the rewrite, decision can be based on request url, http version, request host/port/target host, get parameters or the request client's localIP or remoteIP.</li>
<li>Two filter callbacks are provided: <code>ON_AP_FILTER</code> to execute the rewrite when request is made to the AP interface, <div class="fragment"><div class="line">_STA_FILTER</div>
</div><!-- fragment --> to execute the rewrite when request is made to the STA interface.</li>
<li>The <code>Rewrite</code> can specify a target url with optional get parameters, e.g. <code>/to-url?with=params</code></li>
</ul>
<h2><a class="anchor" id="autotoc_md13"></a>
Handlers and how do they work</h2>
<ul>
<li>The <code>Handlers</code> are used for executing specific actions to particular requests</li>
<li>One <code>Handler</code> instance can be attached to any request and lives together with the server</li>
<li>Setting a <code>Filter</code> to the <code>Handler</code> enables to control when to apply the handler, decision can be based on request url, http version, request host/port/target host, get parameters or the request client's localIP or remoteIP.</li>
<li>Two filter callbacks are provided: <code>ON_AP_FILTER</code> to execute the rewrite when request is made to the AP interface, <div class="fragment"><div class="line">_STA_FILTER</div>
</div><!-- fragment --> to execute the rewrite when request is made to the STA interface.</li>
<li>The <code>canHandle</code> method is used for handler specific control on whether the requests can be handled and for declaring any interesting headers that the <code>Request</code> should parse. Decision can be based on request method, request url, http version, request host/port/target host and get parameters</li>
<li>Once a <code>Handler</code> is attached to given <code>Request</code> (<code>canHandle</code> returned true) that <code>Handler</code> takes care to receive any file/data upload and attach a <code>Response</code> once the <code>Request</code> has been fully parsed</li>
<li><code>Handlers</code> are evaluated in the order they are attached to the server. The <code>canHandle</code> is called only if the <code>Filter</code> that was set to the <code>Handler</code> return true.</li>
<li>The first <code>Handler</code> that can handle the request is selected, not further <code>Filter</code> and <code>canHandle</code> are called.</li>
</ul>
<h2><a class="anchor" id="autotoc_md14"></a>
Responses and how do they work</h2>
<ul>
<li>The <code>Response</code> objects are used to send the response data back to the client</li>
<li>The <code>Response</code> object lives with the <code>Request</code> and is freed on end or disconnect</li>
<li>Different techniques are used depending on the response type to send the data in packets returning back almost immediately and sending the next packet when this one is received. Any time in between is spent to run the user loop and handle other network packets</li>
<li>Responding asynchronously is probably the most difficult thing for most to understand</li>
<li>Many different options exist for the user to make responding a background task</li>
</ul>
<h2><a class="anchor" id="autotoc_md15"></a>
Template processing</h2>
<ul>
<li>ESPAsyncWebserver contains simple template processing engine.</li>
<li>Template processing can be added to most response types.</li>
<li>Currently it supports only replacing template placeholders with actual values. No conditional processing, cycles, etc.</li>
<li>Placeholders are delimited with <code>%</code> symbols. Like this: <code>TEMPLATE_PLACEHOLDER%</code>.</li>
<li>It works by extracting placeholder name from response text and passing it to user provided function which should return actual value to be used instead of placeholder.</li>
<li>Since it's user provided function, it is possible for library users to implement conditional processing and cycles themselves.</li>
<li>Since it's impossible to know the actual response size after template processing step in advance (and, therefore, to include it in response headers), the response becomes chunked.</li>
</ul>
<h1><a class="anchor" id="autotoc_md16"></a>
Libraries and projects that use AsyncWebServer</h1>
<ul>
<li><a href="https://github.com/hallard/WebSocketToSerial">WebSocketToSerial</a> - Debug serial devices through the web browser</li>
<li><a href="https://github.com/Hopperpop/Sattrack">Sattrack</a> - Track the ISS with ESP8266</li>
<li><a href="https://github.com/Edzelf/Esp-radio">ESP Radio</a> - Icecast radio based on ESP8266 and VS1053</li>
<li><a href="https://github.com/andig/vzero">VZero</a> - the Wireless zero-config controller for volkszaehler.org</li>
<li><a href="https://bitbucket.org/xoseperez/espurna">ESPurna</a> - ESPurna ("spark" in Catalan) is a custom C firmware for ESP8266 based smart switches. It was originally developed with the ITead Sonoff in mind.</li>
<li><a href="https://bitbucket.org/xoseperez/fauxmoesp">fauxmoESP</a> - Belkin WeMo emulator library for ESP8266.</li>
<li><a href="https://github.com/omersiar/esp-rfid">ESP-RFID</a> - MFRC522 RFID Access Control Management project for ESP8266.</li>
</ul>
<h1><a class="anchor" id="autotoc_md17"></a>
Request Variables</h1>
<h2><a class="anchor" id="autotoc_md18"></a>
Common Variables</h2>
<div class="fragment"><div class="line">request-&gt;version();       <span class="comment">// uint8_t: 0 = HTTP/1.0, 1 = HTTP/1.1</span></div>
<div class="line">request-&gt;method();        <span class="comment">// enum:    HTTP_GET, HTTP_POST, HTTP_DELETE, HTTP_PUT, HTTP_PATCH, HTTP_HEAD, HTTP_OPTIONS</span></div>
<div class="line">request-&gt;url();           <span class="comment">// String:  URL of the request (not including host, port or GET parameters)</span></div>
<div class="line">request-&gt;host();          <span class="comment">// String:  The requested host (can be used for virtual hosting)</span></div>
<div class="line">request-&gt;contentType();   <span class="comment">// String:  ContentType of the request (not avaiable in Handler::canHandle)</span></div>
<div class="line">request-&gt;contentLength(); <span class="comment">// size_t:  ContentLength of the request (not avaiable in Handler::canHandle)</span></div>
<div class="line">request-&gt;multipart();     <span class="comment">// bool:    True if the request has content type &quot;multipart&quot;</span></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md19"></a>
Headers</h2>
<div class="fragment"><div class="line"><span class="comment">//List all collected headers</span></div>
<div class="line"><span class="keywordtype">int</span> headers = request-&gt;headers();</div>
<div class="line"><span class="keywordtype">int</span> i;</div>
<div class="line"><span class="keywordflow">for</span>(i=0;i&lt;headers;i++){</div>
<div class="line">  <a class="code hl_class" href="class_async_web_header.html">AsyncWebHeader</a>* h = request-&gt;getHeader(i);</div>
<div class="line">  Serial.printf(<span class="stringliteral">&quot;HEADER[%s]: %s\n&quot;</span>, h-&gt;<a class="code hl_function" href="class_async_web_header.html#af8f51a50de29048841d099773e4508b2">name</a>().c_str(), h-&gt;<a class="code hl_function" href="class_async_web_header.html#a9ad7d9f7ad2044b99c2a00bdb5df2d50">value</a>().c_str());</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">//get specific header by name</span></div>
<div class="line"><span class="keywordflow">if</span>(request-&gt;hasHeader(<span class="stringliteral">&quot;MyHeader&quot;</span>)){</div>
<div class="line">  <a class="code hl_class" href="class_async_web_header.html">AsyncWebHeader</a>* h = request-&gt;getHeader(<span class="stringliteral">&quot;MyHeader&quot;</span>);</div>
<div class="line">  Serial.printf(<span class="stringliteral">&quot;MyHeader: %s\n&quot;</span>, h-&gt;<a class="code hl_function" href="class_async_web_header.html#a9ad7d9f7ad2044b99c2a00bdb5df2d50">value</a>().c_str());</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">//List all collected headers (Compatibility)</span></div>
<div class="line"><span class="keywordtype">int</span> headers = request-&gt;headers();</div>
<div class="line"><span class="keywordtype">int</span> i;</div>
<div class="line"><span class="keywordflow">for</span>(i=0;i&lt;headers;i++){</div>
<div class="line">  Serial.printf(<span class="stringliteral">&quot;HEADER[%s]: %s\n&quot;</span>, request-&gt;headerName(i).c_str(), request-&gt;header(i).c_str());</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">//get specific header by name (Compatibility)</span></div>
<div class="line"><span class="keywordflow">if</span>(request-&gt;hasHeader(<span class="stringliteral">&quot;MyHeader&quot;</span>)){</div>
<div class="line">  Serial.printf(<span class="stringliteral">&quot;MyHeader: %s\n&quot;</span>, request-&gt;header(<span class="stringliteral">&quot;MyHeader&quot;</span>).c_str());</div>
<div class="line">}</div>
<div class="ttc" id="aclass_async_web_header_html"><div class="ttname"><a href="class_async_web_header.html">AsyncWebHeader</a></div><div class="ttdef"><b>Definition</b> <a href="_e_s_p_async_web_server_8h_source.html#l00105">ESPAsyncWebServer.h:105</a></div></div>
<div class="ttc" id="aclass_async_web_header_html_a9ad7d9f7ad2044b99c2a00bdb5df2d50"><div class="ttname"><a href="class_async_web_header.html#a9ad7d9f7ad2044b99c2a00bdb5df2d50">AsyncWebHeader::value</a></div><div class="ttdeci">const String &amp; value() const</div><div class="ttdef"><b>Definition</b> <a href="_e_s_p_async_web_server_8h_source.html#l00121">ESPAsyncWebServer.h:121</a></div></div>
<div class="ttc" id="aclass_async_web_header_html_af8f51a50de29048841d099773e4508b2"><div class="ttname"><a href="class_async_web_header.html#af8f51a50de29048841d099773e4508b2">AsyncWebHeader::name</a></div><div class="ttdeci">const String &amp; name() const</div><div class="ttdef"><b>Definition</b> <a href="_e_s_p_async_web_server_8h_source.html#l00120">ESPAsyncWebServer.h:120</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md20"></a>
GET, POST and FILE parameters</h2>
<div class="fragment"><div class="line"><span class="comment">//List all parameters</span></div>
<div class="line"><span class="keywordtype">int</span> params = request-&gt;params();</div>
<div class="line"><span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;params;i++){</div>
<div class="line">  <a class="code hl_class" href="class_async_web_parameter.html">AsyncWebParameter</a>* p = request-&gt;getParam(i);</div>
<div class="line">  <span class="keywordflow">if</span>(p-&gt;<a class="code hl_function" href="class_async_web_parameter.html#a303e06c6c9379c1b2756943f42180e7a">isFile</a>()){ <span class="comment">//p-&gt;isPost() is also true</span></div>
<div class="line">    Serial.printf(<span class="stringliteral">&quot;FILE[%s]: %s, size: %u\n&quot;</span>, p-&gt;<a class="code hl_function" href="class_async_web_parameter.html#a8810765851357e42bc6cf44e35a4d1b4">name</a>().c_str(), p-&gt;<a class="code hl_function" href="class_async_web_parameter.html#abf1e0d5f55490b8914370df199b195ae">value</a>().c_str(), p-&gt;<a class="code hl_function" href="class_async_web_parameter.html#af1e0f840977c185e8ec7522ecc1ab094">size</a>());</div>
<div class="line">  } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(p-&gt;<a class="code hl_function" href="class_async_web_parameter.html#a36b2d2f67b6e743ee6e43dffd5f8f0bf">isPost</a>()){</div>
<div class="line">    Serial.printf(<span class="stringliteral">&quot;POST[%s]: %s\n&quot;</span>, p-&gt;<a class="code hl_function" href="class_async_web_parameter.html#a8810765851357e42bc6cf44e35a4d1b4">name</a>().c_str(), p-&gt;<a class="code hl_function" href="class_async_web_parameter.html#abf1e0d5f55490b8914370df199b195ae">value</a>().c_str());</div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    Serial.printf(<span class="stringliteral">&quot;GET[%s]: %s\n&quot;</span>, p-&gt;<a class="code hl_function" href="class_async_web_parameter.html#a8810765851357e42bc6cf44e35a4d1b4">name</a>().c_str(), p-&gt;<a class="code hl_function" href="class_async_web_parameter.html#abf1e0d5f55490b8914370df199b195ae">value</a>().c_str());</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">//Check if GET parameter exists</span></div>
<div class="line"><span class="keywordflow">if</span>(request-&gt;hasParam(<span class="stringliteral">&quot;download&quot;</span>))</div>
<div class="line">  <a class="code hl_class" href="class_async_web_parameter.html">AsyncWebParameter</a>* p = request-&gt;getParam(<span class="stringliteral">&quot;download&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">//Check if POST (but not File) parameter exists</span></div>
<div class="line"><span class="keywordflow">if</span>(request-&gt;hasParam(<span class="stringliteral">&quot;download&quot;</span>, <span class="keyword">true</span>))</div>
<div class="line">  <a class="code hl_class" href="class_async_web_parameter.html">AsyncWebParameter</a>* p = request-&gt;getParam(<span class="stringliteral">&quot;download&quot;</span>, <span class="keyword">true</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">//Check if FILE was uploaded</span></div>
<div class="line"><span class="keywordflow">if</span>(request-&gt;hasParam(<span class="stringliteral">&quot;download&quot;</span>, <span class="keyword">true</span>, <span class="keyword">true</span>))</div>
<div class="line">  <a class="code hl_class" href="class_async_web_parameter.html">AsyncWebParameter</a>* p = request-&gt;getParam(<span class="stringliteral">&quot;download&quot;</span>, <span class="keyword">true</span>, <span class="keyword">true</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">//List all parameters (Compatibility)</span></div>
<div class="line"><span class="keywordtype">int</span> args = request-&gt;args();</div>
<div class="line"><span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;args;i++){</div>
<div class="line">  Serial.printf(<span class="stringliteral">&quot;ARG[%s]: %s\n&quot;</span>, request-&gt;argName(i).c_str(), request-&gt;arg(i).c_str());</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">//Check if parameter exists (Compatibility)</span></div>
<div class="line"><span class="keywordflow">if</span>(request-&gt;hasArg(<span class="stringliteral">&quot;download&quot;</span>))</div>
<div class="line">  String arg = request-&gt;arg(<span class="stringliteral">&quot;download&quot;</span>);</div>
<div class="ttc" id="aclass_async_web_parameter_html"><div class="ttname"><a href="class_async_web_parameter.html">AsyncWebParameter</a></div><div class="ttdef"><b>Definition</b> <a href="_e_s_p_async_web_server_8h_source.html#l00083">ESPAsyncWebServer.h:83</a></div></div>
<div class="ttc" id="aclass_async_web_parameter_html_a303e06c6c9379c1b2756943f42180e7a"><div class="ttname"><a href="class_async_web_parameter.html#a303e06c6c9379c1b2756943f42180e7a">AsyncWebParameter::isFile</a></div><div class="ttdeci">bool isFile() const</div><div class="ttdef"><b>Definition</b> <a href="_e_s_p_async_web_server_8h_source.html#l00098">ESPAsyncWebServer.h:98</a></div></div>
<div class="ttc" id="aclass_async_web_parameter_html_a36b2d2f67b6e743ee6e43dffd5f8f0bf"><div class="ttname"><a href="class_async_web_parameter.html#a36b2d2f67b6e743ee6e43dffd5f8f0bf">AsyncWebParameter::isPost</a></div><div class="ttdeci">bool isPost() const</div><div class="ttdef"><b>Definition</b> <a href="_e_s_p_async_web_server_8h_source.html#l00097">ESPAsyncWebServer.h:97</a></div></div>
<div class="ttc" id="aclass_async_web_parameter_html_a8810765851357e42bc6cf44e35a4d1b4"><div class="ttname"><a href="class_async_web_parameter.html#a8810765851357e42bc6cf44e35a4d1b4">AsyncWebParameter::name</a></div><div class="ttdeci">const String &amp; name() const</div><div class="ttdef"><b>Definition</b> <a href="_e_s_p_async_web_server_8h_source.html#l00094">ESPAsyncWebServer.h:94</a></div></div>
<div class="ttc" id="aclass_async_web_parameter_html_abf1e0d5f55490b8914370df199b195ae"><div class="ttname"><a href="class_async_web_parameter.html#abf1e0d5f55490b8914370df199b195ae">AsyncWebParameter::value</a></div><div class="ttdeci">const String &amp; value() const</div><div class="ttdef"><b>Definition</b> <a href="_e_s_p_async_web_server_8h_source.html#l00095">ESPAsyncWebServer.h:95</a></div></div>
<div class="ttc" id="aclass_async_web_parameter_html_af1e0f840977c185e8ec7522ecc1ab094"><div class="ttname"><a href="class_async_web_parameter.html#af1e0f840977c185e8ec7522ecc1ab094">AsyncWebParameter::size</a></div><div class="ttdeci">size_t size() const</div><div class="ttdef"><b>Definition</b> <a href="_e_s_p_async_web_server_8h_source.html#l00096">ESPAsyncWebServer.h:96</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md21"></a>
FILE Upload handling</h2>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> handleUpload(<a class="code hl_class" href="class_async_web_server_request.html">AsyncWebServerRequest</a> *request, String filename, <span class="keywordtype">size_t</span> <a class="code hl_variable" href="c_j_s_o_n_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a>, uint8_t *data, <span class="keywordtype">size_t</span> len, <span class="keywordtype">bool</span> <span class="keyword">final</span>){</div>
<div class="line">  <span class="keywordflow">if</span>(!<a class="code hl_variable" href="c_j_s_o_n_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a>){</div>
<div class="line">    Serial.printf(<span class="stringliteral">&quot;UploadStart: %s\n&quot;</span>, filename.c_str());</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i=0; i&lt;len; i++){</div>
<div class="line">    Serial.write(data[i]);</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">if</span>(<span class="keyword">final</span>){</div>
<div class="line">    Serial.printf(<span class="stringliteral">&quot;UploadEnd: %s, %u B\n&quot;</span>, filename.c_str(), <a class="code hl_variable" href="c_j_s_o_n_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a>+len);</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="ttc" id="ac_j_s_o_n_8h_html_a750b5d744c39a06bfb13e6eb010e35d0"><div class="ttname"><a href="c_j_s_o_n_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a></div><div class="ttdeci">int index</div><div class="ttdef"><b>Definition</b> <a href="c_j_s_o_n_8h_source.html#l00170">cJSON.h:170</a></div></div>
<div class="ttc" id="aclass_async_web_server_request_html"><div class="ttname"><a href="class_async_web_server_request.html">AsyncWebServerRequest</a></div><div class="ttdef"><b>Definition</b> <a href="_e_s_p_async_web_server_8h_source.html#l00134">ESPAsyncWebServer.h:134</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md22"></a>
Body data handling</h2>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> handleBody(<a class="code hl_class" href="class_async_web_server_request.html">AsyncWebServerRequest</a> *request, uint8_t *data, <span class="keywordtype">size_t</span> len, <span class="keywordtype">size_t</span> <a class="code hl_variable" href="c_j_s_o_n_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a>, <span class="keywordtype">size_t</span> total){</div>
<div class="line">  <span class="keywordflow">if</span>(!<a class="code hl_variable" href="c_j_s_o_n_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a>){</div>
<div class="line">    Serial.printf(<span class="stringliteral">&quot;BodyStart: %u B\n&quot;</span>, total);</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i=0; i&lt;len; i++){</div>
<div class="line">    Serial.write(data[i]);</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">if</span>(<a class="code hl_variable" href="c_j_s_o_n_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a> + len == total){</div>
<div class="line">    Serial.printf(<span class="stringliteral">&quot;BodyEnd: %u B\n&quot;</span>, total);</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><p> If needed, the <code>_tempObject</code> field on the request can be used to store a pointer to temporary data (e.g. from the body) associated with the request. If assigned, the pointer will automatically be freed along with the request.</p>
<h2><a class="anchor" id="autotoc_md23"></a>
JSON body handling with ArduinoJson</h2>
<p>Endpoints which consume JSON can use a special handler to get ready to use JSON data in the request callback: </p><div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="_async_json_8h.html">AsyncJson.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;ArduinoJson.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><a class="code hl_class" href="class_async_callback_json_web_handler.html">AsyncCallbackJsonWebHandler</a>* handler = <span class="keyword">new</span> <a class="code hl_class" href="class_async_callback_json_web_handler.html">AsyncCallbackJsonWebHandler</a>(<span class="stringliteral">&quot;/rest/endpoint&quot;</span>, [](<a class="code hl_class" href="class_async_web_server_request.html">AsyncWebServerRequest</a> *request, JsonVariant &amp;json) {</div>
<div class="line">  JsonObject&amp; jsonObj = json.as&lt;JsonObject&gt;();</div>
<div class="line">  <span class="comment">// ...</span></div>
<div class="line">});</div>
<div class="line">server.addHandler(handler);</div>
<div class="ttc" id="a_async_json_8h_html"><div class="ttname"><a href="_async_json_8h.html">AsyncJson.h</a></div></div>
<div class="ttc" id="aclass_async_callback_json_web_handler_html"><div class="ttname"><a href="class_async_callback_json_web_handler.html">AsyncCallbackJsonWebHandler</a></div><div class="ttdef"><b>Definition</b> <a href="_async_json_8h_source.html#l00174">AsyncJson.h:174</a></div></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md24"></a>
Responses</h1>
<h2><a class="anchor" id="autotoc_md25"></a>
Redirect to another URL</h2>
<div class="fragment"><div class="line"><span class="comment">//to local url</span></div>
<div class="line">request-&gt;<a class="code hl_function" href="class_async_web_server_request.html#a47d02f880c2b2fe41fa4f2021dfe57a6">redirect</a>(<span class="stringliteral">&quot;/login&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">//to external url</span></div>
<div class="line">request-&gt;<a class="code hl_function" href="class_async_web_server_request.html#a47d02f880c2b2fe41fa4f2021dfe57a6">redirect</a>(<span class="stringliteral">&quot;http://esp8266.com&quot;</span>);</div>
<div class="ttc" id="aclass_async_web_server_request_html_a47d02f880c2b2fe41fa4f2021dfe57a6"><div class="ttname"><a href="class_async_web_server_request.html#a47d02f880c2b2fe41fa4f2021dfe57a6">AsyncWebServerRequest::redirect</a></div><div class="ttdeci">void redirect(const String &amp;url)</div><div class="ttdef"><b>Definition</b> <a href="_web_request_8cpp_source.html#l00807">WebRequest.cpp:807</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md26"></a>
Basic response with HTTP Code</h2>
<div class="fragment"><div class="line">request-&gt;<a class="code hl_function" href="class_async_web_server_request.html#a4247e73eb8d8c7b386f9bb4ab10f3856">send</a>(404); <span class="comment">//Sends 404 File Not Found</span></div>
<div class="ttc" id="aclass_async_web_server_request_html_a4247e73eb8d8c7b386f9bb4ab10f3856"><div class="ttname"><a href="class_async_web_server_request.html#a4247e73eb8d8c7b386f9bb4ab10f3856">AsyncWebServerRequest::send</a></div><div class="ttdeci">void send(AsyncWebServerResponse *response)</div><div class="ttdef"><b>Definition</b> <a href="_web_request_8cpp_source.html#l00711">WebRequest.cpp:711</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md27"></a>
Basic response with HTTP Code and extra headers</h2>
<div class="fragment"><div class="line"><a class="code hl_class" href="class_async_web_server_response.html">AsyncWebServerResponse</a> *response = request-&gt;<a class="code hl_function" href="class_async_web_server_request.html#a133a829c7bc4c486ed41f3476666ea51">beginResponse</a>(404); <span class="comment">//Sends 404 File Not Found</span></div>
<div class="line">response-&gt;<a class="code hl_function" href="class_async_web_server_response.html#a56c370dbf9c75c17cb3cd8d22239205a">addHeader</a>(<span class="stringliteral">&quot;Server&quot;</span>,<span class="stringliteral">&quot;ESP Async Web Server&quot;</span>);</div>
<div class="line">request-&gt;<a class="code hl_function" href="class_async_web_server_request.html#a4247e73eb8d8c7b386f9bb4ab10f3856">send</a>(response);</div>
<div class="ttc" id="aclass_async_web_server_request_html_a133a829c7bc4c486ed41f3476666ea51"><div class="ttname"><a href="class_async_web_server_request.html#a133a829c7bc4c486ed41f3476666ea51">AsyncWebServerRequest::beginResponse</a></div><div class="ttdeci">AsyncWebServerResponse * beginResponse(int code, const String &amp;contentType=String(), const String &amp;content=String())</div><div class="ttdef"><b>Definition</b> <a href="_web_request_8cpp_source.html#l00729">WebRequest.cpp:729</a></div></div>
<div class="ttc" id="aclass_async_web_server_response_html"><div class="ttname"><a href="class_async_web_server_response.html">AsyncWebServerResponse</a></div><div class="ttdef"><b>Definition</b> <a href="_e_s_p_async_web_server_8h_source.html#l00358">ESPAsyncWebServer.h:358</a></div></div>
<div class="ttc" id="aclass_async_web_server_response_html_a56c370dbf9c75c17cb3cd8d22239205a"><div class="ttname"><a href="class_async_web_server_response.html#a56c370dbf9c75c17cb3cd8d22239205a">AsyncWebServerResponse::addHeader</a></div><div class="ttdeci">virtual void addHeader(const String &amp;name, const String &amp;value)</div><div class="ttdef"><b>Definition</b> <a href="_web_responses_8cpp_source.html#l00122">WebResponses.cpp:122</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md28"></a>
Basic response with string content</h2>
<div class="fragment"><div class="line">request-&gt;<a class="code hl_function" href="class_async_web_server_request.html#a4247e73eb8d8c7b386f9bb4ab10f3856">send</a>(200, <span class="stringliteral">&quot;text/plain&quot;</span>, <span class="stringliteral">&quot;Hello World!&quot;</span>);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md29"></a>
Basic response with string content and extra headers</h2>
<div class="fragment"><div class="line"><a class="code hl_class" href="class_async_web_server_response.html">AsyncWebServerResponse</a> *response = request-&gt;<a class="code hl_function" href="class_async_web_server_request.html#a133a829c7bc4c486ed41f3476666ea51">beginResponse</a>(200, <span class="stringliteral">&quot;text/plain&quot;</span>, <span class="stringliteral">&quot;Hello World!&quot;</span>);</div>
<div class="line">response-&gt;<a class="code hl_function" href="class_async_web_server_response.html#a56c370dbf9c75c17cb3cd8d22239205a">addHeader</a>(<span class="stringliteral">&quot;Server&quot;</span>,<span class="stringliteral">&quot;ESP Async Web Server&quot;</span>);</div>
<div class="line">request-&gt;<a class="code hl_function" href="class_async_web_server_request.html#a4247e73eb8d8c7b386f9bb4ab10f3856">send</a>(response);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md30"></a>
Send large webpage from PROGMEM</h2>
<div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> index_html[] <a class="code hl_variable" href="_s_p_i_f_f_s_editor_8cpp.html#a569152b81da50e484f22c99f331fa096">PROGMEM</a> = <span class="stringliteral">&quot;...&quot;</span>; <span class="comment">// large char array, tested with 14k</span></div>
<div class="line">request-&gt;<a class="code hl_function" href="class_async_web_server_request.html#a761b570160a6687a2240a87ea4425e43">send_P</a>(200, <span class="stringliteral">&quot;text/html&quot;</span>, index_html);</div>
<div class="ttc" id="a_s_p_i_f_f_s_editor_8cpp_html_a569152b81da50e484f22c99f331fa096"><div class="ttname"><a href="_s_p_i_f_f_s_editor_8cpp.html#a569152b81da50e484f22c99f331fa096">PROGMEM</a></div><div class="ttdeci">const uint8_t edit_htm_gz[] PROGMEM</div><div class="ttdef"><b>Definition</b> <a href="_s_p_i_f_f_s_editor_8cpp_source.html#l00006">SPIFFSEditor.cpp:6</a></div></div>
<div class="ttc" id="aclass_async_web_server_request_html_a761b570160a6687a2240a87ea4425e43"><div class="ttname"><a href="class_async_web_server_request.html#a761b570160a6687a2240a87ea4425e43">AsyncWebServerRequest::send_P</a></div><div class="ttdeci">void send_P(int code, const String &amp;contentType, const uint8_t *content, size_t len, AwsTemplateProcessor callback=nullptr)</div><div class="ttdef"><b>Definition</b> <a href="_web_request_8cpp_source.html#l00799">WebRequest.cpp:799</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md31"></a>
Send large webpage from PROGMEM and extra headers</h2>
<div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> index_html[] <a class="code hl_variable" href="_s_p_i_f_f_s_editor_8cpp.html#a569152b81da50e484f22c99f331fa096">PROGMEM</a> = <span class="stringliteral">&quot;...&quot;</span>; <span class="comment">// large char array, tested with 14k</span></div>
<div class="line"><a class="code hl_class" href="class_async_web_server_response.html">AsyncWebServerResponse</a> *response = request-&gt;<a class="code hl_function" href="class_async_web_server_request.html#a4e62af5ec7e0d678f867986573f6ce21">beginResponse_P</a>(200, <span class="stringliteral">&quot;text/html&quot;</span>, index_html);</div>
<div class="line">response-&gt;<a class="code hl_function" href="class_async_web_server_response.html#a56c370dbf9c75c17cb3cd8d22239205a">addHeader</a>(<span class="stringliteral">&quot;Server&quot;</span>,<span class="stringliteral">&quot;ESP Async Web Server&quot;</span>);</div>
<div class="line">request-&gt;<a class="code hl_function" href="class_async_web_server_request.html#a4247e73eb8d8c7b386f9bb4ab10f3856">send</a>(response);</div>
<div class="ttc" id="aclass_async_web_server_request_html_a4e62af5ec7e0d678f867986573f6ce21"><div class="ttname"><a href="class_async_web_server_request.html#a4e62af5ec7e0d678f867986573f6ce21">AsyncWebServerRequest::beginResponse_P</a></div><div class="ttdeci">AsyncWebServerResponse * beginResponse_P(int code, const String &amp;contentType, const uint8_t *content, size_t len, AwsTemplateProcessor callback=nullptr)</div><div class="ttdef"><b>Definition</b> <a href="_web_request_8cpp_source.html#l00763">WebRequest.cpp:763</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md32"></a>
Send large webpage from PROGMEM containing templates</h2>
<div class="fragment"><div class="line">String processor(<span class="keyword">const</span> String&amp; var)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">if</span>(var == <span class="stringliteral">&quot;HELLO_FROM_TEMPLATE&quot;</span>)</div>
<div class="line">    <span class="keywordflow">return</span> F(<span class="stringliteral">&quot;Hello world!&quot;</span>);</div>
<div class="line">  <span class="keywordflow">return</span> String();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// ...</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> index_html[] <a class="code hl_variable" href="_s_p_i_f_f_s_editor_8cpp.html#a569152b81da50e484f22c99f331fa096">PROGMEM</a> = <span class="stringliteral">&quot;...&quot;</span>; <span class="comment">// large char array, tested with 14k</span></div>
<div class="line">request-&gt;<a class="code hl_function" href="class_async_web_server_request.html#a761b570160a6687a2240a87ea4425e43">send_P</a>(200, <span class="stringliteral">&quot;text/html&quot;</span>, index_html, processor);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md33"></a>
Send large webpage from PROGMEM containing templates and extra headers</h2>
<div class="fragment"><div class="line">String processor(<span class="keyword">const</span> String&amp; var)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">if</span>(var == <span class="stringliteral">&quot;HELLO_FROM_TEMPLATE&quot;</span>)</div>
<div class="line">    <span class="keywordflow">return</span> F(<span class="stringliteral">&quot;Hello world!&quot;</span>);</div>
<div class="line">  <span class="keywordflow">return</span> String();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// ...</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> index_html[] <a class="code hl_variable" href="_s_p_i_f_f_s_editor_8cpp.html#a569152b81da50e484f22c99f331fa096">PROGMEM</a> = <span class="stringliteral">&quot;...&quot;</span>; <span class="comment">// large char array, tested with 14k</span></div>
<div class="line"><a class="code hl_class" href="class_async_web_server_response.html">AsyncWebServerResponse</a> *response = request-&gt;<a class="code hl_function" href="class_async_web_server_request.html#a4e62af5ec7e0d678f867986573f6ce21">beginResponse_P</a>(200, <span class="stringliteral">&quot;text/html&quot;</span>, index_html, processor);</div>
<div class="line">response-&gt;<a class="code hl_function" href="class_async_web_server_response.html#a56c370dbf9c75c17cb3cd8d22239205a">addHeader</a>(<span class="stringliteral">&quot;Server&quot;</span>,<span class="stringliteral">&quot;ESP Async Web Server&quot;</span>);</div>
<div class="line">request-&gt;<a class="code hl_function" href="class_async_web_server_request.html#a4247e73eb8d8c7b386f9bb4ab10f3856">send</a>(response);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md34"></a>
Send binary content from PROGMEM</h2>
<div class="fragment"><div class="line"><span class="comment">//File: favicon.ico.gz, Size: 726</span></div>
<div class="line"><span class="preprocessor">#define favicon_ico_gz_len 726</span></div>
<div class="line"><span class="keyword">const</span> uint8_t favicon_ico_gz[] <a class="code hl_variable" href="_s_p_i_f_f_s_editor_8cpp.html#a569152b81da50e484f22c99f331fa096">PROGMEM</a> = {</div>
<div class="line"> 0x1F, 0x8B, 0x08, 0x08, 0x0B, 0x87, 0x90, 0x57, 0x00, 0x03, 0x66, 0x61, 0x76, 0x69, 0x63, 0x6F,</div>
<div class="line"> 0x6E, 0x2E, 0x69, 0x63, 0x6F, 0x00, 0xCD, 0x53, 0x5F, 0x48, 0x9A, 0x51, 0x14, 0xBF, 0x62, 0x6D,</div>
<div class="line"> 0x86, 0x96, 0xA9, 0x64, 0xD3, 0xFE, 0xA8, 0x99, 0x65, 0x1A, 0xB4, 0x8A, 0xA8, 0x51, 0x54, 0x23,</div>
<div class="line"> 0xA8, 0x11, 0x49, 0x51, 0x8A, 0x34, 0x62, 0x93, 0x85, 0x31, 0x58, 0x44, 0x12, 0x45, 0x2D, 0x58,</div>
<div class="line"> 0xF5, 0x52, 0x41, 0x10, 0x23, 0x82, 0xA0, 0x20, 0x98, 0x2F, 0xC1, 0x26, 0xED, 0xA1, 0x20, 0x89,</div>
<div class="line"> 0x04, 0xD7, 0x83, 0x58, 0x20, 0x28, 0x04, 0xAB, 0xD1, 0x9B, 0x8C, 0xE5, 0xC3, 0x60, 0x32, 0x64,</div>
<div class="line"> 0x0E, 0x56, 0xBF, 0x9D, 0xEF, 0xF6, 0x30, 0x82, 0xED, 0xAD, 0x87, 0xDD, 0x8F, 0xF3, 0xDD, 0x8F,</div>
<div class="line"> 0x73, 0xCF, 0xEF, 0x9C, 0xDF, 0x39, 0xBF, 0xFB, 0x31, 0x26, 0xA2, 0x27, 0x37, 0x97, 0xD1, 0x5B,</div>
<div class="line"> 0xCF, 0x9E, 0x67, 0x30, 0xA6, 0x66, 0x8C, 0x99, 0xC9, 0xC8, 0x45, 0x9E, 0x6B, 0x3F, 0x5F, 0x74,</div>
<div class="line"> 0xA6, 0x94, 0x5E, 0xDB, 0xFF, 0xB2, 0xE6, 0xE7, 0xE7, 0xF9, 0xDE, 0xD6, 0xD6, 0x96, 0xDB, 0xD8,</div>
<div class="line"> 0xD8, 0x78, 0xBF, 0xA1, 0xA1, 0xC1, 0xDA, 0xDC, 0xDC, 0x2C, 0xEB, 0xED, 0xED, 0x15, 0x9B, 0xCD,</div>
<div class="line"> 0xE6, 0x4A, 0x83, 0xC1, 0xE0, 0x2E, 0x29, 0x29, 0x99, 0xD6, 0x6A, 0xB5, 0x4F, 0x75, 0x3A, 0x9D,</div>
<div class="line"> 0x61, 0x75, 0x75, 0x95, 0xB5, 0xB7, 0xB7, 0xDF, 0xC8, 0xD1, 0xD4, 0xD4, 0xF4, 0xB0, 0xBA, 0xBA,</div>
<div class="line"> 0xFA, 0x83, 0xD5, 0x6A, 0xFD, 0x5A, 0x5E, 0x5E, 0x9E, 0x28, 0x2D, 0x2D, 0x0D, 0x10, 0xC6, 0x4B,</div>
<div class="line"> 0x98, 0x78, 0x5E, 0x5E, 0xDE, 0x95, 0x42, 0xA1, 0x40, 0x4E, 0x4E, 0xCE, 0x65, 0x76, 0x76, 0xF6,</div>
<div class="line"> 0x47, 0xB5, 0x5A, 0x6D, 0x4F, 0x26, 0x93, 0xA2, 0xD6, 0xD6, 0x56, 0x8E, 0x6D, 0x69, 0x69, 0xD1,</div>
<div class="line"> 0x11, 0x36, 0x62, 0xB1, 0x58, 0x60, 0x32, 0x99, 0xA0, 0xD7, 0xEB, 0x51, 0x58, 0x58, 0x88, 0xFC,</div>
<div class="line"> 0xFC, 0x7C, 0x10, 0x16, 0x02, 0x56, 0x2E, 0x97, 0x43, 0x2A, 0x95, 0x42, 0x2C, 0x16, 0x23, 0x33,</div>
<div class="line"> 0x33, 0x33, 0xAE, 0x52, 0xA9, 0x1E, 0x64, 0x65, 0x65, 0x71, 0x7C, 0x7D, 0x7D, 0xBD, 0x93, 0xEA,</div>
<div class="line"> 0xFE, 0x30, 0x1A, 0x8D, 0xE8, 0xEC, 0xEC, 0xC4, 0xE2, 0xE2, 0x22, 0x6A, 0x6A, 0x6A, 0x40, 0x39,</div>
<div class="line"> 0x41, 0xB5, 0x38, 0x4E, 0xC8, 0x33, 0x3C, 0x3C, 0x0C, 0x87, 0xC3, 0xC1, 0x6B, 0x54, 0x54, 0x54,</div>
<div class="line"> 0xBC, 0xE9, 0xEB, 0xEB, 0x93, 0x5F, 0x5C, 0x5C, 0x30, 0x8A, 0x9D, 0x2E, 0x2B, 0x2B, 0xBB, 0xA2,</div>
<div class="line"> 0x3E, 0x41, 0xBD, 0x21, 0x1E, 0x8F, 0x63, 0x6A, 0x6A, 0x0A, 0x81, 0x40, 0x00, 0x94, 0x1B, 0x3D,</div>
<div class="line"> 0x3D, 0x3D, 0x42, 0x3C, 0x96, 0x96, 0x96, 0x70, 0x7E, 0x7E, 0x8E, 0xE3, 0xE3, 0x63, 0xF8, 0xFD,</div>
<div class="line"> 0xFE, 0xB4, 0xD7, 0xEB, 0xF5, 0x8F, 0x8F, 0x8F, 0x5B, 0x68, 0x5E, 0x6F, 0x05, 0xCE, 0xB4, 0xE3,</div>
<div class="line"> 0xE8, 0xE8, 0x08, 0x27, 0x27, 0x27, 0xD8, 0xDF, 0xDF, 0xC7, 0xD9, 0xD9, 0x19, 0x6C, 0x36, 0x1B,</div>
<div class="line"> 0x36, 0x36, 0x36, 0x38, 0x9F, 0x85, 0x85, 0x05, 0xAC, 0xAF, 0xAF, 0x23, 0x1A, 0x8D, 0x22, 0x91,</div>
<div class="line"> 0x48, 0x20, 0x16, 0x8B, 0xFD, 0xDA, 0xDA, 0xDA, 0x7A, 0x41, 0x33, 0x7E, 0x57, 0x50, 0x50, 0x80,</div>
<div class="line"> 0x89, 0x89, 0x09, 0x84, 0xC3, 0x61, 0x6C, 0x6F, 0x6F, 0x23, 0x12, 0x89, 0xE0, 0xE0, 0xE0, 0x00,</div>
<div class="line"> 0x43, 0x43, 0x43, 0x58, 0x5E, 0x5E, 0xE6, 0x9C, 0x7D, 0x3E, 0x1F, 0x46, 0x47, 0x47, 0x79, 0xBE,</div>
<div class="line"> 0xBD, 0xBD, 0x3D, 0xE1, 0x3C, 0x1D, 0x0C, 0x06, 0x9F, 0x10, 0xB7, 0xC7, 0x84, 0x4F, 0xF6, 0xF7,</div>
<div class="line"> 0xF7, 0x63, 0x60, 0x60, 0x00, 0x83, 0x83, 0x83, 0x18, 0x19, 0x19, 0xC1, 0xDC, 0xDC, 0x1C, 0x8F,</div>
<div class="line"> 0x17, 0x7C, 0xA4, 0x27, 0xE7, 0x34, 0x39, 0x39, 0x89, 0x9D, 0x9D, 0x1D, 0x6E, 0x54, 0xE3, 0x13,</div>
<div class="line"> 0xE5, 0x34, 0x11, 0x37, 0x49, 0x51, 0x51, 0xD1, 0x4B, 0xA5, 0x52, 0xF9, 0x45, 0x26, 0x93, 0x5D,</div>
<div class="line"> 0x0A, 0xF3, 0x92, 0x48, 0x24, 0xA0, 0x6F, 0x14, 0x17, 0x17, 0xA3, 0xB6, 0xB6, 0x16, 0x5D, 0x5D,</div>
<div class="line"> 0x5D, 0x7C, 0x1E, 0xBB, 0xBB, 0xBB, 0x9C, 0xD7, 0xE1, 0xE1, 0x21, 0x42, 0xA1, 0xD0, 0x6B, 0xD2,</div>
<div class="line"> 0x45, 0x4C, 0x33, 0x12, 0x34, 0xCC, 0xA0, 0x19, 0x54, 0x92, 0x56, 0x0E, 0xD2, 0xD9, 0x43, 0xF8,</div>
<div class="line"> 0xCF, 0x82, 0x56, 0xC2, 0xDC, 0xEB, 0xEA, 0xEA, 0x38, 0x7E, 0x6C, 0x6C, 0x4C, 0xE0, 0xFE, 0x9D,</div>
<div class="line"> 0xB8, 0xBF, 0xA7, 0xFA, 0xAF, 0x56, 0x56, 0x56, 0xEE, 0x6D, 0x6E, 0x6E, 0xDE, 0xB8, 0x47, 0x55,</div>
<div class="line"> 0x55, 0x55, 0x6C, 0x66, 0x66, 0x46, 0x44, 0xDA, 0x3B, 0x34, 0x1A, 0x4D, 0x94, 0xB0, 0x3F, 0x09,</div>
<div class="line"> 0x7B, 0x45, 0xBD, 0xA5, 0x5D, 0x2E, 0x57, 0x8C, 0x7A, 0x73, 0xD9, 0xED, 0xF6, 0x3B, 0x84, 0xFF,</div>
<div class="line"> 0xE7, 0x7D, 0xA6, 0x3A, 0x2C, 0x95, 0x4A, 0xB1, 0x8E, 0x8E, 0x0E, 0x6D, 0x77, 0x77, 0xB7, 0xCD,</div>
<div class="line"> 0xE9, 0x74, 0x3E, 0x73, 0xBB, 0xDD, 0x8F, 0x3C, 0x1E, 0x8F, 0xE6, 0xF4, 0xF4, 0x94, 0xAD, 0xAD,</div>
<div class="line"> 0xAD, 0xDD, 0xDE, 0xCF, 0x73, 0x0B, 0x0B, 0xB8, 0xB6, 0xE0, 0x5D, 0xC6, 0x66, 0xC5, 0xE4, 0x10,</div>
<div class="line"> 0x4C, 0xF4, 0xF7, 0xD8, 0x59, 0xF2, 0x7F, 0xA3, 0xB8, 0xB4, 0xFC, 0x0F, 0xEE, 0x37, 0x70, 0xEC,</div>
<div class="line"> 0x16, 0x4A, 0x7E, 0x04, 0x00, 0x00</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><a class="code hl_class" href="class_async_web_server_response.html">AsyncWebServerResponse</a> *response = request-&gt;<a class="code hl_function" href="class_async_web_server_request.html#a4e62af5ec7e0d678f867986573f6ce21">beginResponse_P</a>(200, <span class="stringliteral">&quot;image/x-icon&quot;</span>, favicon_ico_gz, favicon_ico_gz_len);</div>
<div class="line">response-&gt;<a class="code hl_function" href="class_async_web_server_response.html#a56c370dbf9c75c17cb3cd8d22239205a">addHeader</a>(<span class="stringliteral">&quot;Content-Encoding&quot;</span>, <span class="stringliteral">&quot;gzip&quot;</span>);</div>
<div class="line">request-&gt;<a class="code hl_function" href="class_async_web_server_request.html#a4247e73eb8d8c7b386f9bb4ab10f3856">send</a>(response);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md35"></a>
Respond with content coming from a Stream</h2>
<div class="fragment"><div class="line"><span class="comment">//read 12 bytes from Serial and send them as Content Type text/plain</span></div>
<div class="line">request-&gt;<a class="code hl_function" href="class_async_web_server_request.html#a4247e73eb8d8c7b386f9bb4ab10f3856">send</a>(Serial, <span class="stringliteral">&quot;text/plain&quot;</span>, 12);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md36"></a>
Respond with content coming from a Stream and extra headers</h2>
<div class="fragment"><div class="line"><span class="comment">//read 12 bytes from Serial and send them as Content Type text/plain</span></div>
<div class="line"><a class="code hl_class" href="class_async_web_server_response.html">AsyncWebServerResponse</a> *response = request-&gt;<a class="code hl_function" href="class_async_web_server_request.html#a133a829c7bc4c486ed41f3476666ea51">beginResponse</a>(Serial, <span class="stringliteral">&quot;text/plain&quot;</span>, 12);</div>
<div class="line">response-&gt;<a class="code hl_function" href="class_async_web_server_response.html#a56c370dbf9c75c17cb3cd8d22239205a">addHeader</a>(<span class="stringliteral">&quot;Server&quot;</span>,<span class="stringliteral">&quot;ESP Async Web Server&quot;</span>);</div>
<div class="line">request-&gt;<a class="code hl_function" href="class_async_web_server_request.html#a4247e73eb8d8c7b386f9bb4ab10f3856">send</a>(response);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md37"></a>
Respond with content coming from a Stream containing templates</h2>
<div class="fragment"><div class="line">String processor(<span class="keyword">const</span> String&amp; var)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">if</span>(var == <span class="stringliteral">&quot;HELLO_FROM_TEMPLATE&quot;</span>)</div>
<div class="line">    <span class="keywordflow">return</span> F(<span class="stringliteral">&quot;Hello world!&quot;</span>);</div>
<div class="line">  <span class="keywordflow">return</span> String();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// ...</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">//read 12 bytes from Serial and send them as Content Type text/plain</span></div>
<div class="line">request-&gt;<a class="code hl_function" href="class_async_web_server_request.html#a4247e73eb8d8c7b386f9bb4ab10f3856">send</a>(Serial, <span class="stringliteral">&quot;text/plain&quot;</span>, 12, processor);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md38"></a>
Respond with content coming from a Stream containing templates and extra headers</h2>
<div class="fragment"><div class="line">String processor(<span class="keyword">const</span> String&amp; var)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">if</span>(var == <span class="stringliteral">&quot;HELLO_FROM_TEMPLATE&quot;</span>)</div>
<div class="line">    <span class="keywordflow">return</span> F(<span class="stringliteral">&quot;Hello world!&quot;</span>);</div>
<div class="line">  <span class="keywordflow">return</span> String();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// ...</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">//read 12 bytes from Serial and send them as Content Type text/plain</span></div>
<div class="line"><a class="code hl_class" href="class_async_web_server_response.html">AsyncWebServerResponse</a> *response = request-&gt;<a class="code hl_function" href="class_async_web_server_request.html#a133a829c7bc4c486ed41f3476666ea51">beginResponse</a>(Serial, <span class="stringliteral">&quot;text/plain&quot;</span>, 12, processor);</div>
<div class="line">response-&gt;<a class="code hl_function" href="class_async_web_server_response.html#a56c370dbf9c75c17cb3cd8d22239205a">addHeader</a>(<span class="stringliteral">&quot;Server&quot;</span>,<span class="stringliteral">&quot;ESP Async Web Server&quot;</span>);</div>
<div class="line">request-&gt;<a class="code hl_function" href="class_async_web_server_request.html#a4247e73eb8d8c7b386f9bb4ab10f3856">send</a>(response);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md39"></a>
Respond with content coming from a File</h2>
<div class="fragment"><div class="line"><span class="comment">//Send index.htm with default content type</span></div>
<div class="line">request-&gt;<a class="code hl_function" href="class_async_web_server_request.html#a4247e73eb8d8c7b386f9bb4ab10f3856">send</a>(SPIFFS, <span class="stringliteral">&quot;/index.htm&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">//Send index.htm as text</span></div>
<div class="line">request-&gt;<a class="code hl_function" href="class_async_web_server_request.html#a4247e73eb8d8c7b386f9bb4ab10f3856">send</a>(SPIFFS, <span class="stringliteral">&quot;/index.htm&quot;</span>, <span class="stringliteral">&quot;text/plain&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">//Download index.htm</span></div>
<div class="line">request-&gt;<a class="code hl_function" href="class_async_web_server_request.html#a4247e73eb8d8c7b386f9bb4ab10f3856">send</a>(SPIFFS, <span class="stringliteral">&quot;/index.htm&quot;</span>, String(), <span class="keyword">true</span>);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md40"></a>
Respond with content coming from a File and extra headers</h2>
<div class="fragment"><div class="line"><span class="comment">//Send index.htm with default content type</span></div>
<div class="line"><a class="code hl_class" href="class_async_web_server_response.html">AsyncWebServerResponse</a> *response = request-&gt;<a class="code hl_function" href="class_async_web_server_request.html#a133a829c7bc4c486ed41f3476666ea51">beginResponse</a>(SPIFFS, <span class="stringliteral">&quot;/index.htm&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">//Send index.htm as text</span></div>
<div class="line"><a class="code hl_class" href="class_async_web_server_response.html">AsyncWebServerResponse</a> *response = request-&gt;<a class="code hl_function" href="class_async_web_server_request.html#a133a829c7bc4c486ed41f3476666ea51">beginResponse</a>(SPIFFS, <span class="stringliteral">&quot;/index.htm&quot;</span>, <span class="stringliteral">&quot;text/plain&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">//Download index.htm</span></div>
<div class="line"><a class="code hl_class" href="class_async_web_server_response.html">AsyncWebServerResponse</a> *response = request-&gt;<a class="code hl_function" href="class_async_web_server_request.html#a133a829c7bc4c486ed41f3476666ea51">beginResponse</a>(SPIFFS, <span class="stringliteral">&quot;/index.htm&quot;</span>, String(), <span class="keyword">true</span>);</div>
<div class="line"> </div>
<div class="line">response-&gt;<a class="code hl_function" href="class_async_web_server_response.html#a56c370dbf9c75c17cb3cd8d22239205a">addHeader</a>(<span class="stringliteral">&quot;Server&quot;</span>,<span class="stringliteral">&quot;ESP Async Web Server&quot;</span>);</div>
<div class="line">request-&gt;<a class="code hl_function" href="class_async_web_server_request.html#a4247e73eb8d8c7b386f9bb4ab10f3856">send</a>(response);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md41"></a>
Respond with content coming from a File containing templates</h2>
<p>Internally uses Chunked Response.</p>
<p>Index.htm contents: </p><div class="fragment"><div class="line">%HELLO_FROM_TEMPLATE%</div>
</div><!-- fragment --><p>Somewhere in source files: </p><div class="fragment"><div class="line">String processor(<span class="keyword">const</span> String&amp; var)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">if</span>(var == <span class="stringliteral">&quot;HELLO_FROM_TEMPLATE&quot;</span>)</div>
<div class="line">    <span class="keywordflow">return</span> F(<span class="stringliteral">&quot;Hello world!&quot;</span>);</div>
<div class="line">  <span class="keywordflow">return</span> String();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// ...</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">//Send index.htm with template processor function</span></div>
<div class="line">request-&gt;<a class="code hl_function" href="class_async_web_server_request.html#a4247e73eb8d8c7b386f9bb4ab10f3856">send</a>(SPIFFS, <span class="stringliteral">&quot;/index.htm&quot;</span>, String(), <span class="keyword">false</span>, processor);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md42"></a>
Respond with content using a callback</h2>
<div class="fragment"><div class="line"><span class="comment">//send 128 bytes as plain text</span></div>
<div class="line">request-&gt;<a class="code hl_function" href="class_async_web_server_request.html#a4247e73eb8d8c7b386f9bb4ab10f3856">send</a>(<span class="stringliteral">&quot;text/plain&quot;</span>, 128, [](uint8_t *<a class="code hl_variable" href="c_j_s_o_n_8h.html#aff2566f4c366b48d73479bef43ee4d2e">buffer</a>, <span class="keywordtype">size_t</span> maxLen, <span class="keywordtype">size_t</span> <a class="code hl_variable" href="c_j_s_o_n_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a>) -&gt; <span class="keywordtype">size_t</span> {</div>
<div class="line">  <span class="comment">//Write up to &quot;maxLen&quot; bytes into &quot;buffer&quot; and return the amount written.</span></div>
<div class="line">  <span class="comment">//index equals the amount of bytes that have been already sent</span></div>
<div class="line">  <span class="comment">//You will not be asked for more bytes once the content length has been reached.</span></div>
<div class="line">  <span class="comment">//Keep in mind that you can not delay or yield waiting for more data!</span></div>
<div class="line">  <span class="comment">//Send what you currently have and you will be asked for more again</span></div>
<div class="line">  <span class="keywordflow">return</span> mySource.read(<a class="code hl_variable" href="c_j_s_o_n_8h.html#aff2566f4c366b48d73479bef43ee4d2e">buffer</a>, maxLen);</div>
<div class="line">});</div>
<div class="ttc" id="ac_j_s_o_n_8h_html_aff2566f4c366b48d73479bef43ee4d2e"><div class="ttname"><a href="c_j_s_o_n_8h.html#aff2566f4c366b48d73479bef43ee4d2e">buffer</a></div><div class="ttdeci">char * buffer</div><div class="ttdef"><b>Definition</b> <a href="c_j_s_o_n_8h_source.html#l00163">cJSON.h:163</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md43"></a>
Respond with content using a callback and extra headers</h2>
<div class="fragment"><div class="line"><span class="comment">//send 128 bytes as plain text</span></div>
<div class="line"><a class="code hl_class" href="class_async_web_server_response.html">AsyncWebServerResponse</a> *response = request-&gt;<a class="code hl_function" href="class_async_web_server_request.html#a133a829c7bc4c486ed41f3476666ea51">beginResponse</a>(<span class="stringliteral">&quot;text/plain&quot;</span>, 128, [](uint8_t *<a class="code hl_variable" href="c_j_s_o_n_8h.html#aff2566f4c366b48d73479bef43ee4d2e">buffer</a>, <span class="keywordtype">size_t</span> maxLen, <span class="keywordtype">size_t</span> <a class="code hl_variable" href="c_j_s_o_n_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a>) -&gt; <span class="keywordtype">size_t</span> {</div>
<div class="line">  <span class="comment">//Write up to &quot;maxLen&quot; bytes into &quot;buffer&quot; and return the amount written.</span></div>
<div class="line">  <span class="comment">//index equals the amount of bytes that have been already sent</span></div>
<div class="line">  <span class="comment">//You will not be asked for more bytes once the content length has been reached.</span></div>
<div class="line">  <span class="comment">//Keep in mind that you can not delay or yield waiting for more data!</span></div>
<div class="line">  <span class="comment">//Send what you currently have and you will be asked for more again</span></div>
<div class="line">  <span class="keywordflow">return</span> mySource.read(<a class="code hl_variable" href="c_j_s_o_n_8h.html#aff2566f4c366b48d73479bef43ee4d2e">buffer</a>, maxLen);</div>
<div class="line">});</div>
<div class="line">response-&gt;<a class="code hl_function" href="class_async_web_server_response.html#a56c370dbf9c75c17cb3cd8d22239205a">addHeader</a>(<span class="stringliteral">&quot;Server&quot;</span>,<span class="stringliteral">&quot;ESP Async Web Server&quot;</span>);</div>
<div class="line">request-&gt;<a class="code hl_function" href="class_async_web_server_request.html#a4247e73eb8d8c7b386f9bb4ab10f3856">send</a>(response);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md44"></a>
Respond with content using a callback containing templates</h2>
<div class="fragment"><div class="line">String processor(<span class="keyword">const</span> String&amp; var)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">if</span>(var == <span class="stringliteral">&quot;HELLO_FROM_TEMPLATE&quot;</span>)</div>
<div class="line">    <span class="keywordflow">return</span> F(<span class="stringliteral">&quot;Hello world!&quot;</span>);</div>
<div class="line">  <span class="keywordflow">return</span> String();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// ...</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">//send 128 bytes as plain text</span></div>
<div class="line">request-&gt;<a class="code hl_function" href="class_async_web_server_request.html#a4247e73eb8d8c7b386f9bb4ab10f3856">send</a>(<span class="stringliteral">&quot;text/plain&quot;</span>, 128, [](uint8_t *<a class="code hl_variable" href="c_j_s_o_n_8h.html#aff2566f4c366b48d73479bef43ee4d2e">buffer</a>, <span class="keywordtype">size_t</span> maxLen, <span class="keywordtype">size_t</span> <a class="code hl_variable" href="c_j_s_o_n_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a>) -&gt; <span class="keywordtype">size_t</span> {</div>
<div class="line">  <span class="comment">//Write up to &quot;maxLen&quot; bytes into &quot;buffer&quot; and return the amount written.</span></div>
<div class="line">  <span class="comment">//index equals the amount of bytes that have been already sent</span></div>
<div class="line">  <span class="comment">//You will not be asked for more bytes once the content length has been reached.</span></div>
<div class="line">  <span class="comment">//Keep in mind that you can not delay or yield waiting for more data!</span></div>
<div class="line">  <span class="comment">//Send what you currently have and you will be asked for more again</span></div>
<div class="line">  <span class="keywordflow">return</span> mySource.read(<a class="code hl_variable" href="c_j_s_o_n_8h.html#aff2566f4c366b48d73479bef43ee4d2e">buffer</a>, maxLen);</div>
<div class="line">}, processor);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md45"></a>
Respond with content using a callback containing templates and extra headers</h2>
<div class="fragment"><div class="line">String processor(<span class="keyword">const</span> String&amp; var)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">if</span>(var == <span class="stringliteral">&quot;HELLO_FROM_TEMPLATE&quot;</span>)</div>
<div class="line">    <span class="keywordflow">return</span> F(<span class="stringliteral">&quot;Hello world!&quot;</span>);</div>
<div class="line">  <span class="keywordflow">return</span> String();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// ...</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">//send 128 bytes as plain text</span></div>
<div class="line"><a class="code hl_class" href="class_async_web_server_response.html">AsyncWebServerResponse</a> *response = request-&gt;<a class="code hl_function" href="class_async_web_server_request.html#a133a829c7bc4c486ed41f3476666ea51">beginResponse</a>(<span class="stringliteral">&quot;text/plain&quot;</span>, 128, [](uint8_t *<a class="code hl_variable" href="c_j_s_o_n_8h.html#aff2566f4c366b48d73479bef43ee4d2e">buffer</a>, <span class="keywordtype">size_t</span> maxLen, <span class="keywordtype">size_t</span> <a class="code hl_variable" href="c_j_s_o_n_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a>) -&gt; <span class="keywordtype">size_t</span> {</div>
<div class="line">  <span class="comment">//Write up to &quot;maxLen&quot; bytes into &quot;buffer&quot; and return the amount written.</span></div>
<div class="line">  <span class="comment">//index equals the amount of bytes that have been already sent</span></div>
<div class="line">  <span class="comment">//You will not be asked for more bytes once the content length has been reached.</span></div>
<div class="line">  <span class="comment">//Keep in mind that you can not delay or yield waiting for more data!</span></div>
<div class="line">  <span class="comment">//Send what you currently have and you will be asked for more again</span></div>
<div class="line">  <span class="keywordflow">return</span> mySource.read(<a class="code hl_variable" href="c_j_s_o_n_8h.html#aff2566f4c366b48d73479bef43ee4d2e">buffer</a>, maxLen);</div>
<div class="line">}, processor);</div>
<div class="line">response-&gt;<a class="code hl_function" href="class_async_web_server_response.html#a56c370dbf9c75c17cb3cd8d22239205a">addHeader</a>(<span class="stringliteral">&quot;Server&quot;</span>,<span class="stringliteral">&quot;ESP Async Web Server&quot;</span>);</div>
<div class="line">request-&gt;<a class="code hl_function" href="class_async_web_server_request.html#a4247e73eb8d8c7b386f9bb4ab10f3856">send</a>(response);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md46"></a>
Chunked Response</h2>
<p>Used when content length is unknown. Works best if the client supports HTTP/1.1 </p><div class="fragment"><div class="line"><a class="code hl_class" href="class_async_web_server_response.html">AsyncWebServerResponse</a> *response = request-&gt;<a class="code hl_function" href="class_async_web_server_request.html#a633b203d16330c6eee5041d8b2bc7017">beginChunkedResponse</a>(<span class="stringliteral">&quot;text/plain&quot;</span>, [](uint8_t *<a class="code hl_variable" href="c_j_s_o_n_8h.html#aff2566f4c366b48d73479bef43ee4d2e">buffer</a>, <span class="keywordtype">size_t</span> maxLen, <span class="keywordtype">size_t</span> <a class="code hl_variable" href="c_j_s_o_n_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a>) -&gt; <span class="keywordtype">size_t</span> {</div>
<div class="line">  <span class="comment">//Write up to &quot;maxLen&quot; bytes into &quot;buffer&quot; and return the amount written.</span></div>
<div class="line">  <span class="comment">//index equals the amount of bytes that have been already sent</span></div>
<div class="line">  <span class="comment">//You will be asked for more data until 0 is returned</span></div>
<div class="line">  <span class="comment">//Keep in mind that you can not delay or yield waiting for more data!</span></div>
<div class="line">  <span class="keywordflow">return</span> mySource.read(<a class="code hl_variable" href="c_j_s_o_n_8h.html#aff2566f4c366b48d73479bef43ee4d2e">buffer</a>, maxLen);</div>
<div class="line">});</div>
<div class="line">response-&gt;<a class="code hl_function" href="class_async_web_server_response.html#a56c370dbf9c75c17cb3cd8d22239205a">addHeader</a>(<span class="stringliteral">&quot;Server&quot;</span>,<span class="stringliteral">&quot;ESP Async Web Server&quot;</span>);</div>
<div class="line">request-&gt;<a class="code hl_function" href="class_async_web_server_request.html#a4247e73eb8d8c7b386f9bb4ab10f3856">send</a>(response);</div>
<div class="ttc" id="aclass_async_web_server_request_html_a633b203d16330c6eee5041d8b2bc7017"><div class="ttname"><a href="class_async_web_server_request.html#a633b203d16330c6eee5041d8b2bc7017">AsyncWebServerRequest::beginChunkedResponse</a></div><div class="ttdeci">AsyncWebServerResponse * beginChunkedResponse(const String &amp;contentType, AwsResponseFiller callback, AwsTemplateProcessor templateCallback=nullptr)</div><div class="ttdef"><b>Definition</b> <a href="_web_request_8cpp_source.html#l00753">WebRequest.cpp:753</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md47"></a>
Chunked Response containing templates</h2>
<p>Used when content length is unknown. Works best if the client supports HTTP/1.1 </p><div class="fragment"><div class="line">String processor(<span class="keyword">const</span> String&amp; var)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">if</span>(var == <span class="stringliteral">&quot;HELLO_FROM_TEMPLATE&quot;</span>)</div>
<div class="line">    <span class="keywordflow">return</span> F(<span class="stringliteral">&quot;Hello world!&quot;</span>);</div>
<div class="line">  <span class="keywordflow">return</span> String();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// ...</span></div>
<div class="line"> </div>
<div class="line"><a class="code hl_class" href="class_async_web_server_response.html">AsyncWebServerResponse</a> *response = request-&gt;<a class="code hl_function" href="class_async_web_server_request.html#a633b203d16330c6eee5041d8b2bc7017">beginChunkedResponse</a>(<span class="stringliteral">&quot;text/plain&quot;</span>, [](uint8_t *<a class="code hl_variable" href="c_j_s_o_n_8h.html#aff2566f4c366b48d73479bef43ee4d2e">buffer</a>, <span class="keywordtype">size_t</span> maxLen, <span class="keywordtype">size_t</span> <a class="code hl_variable" href="c_j_s_o_n_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a>) -&gt; <span class="keywordtype">size_t</span> {</div>
<div class="line">  <span class="comment">//Write up to &quot;maxLen&quot; bytes into &quot;buffer&quot; and return the amount written.</span></div>
<div class="line">  <span class="comment">//index equals the amount of bytes that have been already sent</span></div>
<div class="line">  <span class="comment">//You will be asked for more data until 0 is returned</span></div>
<div class="line">  <span class="comment">//Keep in mind that you can not delay or yield waiting for more data!</span></div>
<div class="line">  <span class="keywordflow">return</span> mySource.read(<a class="code hl_variable" href="c_j_s_o_n_8h.html#aff2566f4c366b48d73479bef43ee4d2e">buffer</a>, maxLen);</div>
<div class="line">}, processor);</div>
<div class="line">response-&gt;<a class="code hl_function" href="class_async_web_server_response.html#a56c370dbf9c75c17cb3cd8d22239205a">addHeader</a>(<span class="stringliteral">&quot;Server&quot;</span>,<span class="stringliteral">&quot;ESP Async Web Server&quot;</span>);</div>
<div class="line">request-&gt;<a class="code hl_function" href="class_async_web_server_request.html#a4247e73eb8d8c7b386f9bb4ab10f3856">send</a>(response);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md48"></a>
Print to response</h2>
<div class="fragment"><div class="line"><a class="code hl_class" href="class_async_response_stream.html">AsyncResponseStream</a> *response = request-&gt;<a class="code hl_function" href="class_async_web_server_request.html#a8f8f7c41b9b73cbcad15442b3bf53ccb">beginResponseStream</a>(<span class="stringliteral">&quot;text/html&quot;</span>);</div>
<div class="line">response-&gt;<a class="code hl_function" href="class_async_web_server_response.html#a56c370dbf9c75c17cb3cd8d22239205a">addHeader</a>(<span class="stringliteral">&quot;Server&quot;</span>,<span class="stringliteral">&quot;ESP Async Web Server&quot;</span>);</div>
<div class="line">response-&gt;printf(<span class="stringliteral">&quot;&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;&lt;title&gt;Webpage at %s&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&quot;</span>, request-&gt;<a class="code hl_function" href="class_async_web_server_request.html#a2dcf10119dc5b3e87aca8d47fcde6482">url</a>().c_str());</div>
<div class="line"> </div>
<div class="line">response-&gt;print(<span class="stringliteral">&quot;&lt;h2&gt;Hello &quot;</span>);</div>
<div class="line">response-&gt;print(request-&gt;<a class="code hl_function" href="class_async_web_server_request.html#af7a5c5aa3942296a06b6b83838e1555f">client</a>()-&gt;<a class="code hl_function" href="class_async_client.html#af3c1c33653e9fea15744a062da459d64">remoteIP</a>());</div>
<div class="line">response-&gt;print(<span class="stringliteral">&quot;&lt;/h2&gt;&quot;</span>);</div>
<div class="line"> </div>
<div class="line">response-&gt;print(<span class="stringliteral">&quot;&lt;h3&gt;General&lt;/h3&gt;&quot;</span>);</div>
<div class="line">response-&gt;print(<span class="stringliteral">&quot;&lt;ul&gt;&quot;</span>);</div>
<div class="line">response-&gt;printf(<span class="stringliteral">&quot;&lt;li&gt;Version: HTTP/1.%u&lt;/li&gt;&quot;</span>, request-&gt;<a class="code hl_function" href="class_async_web_server_request.html#afba06f62d04d4c69448094baccaae920">version</a>());</div>
<div class="line">response-&gt;printf(<span class="stringliteral">&quot;&lt;li&gt;Method: %s&lt;/li&gt;&quot;</span>, request-&gt;<a class="code hl_function" href="class_async_web_server_request.html#afc49e90174b643ae55d609738a1021e1">methodToString</a>());</div>
<div class="line">response-&gt;printf(<span class="stringliteral">&quot;&lt;li&gt;URL: %s&lt;/li&gt;&quot;</span>, request-&gt;<a class="code hl_function" href="class_async_web_server_request.html#a2dcf10119dc5b3e87aca8d47fcde6482">url</a>().c_str());</div>
<div class="line">response-&gt;printf(<span class="stringliteral">&quot;&lt;li&gt;Host: %s&lt;/li&gt;&quot;</span>, request-&gt;<a class="code hl_function" href="class_async_web_server_request.html#acc62fc3d9916da0e4e223c8484eeeb37">host</a>().c_str());</div>
<div class="line">response-&gt;printf(<span class="stringliteral">&quot;&lt;li&gt;ContentType: %s&lt;/li&gt;&quot;</span>, request-&gt;<a class="code hl_function" href="class_async_web_server_request.html#af244fcb8aa11353317bf85563057167c">contentType</a>().c_str());</div>
<div class="line">response-&gt;printf(<span class="stringliteral">&quot;&lt;li&gt;ContentLength: %u&lt;/li&gt;&quot;</span>, request-&gt;<a class="code hl_function" href="class_async_web_server_request.html#a270dde8a7fdd97d967f390a0668aaa19">contentLength</a>());</div>
<div class="line">response-&gt;printf(<span class="stringliteral">&quot;&lt;li&gt;Multipart: %s&lt;/li&gt;&quot;</span>, request-&gt;<a class="code hl_function" href="class_async_web_server_request.html#a4637623b3c93599cc4e17191601963d6">multipart</a>()?<span class="stringliteral">&quot;true&quot;</span>:<span class="stringliteral">&quot;false&quot;</span>);</div>
<div class="line">response-&gt;print(<span class="stringliteral">&quot;&lt;/ul&gt;&quot;</span>);</div>
<div class="line"> </div>
<div class="line">response-&gt;print(<span class="stringliteral">&quot;&lt;h3&gt;Headers&lt;/h3&gt;&quot;</span>);</div>
<div class="line">response-&gt;print(<span class="stringliteral">&quot;&lt;ul&gt;&quot;</span>);</div>
<div class="line"><span class="keywordtype">int</span> headers = request-&gt;<a class="code hl_function" href="class_async_web_server_request.html#a12daaa25afc6107030c4cd39623933a8">headers</a>();</div>
<div class="line"><span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;headers;i++){</div>
<div class="line">  <a class="code hl_class" href="class_async_web_header.html">AsyncWebHeader</a>* h = request-&gt;<a class="code hl_function" href="class_async_web_server_request.html#acc847b55e687445eb7baff15b4d197c8">getHeader</a>(i);</div>
<div class="line">  response-&gt;printf(<span class="stringliteral">&quot;&lt;li&gt;%s: %s&lt;/li&gt;&quot;</span>, h-&gt;<a class="code hl_function" href="class_async_web_header.html#af8f51a50de29048841d099773e4508b2">name</a>().c_str(), h-&gt;<a class="code hl_function" href="class_async_web_header.html#a9ad7d9f7ad2044b99c2a00bdb5df2d50">value</a>().c_str());</div>
<div class="line">}</div>
<div class="line">response-&gt;print(<span class="stringliteral">&quot;&lt;/ul&gt;&quot;</span>);</div>
<div class="line"> </div>
<div class="line">response-&gt;print(<span class="stringliteral">&quot;&lt;h3&gt;Parameters&lt;/h3&gt;&quot;</span>);</div>
<div class="line">response-&gt;print(<span class="stringliteral">&quot;&lt;ul&gt;&quot;</span>);</div>
<div class="line"><span class="keywordtype">int</span> params = request-&gt;<a class="code hl_function" href="class_async_web_server_request.html#a647845403d17d1418c6488c040c53cdb">params</a>();</div>
<div class="line"><span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;params;i++){</div>
<div class="line">  <a class="code hl_class" href="class_async_web_parameter.html">AsyncWebParameter</a>* p = request-&gt;<a class="code hl_function" href="class_async_web_server_request.html#af8bf81f74de6f1961afdd631eed9bb46">getParam</a>(i);</div>
<div class="line">  <span class="keywordflow">if</span>(p-&gt;<a class="code hl_function" href="class_async_web_parameter.html#a303e06c6c9379c1b2756943f42180e7a">isFile</a>()){</div>
<div class="line">    response-&gt;printf(<span class="stringliteral">&quot;&lt;li&gt;FILE[%s]: %s, size: %u&lt;/li&gt;&quot;</span>, p-&gt;<a class="code hl_function" href="class_async_web_parameter.html#a8810765851357e42bc6cf44e35a4d1b4">name</a>().c_str(), p-&gt;<a class="code hl_function" href="class_async_web_parameter.html#abf1e0d5f55490b8914370df199b195ae">value</a>().c_str(), p-&gt;<a class="code hl_function" href="class_async_web_parameter.html#af1e0f840977c185e8ec7522ecc1ab094">size</a>());</div>
<div class="line">  } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(p-&gt;<a class="code hl_function" href="class_async_web_parameter.html#a36b2d2f67b6e743ee6e43dffd5f8f0bf">isPost</a>()){</div>
<div class="line">    response-&gt;printf(<span class="stringliteral">&quot;&lt;li&gt;POST[%s]: %s&lt;/li&gt;&quot;</span>, p-&gt;<a class="code hl_function" href="class_async_web_parameter.html#a8810765851357e42bc6cf44e35a4d1b4">name</a>().c_str(), p-&gt;<a class="code hl_function" href="class_async_web_parameter.html#abf1e0d5f55490b8914370df199b195ae">value</a>().c_str());</div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    response-&gt;printf(<span class="stringliteral">&quot;&lt;li&gt;GET[%s]: %s&lt;/li&gt;&quot;</span>, p-&gt;<a class="code hl_function" href="class_async_web_parameter.html#a8810765851357e42bc6cf44e35a4d1b4">name</a>().c_str(), p-&gt;<a class="code hl_function" href="class_async_web_parameter.html#abf1e0d5f55490b8914370df199b195ae">value</a>().c_str());</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line">response-&gt;print(<span class="stringliteral">&quot;&lt;/ul&gt;&quot;</span>);</div>
<div class="line"> </div>
<div class="line">response-&gt;print(<span class="stringliteral">&quot;&lt;/body&gt;&lt;/html&gt;&quot;</span>);</div>
<div class="line"><span class="comment">//send the response last</span></div>
<div class="line">request-&gt;<a class="code hl_function" href="class_async_web_server_request.html#a4247e73eb8d8c7b386f9bb4ab10f3856">send</a>(response);</div>
<div class="ttc" id="aclass_async_client_html_af3c1c33653e9fea15744a062da459d64"><div class="ttname"><a href="class_async_client.html#af3c1c33653e9fea15744a062da459d64">AsyncClient::remoteIP</a></div><div class="ttdeci">IPAddress remoteIP()</div><div class="ttdef"><b>Definition</b> <a href="_async_t_c_p_8cpp_source.html#l01095">AsyncTCP.cpp:1095</a></div></div>
<div class="ttc" id="aclass_async_response_stream_html"><div class="ttname"><a href="class_async_response_stream.html">AsyncResponseStream</a></div><div class="ttdef"><b>Definition</b> <a href="_web_response_impl_8h_source.html#l00123">WebResponseImpl.h:123</a></div></div>
<div class="ttc" id="aclass_async_web_server_request_html_a12daaa25afc6107030c4cd39623933a8"><div class="ttname"><a href="class_async_web_server_request.html#a12daaa25afc6107030c4cd39623933a8">AsyncWebServerRequest::headers</a></div><div class="ttdeci">size_t headers() const</div><div class="ttdef"><b>Definition</b> <a href="_web_request_8cpp_source.html#l00588">WebRequest.cpp:588</a></div></div>
<div class="ttc" id="aclass_async_web_server_request_html_a270dde8a7fdd97d967f390a0668aaa19"><div class="ttname"><a href="class_async_web_server_request.html#a270dde8a7fdd97d967f390a0668aaa19">AsyncWebServerRequest::contentLength</a></div><div class="ttdeci">size_t contentLength() const</div><div class="ttdef"><b>Definition</b> <a href="_e_s_p_async_web_server_8h_source.html#l00216">ESPAsyncWebServer.h:216</a></div></div>
<div class="ttc" id="aclass_async_web_server_request_html_a2dcf10119dc5b3e87aca8d47fcde6482"><div class="ttname"><a href="class_async_web_server_request.html#a2dcf10119dc5b3e87aca8d47fcde6482">AsyncWebServerRequest::url</a></div><div class="ttdeci">const String &amp; url() const</div><div class="ttdef"><b>Definition</b> <a href="_e_s_p_async_web_server_8h_source.html#l00213">ESPAsyncWebServer.h:213</a></div></div>
<div class="ttc" id="aclass_async_web_server_request_html_a4637623b3c93599cc4e17191601963d6"><div class="ttname"><a href="class_async_web_server_request.html#a4637623b3c93599cc4e17191601963d6">AsyncWebServerRequest::multipart</a></div><div class="ttdeci">bool multipart() const</div><div class="ttdef"><b>Definition</b> <a href="_e_s_p_async_web_server_8h_source.html#l00217">ESPAsyncWebServer.h:217</a></div></div>
<div class="ttc" id="aclass_async_web_server_request_html_a647845403d17d1418c6488c040c53cdb"><div class="ttname"><a href="class_async_web_server_request.html#a647845403d17d1418c6488c040c53cdb">AsyncWebServerRequest::params</a></div><div class="ttdeci">size_t params() const</div><div class="ttdef"><b>Definition</b> <a href="_web_request_8cpp_source.html#l00649">WebRequest.cpp:649</a></div></div>
<div class="ttc" id="aclass_async_web_server_request_html_a8f8f7c41b9b73cbcad15442b3bf53ccb"><div class="ttname"><a href="class_async_web_server_request.html#a8f8f7c41b9b73cbcad15442b3bf53ccb">AsyncWebServerRequest::beginResponseStream</a></div><div class="ttdeci">AsyncResponseStream * beginResponseStream(const String &amp;contentType, size_t bufferSize=1460)</div><div class="ttdef"><b>Definition</b> <a href="_web_request_8cpp_source.html#l00759">WebRequest.cpp:759</a></div></div>
<div class="ttc" id="aclass_async_web_server_request_html_acc62fc3d9916da0e4e223c8484eeeb37"><div class="ttname"><a href="class_async_web_server_request.html#acc62fc3d9916da0e4e223c8484eeeb37">AsyncWebServerRequest::host</a></div><div class="ttdeci">const String &amp; host() const</div><div class="ttdef"><b>Definition</b> <a href="_e_s_p_async_web_server_8h_source.html#l00214">ESPAsyncWebServer.h:214</a></div></div>
<div class="ttc" id="aclass_async_web_server_request_html_acc847b55e687445eb7baff15b4d197c8"><div class="ttname"><a href="class_async_web_server_request.html#acc847b55e687445eb7baff15b4d197c8">AsyncWebServerRequest::getHeader</a></div><div class="ttdeci">AsyncWebHeader * getHeader(const String &amp;name) const</div><div class="ttdef"><b>Definition</b> <a href="_web_request_8cpp_source.html#l00621">WebRequest.cpp:621</a></div></div>
<div class="ttc" id="aclass_async_web_server_request_html_af244fcb8aa11353317bf85563057167c"><div class="ttname"><a href="class_async_web_server_request.html#af244fcb8aa11353317bf85563057167c">AsyncWebServerRequest::contentType</a></div><div class="ttdeci">const String &amp; contentType() const</div><div class="ttdef"><b>Definition</b> <a href="_e_s_p_async_web_server_8h_source.html#l00215">ESPAsyncWebServer.h:215</a></div></div>
<div class="ttc" id="aclass_async_web_server_request_html_af7a5c5aa3942296a06b6b83838e1555f"><div class="ttname"><a href="class_async_web_server_request.html#af7a5c5aa3942296a06b6b83838e1555f">AsyncWebServerRequest::client</a></div><div class="ttdeci">AsyncClient * client()</div><div class="ttdef"><b>Definition</b> <a href="_e_s_p_async_web_server_8h_source.html#l00210">ESPAsyncWebServer.h:210</a></div></div>
<div class="ttc" id="aclass_async_web_server_request_html_af8bf81f74de6f1961afdd631eed9bb46"><div class="ttname"><a href="class_async_web_server_request.html#af8bf81f74de6f1961afdd631eed9bb46">AsyncWebServerRequest::getParam</a></div><div class="ttdeci">AsyncWebParameter * getParam(const String &amp;name, bool post=false, bool file=false) const</div><div class="ttdef"><b>Definition</b> <a href="_web_request_8cpp_source.html#l00678">WebRequest.cpp:678</a></div></div>
<div class="ttc" id="aclass_async_web_server_request_html_afba06f62d04d4c69448094baccaae920"><div class="ttname"><a href="class_async_web_server_request.html#afba06f62d04d4c69448094baccaae920">AsyncWebServerRequest::version</a></div><div class="ttdeci">uint8_t version() const</div><div class="ttdef"><b>Definition</b> <a href="_e_s_p_async_web_server_8h_source.html#l00211">ESPAsyncWebServer.h:211</a></div></div>
<div class="ttc" id="aclass_async_web_server_request_html_afc49e90174b643ae55d609738a1021e1"><div class="ttname"><a href="class_async_web_server_request.html#afc49e90174b643ae55d609738a1021e1">AsyncWebServerRequest::methodToString</a></div><div class="ttdeci">const char * methodToString() const</div><div class="ttdef"><b>Definition</b> <a href="_web_request_8cpp_source.html#l00979">WebRequest.cpp:979</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md49"></a>
ArduinoJson Basic Response</h2>
<p>This way of sending Json is great for when the result is below 4KB </p><div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="_async_json_8h.html">AsyncJson.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;ArduinoJson.h&quot;</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><a class="code hl_class" href="class_async_response_stream.html">AsyncResponseStream</a> *response = request-&gt;<a class="code hl_function" href="class_async_web_server_request.html#a8f8f7c41b9b73cbcad15442b3bf53ccb">beginResponseStream</a>(<span class="stringliteral">&quot;application/json&quot;</span>);</div>
<div class="line">DynamicJsonBuffer jsonBuffer;</div>
<div class="line">JsonObject &amp;root = jsonBuffer.createObject();</div>
<div class="line">root[<span class="stringliteral">&quot;heap&quot;</span>] = ESP.getFreeHeap();</div>
<div class="line">root[<span class="stringliteral">&quot;ssid&quot;</span>] = WiFi.SSID();</div>
<div class="line">root.printTo(*response);</div>
<div class="line">request-&gt;<a class="code hl_function" href="class_async_web_server_request.html#a4247e73eb8d8c7b386f9bb4ab10f3856">send</a>(response);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md50"></a>
ArduinoJson Advanced Response</h2>
<p>This response can handle really large Json objects (tested to 40KB) There isn't any noticeable speed decrease for small results with the method above Since ArduinoJson does not allow reading parts of the string, the whole Json has to be passed every time a chunks needs to be sent, which shows speed decrease proportional to the resulting json packets </p><div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="_async_json_8h.html">AsyncJson.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;ArduinoJson.h&quot;</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><a class="code hl_class" href="class_async_json_response.html">AsyncJsonResponse</a> * response = <span class="keyword">new</span> <a class="code hl_class" href="class_async_json_response.html">AsyncJsonResponse</a>();</div>
<div class="line">response-&gt;<a class="code hl_function" href="class_async_web_server_response.html#a56c370dbf9c75c17cb3cd8d22239205a">addHeader</a>(<span class="stringliteral">&quot;Server&quot;</span>,<span class="stringliteral">&quot;ESP Async Web Server&quot;</span>);</div>
<div class="line">JsonObject&amp; root = response-&gt;<a class="code hl_function" href="class_async_json_response.html#ad0b5eb43cf87b0aefde8512ae370e4fc">getRoot</a>();</div>
<div class="line">root[<span class="stringliteral">&quot;heap&quot;</span>] = ESP.getFreeHeap();</div>
<div class="line">root[<span class="stringliteral">&quot;ssid&quot;</span>] = WiFi.SSID();</div>
<div class="line">response-&gt;<a class="code hl_function" href="class_async_json_response.html#aea3f30417a228a42cfe066b30f35305b">setLength</a>();</div>
<div class="line">request-&gt;<a class="code hl_function" href="class_async_web_server_request.html#a4247e73eb8d8c7b386f9bb4ab10f3856">send</a>(response);</div>
<div class="ttc" id="aclass_async_json_response_html"><div class="ttname"><a href="class_async_json_response.html">AsyncJsonResponse</a></div><div class="ttdef"><b>Definition</b> <a href="_async_json_8h_source.html#l00082">AsyncJson.h:82</a></div></div>
<div class="ttc" id="aclass_async_json_response_html_ad0b5eb43cf87b0aefde8512ae370e4fc"><div class="ttname"><a href="class_async_json_response.html#ad0b5eb43cf87b0aefde8512ae370e4fc">AsyncJsonResponse::getRoot</a></div><div class="ttdeci">JsonVariant &amp; getRoot()</div><div class="ttdef"><b>Definition</b> <a href="_async_json_8h_source.html#l00117">AsyncJson.h:117</a></div></div>
<div class="ttc" id="aclass_async_json_response_html_aea3f30417a228a42cfe066b30f35305b"><div class="ttname"><a href="class_async_json_response.html#aea3f30417a228a42cfe066b30f35305b">AsyncJsonResponse::setLength</a></div><div class="ttdeci">size_t setLength()</div><div class="ttdef"><b>Definition</b> <a href="_async_json_8h_source.html#l00119">AsyncJson.h:119</a></div></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md51"></a>
Serving static files</h1>
<p>In addition to serving files from SPIFFS as described above, the server provide a dedicated handler that optimize the performance of serving files from SPIFFS - <code><a class="el" href="class_async_static_web_handler.html">AsyncStaticWebHandler</a></code>. Use <code>server.serveStatic()</code> function to initialize and add a new instance of <code><a class="el" href="class_async_static_web_handler.html">AsyncStaticWebHandler</a></code> to the server. The Handler will not handle the request if the file does not exists, e.g. the server will continue to look for another handler that can handle the request. Notice that you can chain setter functions to setup the handler, or keep a pointer to change it at a later time.</p>
<h2><a class="anchor" id="autotoc_md52"></a>
Serving specific file by name</h2>
<div class="fragment"><div class="line"><span class="comment">// Serve the file &quot;/www/page.htm&quot; when request url is &quot;/page.htm&quot;</span></div>
<div class="line">server.serveStatic(<span class="stringliteral">&quot;/page.htm&quot;</span>, SPIFFS, <span class="stringliteral">&quot;/www/page.htm&quot;</span>);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md53"></a>
Serving files in directory</h2>
<p>To serve files in a directory, the path to the files should specify a directory in SPIFFS and ends with "/". </p><div class="fragment"><div class="line"><span class="comment">// Serve files in directory &quot;/www/&quot; when request url starts with &quot;/&quot;</span></div>
<div class="line"><span class="comment">// Request to the root or none existing files will try to server the defualt</span></div>
<div class="line"><span class="comment">// file name &quot;index.htm&quot; if exists</span></div>
<div class="line">server.serveStatic(<span class="stringliteral">&quot;/&quot;</span>, SPIFFS, <span class="stringliteral">&quot;/www/&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Server with different default file</span></div>
<div class="line">server.serveStatic(<span class="stringliteral">&quot;/&quot;</span>, SPIFFS, <span class="stringliteral">&quot;/www/&quot;</span>).setDefaultFile(<span class="stringliteral">&quot;default.html&quot;</span>);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md54"></a>
Serving static files with authentication</h2>
<div class="fragment"><div class="line">server</div>
<div class="line">    .serveStatic(<span class="stringliteral">&quot;/&quot;</span>, SPIFFS, <span class="stringliteral">&quot;/www/&quot;</span>)</div>
<div class="line">    .setDefaultFile(<span class="stringliteral">&quot;default.html&quot;</span>)</div>
<div class="line">    .setAuthentication(<span class="stringliteral">&quot;user&quot;</span>, <span class="stringliteral">&quot;pass&quot;</span>);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md55"></a>
Specifying Cache-Control header</h2>
<p>It is possible to specify Cache-Control header value to reduce the number of calls to the server once the client loaded the files. For more information on Cache-Control values see <a href="https://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.9">Cache-Control</a> </p><div class="fragment"><div class="line"><span class="comment">// Cache responses for 10 minutes (600 seconds)</span></div>
<div class="line">server.serveStatic(<span class="stringliteral">&quot;/&quot;</span>, SPIFFS, <span class="stringliteral">&quot;/www/&quot;</span>).setCacheControl(<span class="stringliteral">&quot;max-age=600&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">//*** Change Cache-Control after server setup ***</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// During setup - keep a pointer to the handler</span></div>
<div class="line"><a class="code hl_class" href="class_async_static_web_handler.html">AsyncStaticWebHandler</a>* handler = &amp;server.serveStatic(<span class="stringliteral">&quot;/&quot;</span>, SPIFFS, <span class="stringliteral">&quot;/www/&quot;</span>).setCacheControl(<span class="stringliteral">&quot;max-age=600&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// At a later event - change Cache-Control</span></div>
<div class="line">handler-&gt;<a class="code hl_function" href="class_async_static_web_handler.html#a37c26755a0dfc38a85ee44fee3d246ea">setCacheControl</a>(<span class="stringliteral">&quot;max-age=30&quot;</span>);</div>
<div class="ttc" id="aclass_async_static_web_handler_html"><div class="ttname"><a href="class_async_static_web_handler.html">AsyncStaticWebHandler</a></div><div class="ttdef"><b>Definition</b> <a href="_web_handler_impl_8h_source.html#l00032">WebHandlerImpl.h:32</a></div></div>
<div class="ttc" id="aclass_async_static_web_handler_html_a37c26755a0dfc38a85ee44fee3d246ea"><div class="ttname"><a href="class_async_static_web_handler.html#a37c26755a0dfc38a85ee44fee3d246ea">AsyncStaticWebHandler::setCacheControl</a></div><div class="ttdeci">AsyncStaticWebHandler &amp; setCacheControl(const char *cache_control)</div><div class="ttdef"><b>Definition</b> <a href="_web_handlers_8cpp_source.html#l00055">WebHandlers.cpp:55</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md56"></a>
Specifying Date-Modified header</h2>
<p>It is possible to specify Date-Modified header to enable the server to return Not-Modified (304) response for requests with "If-Modified-Since" header with the same value, instead of responding with the actual file content. </p><div class="fragment"><div class="line"><span class="comment">// Update the date modified string every time files are updated</span></div>
<div class="line">server.serveStatic(<span class="stringliteral">&quot;/&quot;</span>, SPIFFS, <span class="stringliteral">&quot;/www/&quot;</span>).setLastModified(<span class="stringliteral">&quot;Mon, 20 Jun 2016 14:00:00 GMT&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">//*** Chage last modified value at a later stage ***</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// During setup - read last modified value from config or EEPROM</span></div>
<div class="line">String date_modified = loadDateModified();</div>
<div class="line"><a class="code hl_class" href="class_async_static_web_handler.html">AsyncStaticWebHandler</a>* handler = &amp;server.serveStatic(<span class="stringliteral">&quot;/&quot;</span>, SPIFFS, <span class="stringliteral">&quot;/www/&quot;</span>);</div>
<div class="line">handler-&gt;<a class="code hl_function" href="class_async_static_web_handler.html#aa445f7394d8af30fae228a429c73863f">setLastModified</a>(date_modified);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// At a later event when files are updated</span></div>
<div class="line">String date_modified = getNewDateModfied();</div>
<div class="line">saveDateModified(date_modified); <span class="comment">// Save for next reset</span></div>
<div class="line">handler-&gt;<a class="code hl_function" href="class_async_static_web_handler.html#aa445f7394d8af30fae228a429c73863f">setLastModified</a>(date_modified);</div>
<div class="ttc" id="aclass_async_static_web_handler_html_aa445f7394d8af30fae228a429c73863f"><div class="ttname"><a href="class_async_static_web_handler.html#aa445f7394d8af30fae228a429c73863f">AsyncStaticWebHandler::setLastModified</a></div><div class="ttdeci">AsyncStaticWebHandler &amp; setLastModified(const char *last_modified)</div><div class="ttdef"><b>Definition</b> <a href="_web_handlers_8cpp_source.html#l00060">WebHandlers.cpp:60</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md57"></a>
Specifying Template Processor callback</h2>
<p>It is possible to specify template processor for static files. For information on template processor see Respond with content coming from a File containing templates. </p><div class="fragment"><div class="line">String processor(<span class="keyword">const</span> String&amp; var)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">if</span>(var == <span class="stringliteral">&quot;HELLO_FROM_TEMPLATE&quot;</span>)</div>
<div class="line">    <span class="keywordflow">return</span> F(<span class="stringliteral">&quot;Hello world!&quot;</span>);</div>
<div class="line">  <span class="keywordflow">return</span> String();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// ...</span></div>
<div class="line"> </div>
<div class="line">server.serveStatic(<span class="stringliteral">&quot;/&quot;</span>, SPIFFS, <span class="stringliteral">&quot;/www/&quot;</span>).setTemplateProcessor(processor);</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md58"></a>
Param Rewrite With Matching</h1>
<p>It is possible to rewrite the request url with parameter matchg. Here is an example with one parameter: Rewrite for example "/radio/{frequence}" -&gt; "/radio?f={frequence}"</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>OneParamRewrite : <span class="keyword">public</span> <a class="code hl_class" href="class_async_web_rewrite.html">AsyncWebRewrite</a></div>
<div class="line">{</div>
<div class="line">  <span class="keyword">protected</span>:</div>
<div class="line">    String _urlPrefix;</div>
<div class="line">    <span class="keywordtype">int</span> _paramIndex;</div>
<div class="line">    String _paramsBackup;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line">  OneParamRewrite(<span class="keyword">const</span> <span class="keywordtype">char</span>* from, <span class="keyword">const</span> <span class="keywordtype">char</span>* to)</div>
<div class="line">    : <a class="code hl_class" href="class_async_web_rewrite.html">AsyncWebRewrite</a>(from, to) {</div>
<div class="line"> </div>
<div class="line">      _paramIndex = _from.indexOf(<span class="charliteral">&#39;{&#39;</span>);</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">if</span>( _paramIndex &gt;=0 &amp;&amp; _from.endsWith(<span class="stringliteral">&quot;}&quot;</span>)) {</div>
<div class="line">        _urlPrefix = _from.substring(0, _paramIndex);</div>
<div class="line">        <span class="keywordtype">int</span> <a class="code hl_variable" href="c_j_s_o_n_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a> = _params.indexOf(<span class="charliteral">&#39;{&#39;</span>);</div>
<div class="line">        <span class="keywordflow">if</span>(<a class="code hl_variable" href="c_j_s_o_n_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a> &gt;= 0) {</div>
<div class="line">          _params = _params.substring(0, <a class="code hl_variable" href="c_j_s_o_n_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a>);</div>
<div class="line">        }</div>
<div class="line">      } <span class="keywordflow">else</span> {</div>
<div class="line">        _urlPrefix = <a class="code hl_variable" href="class_async_web_rewrite.html#aa3dc8fdb84facb7b92b48a5909c819e6">_from</a>;</div>
<div class="line">      }</div>
<div class="line">      _paramsBackup = <a class="code hl_variable" href="class_async_web_rewrite.html#ad6219266c68f01d6c8ba92699b567d05">_params</a>;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">bool</span> <a class="code hl_function" href="class_async_web_rewrite.html#a24a187ddf4dacd0792770a03b1020e3a">match</a>(<a class="code hl_class" href="class_async_web_server_request.html">AsyncWebServerRequest</a> *request)<span class="keyword"> override </span>{</div>
<div class="line">    <span class="keywordflow">if</span>(request-&gt;<a class="code hl_function" href="class_async_web_server_request.html#a2dcf10119dc5b3e87aca8d47fcde6482">url</a>().startsWith(_urlPrefix)) {</div>
<div class="line">      <span class="keywordflow">if</span>(_paramIndex &gt;= 0) {</div>
<div class="line">        _params = _paramsBackup + request-&gt;<a class="code hl_function" href="class_async_web_server_request.html#a2dcf10119dc5b3e87aca8d47fcde6482">url</a>().substring(_paramIndex);</div>
<div class="line">      } <span class="keywordflow">else</span> {</div>
<div class="line">        _params = _paramsBackup;</div>
<div class="line">      }</div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"> </div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">};</div>
<div class="ttc" id="aclass_async_web_rewrite_html"><div class="ttname"><a href="class_async_web_rewrite.html">AsyncWebRewrite</a></div><div class="ttdef"><b>Definition</b> <a href="_e_s_p_async_web_server_8h_source.html#l00303">ESPAsyncWebServer.h:303</a></div></div>
<div class="ttc" id="aclass_async_web_rewrite_html_a24a187ddf4dacd0792770a03b1020e3a"><div class="ttname"><a href="class_async_web_rewrite.html#a24a187ddf4dacd0792770a03b1020e3a">AsyncWebRewrite::match</a></div><div class="ttdeci">virtual bool match(AsyncWebServerRequest *request)</div><div class="ttdef"><b>Definition</b> <a href="_e_s_p_async_web_server_8h_source.html#l00323">ESPAsyncWebServer.h:323</a></div></div>
<div class="ttc" id="aclass_async_web_rewrite_html_aa3dc8fdb84facb7b92b48a5909c819e6"><div class="ttname"><a href="class_async_web_rewrite.html#aa3dc8fdb84facb7b92b48a5909c819e6">AsyncWebRewrite::_from</a></div><div class="ttdeci">String _from</div><div class="ttdef"><b>Definition</b> <a href="_e_s_p_async_web_server_8h_source.html#l00305">ESPAsyncWebServer.h:305</a></div></div>
<div class="ttc" id="aclass_async_web_rewrite_html_ad6219266c68f01d6c8ba92699b567d05"><div class="ttname"><a href="class_async_web_rewrite.html#ad6219266c68f01d6c8ba92699b567d05">AsyncWebRewrite::_params</a></div><div class="ttdeci">String _params</div><div class="ttdef"><b>Definition</b> <a href="_e_s_p_async_web_server_8h_source.html#l00307">ESPAsyncWebServer.h:307</a></div></div>
</div><!-- fragment --><p>Usage:</p>
<div class="fragment"><div class="line">server.addRewrite( <span class="keyword">new</span> OneParamRewrite(<span class="stringliteral">&quot;/radio/{frequence}&quot;</span>, <span class="stringliteral">&quot;/radio?f={frequence}&quot;</span>) );</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md59"></a>
Using filters</h1>
<p>Filters can be set to <code>Rewrite</code> or <code>Handler</code> in order to control when to apply the rewrite and consider the handler. A filter is a callback function that evaluates the request and return a boolean <code>true</code> to include the item or <code>false</code> to exclude it. Two filter callback are provided for convince:</p><ul>
<li><code>ON_STA_FILTER</code> - return true when requests are made to the STA (station mode) interface.</li>
<li><code>ON_AP_FILTER</code> - return true when requests are made to the AP (access point) interface.</li>
</ul>
<h2><a class="anchor" id="autotoc_md60"></a>
Serve different site files in AP mode</h2>
<div class="fragment"><div class="line">server.serveStatic(<span class="stringliteral">&quot;/&quot;</span>, SPIFFS, <span class="stringliteral">&quot;/www/&quot;</span>).setFilter(<a class="code hl_function" href="_e_s_p_async_web_server_8h.html#a7bfd7e2a410b50e848b017875e3a9d7e">ON_STA_FILTER</a>);</div>
<div class="line">server.serveStatic(<span class="stringliteral">&quot;/&quot;</span>, SPIFFS, <span class="stringliteral">&quot;/ap/&quot;</span>).setFilter(<a class="code hl_function" href="_e_s_p_async_web_server_8h.html#aceec9bc6dc912e206b5bd45a607d5262">ON_AP_FILTER</a>);</div>
<div class="ttc" id="a_e_s_p_async_web_server_8h_html_a7bfd7e2a410b50e848b017875e3a9d7e"><div class="ttname"><a href="_e_s_p_async_web_server_8h.html#a7bfd7e2a410b50e848b017875e3a9d7e">ON_STA_FILTER</a></div><div class="ttdeci">bool ON_STA_FILTER(AsyncWebServerRequest *request)</div><div class="ttdef"><b>Definition</b> <a href="_web_server_8cpp_source.html#l00024">WebServer.cpp:24</a></div></div>
<div class="ttc" id="a_e_s_p_async_web_server_8h_html_aceec9bc6dc912e206b5bd45a607d5262"><div class="ttname"><a href="_e_s_p_async_web_server_8h.html#aceec9bc6dc912e206b5bd45a607d5262">ON_AP_FILTER</a></div><div class="ttdeci">bool ON_AP_FILTER(AsyncWebServerRequest *request)</div><div class="ttdef"><b>Definition</b> <a href="_web_server_8cpp_source.html#l00028">WebServer.cpp:28</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md61"></a>
Rewrite to different index on AP</h2>
<div class="fragment"><div class="line"><span class="comment">// Serve the file &quot;/www/index-ap.htm&quot; in AP, and the file &quot;/www/index.htm&quot; on STA</span></div>
<div class="line">server.rewrite(<span class="stringliteral">&quot;/&quot;</span>, <span class="stringliteral">&quot;index.htm&quot;</span>);</div>
<div class="line">server.rewrite(<span class="stringliteral">&quot;/index.htm&quot;</span>, <span class="stringliteral">&quot;index-ap.htm&quot;</span>).setFilter(<a class="code hl_function" href="_e_s_p_async_web_server_8h.html#aceec9bc6dc912e206b5bd45a607d5262">ON_AP_FILTER</a>);</div>
<div class="line">server.serveStatic(<span class="stringliteral">&quot;/&quot;</span>, SPIFFS, <span class="stringliteral">&quot;/www/&quot;</span>);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md62"></a>
Serving different hosts</h2>
<div class="fragment"><div class="line"><span class="comment">// Filter callback using request host</span></div>
<div class="line"><span class="keywordtype">bool</span> filterOnHost1(<a class="code hl_class" href="class_async_web_server_request.html">AsyncWebServerRequest</a> *request) { <span class="keywordflow">return</span> request-&gt;<a class="code hl_function" href="class_async_web_server_request.html#acc62fc3d9916da0e4e223c8484eeeb37">host</a>() == <span class="stringliteral">&quot;host1&quot;</span>; }</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Server setup: server files in &quot;/host1/&quot; to requests for &quot;host1&quot;, and files in &quot;/www/&quot; otherwise.</span></div>
<div class="line">server.serveStatic(<span class="stringliteral">&quot;/&quot;</span>, SPIFFS, <span class="stringliteral">&quot;/host1/&quot;</span>).setFilter(filterOnHost1);</div>
<div class="line">server.serveStatic(<span class="stringliteral">&quot;/&quot;</span>, SPIFFS, <span class="stringliteral">&quot;/www/&quot;</span>);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md63"></a>
Determine interface inside callbacks</h2>
<div class="fragment"><div class="line">String RedirectUrl = <span class="stringliteral">&quot;http://&quot;</span>;</div>
<div class="line"><span class="keywordflow">if</span> (<a class="code hl_function" href="_e_s_p_async_web_server_8h.html#a7bfd7e2a410b50e848b017875e3a9d7e">ON_STA_FILTER</a>(request)) {</div>
<div class="line">  RedirectUrl += WiFi.localIP().toString();</div>
<div class="line">} <span class="keywordflow">else</span> {</div>
<div class="line">  RedirectUrl += WiFi.softAPIP().toString();</div>
<div class="line">}</div>
<div class="line">RedirectUrl += <span class="stringliteral">&quot;/index.htm&quot;</span>;</div>
<div class="line">request-&gt;<a class="code hl_function" href="class_async_web_server_request.html#a47d02f880c2b2fe41fa4f2021dfe57a6">redirect</a>(RedirectUrl);</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md64"></a>
Bad Responses</h1>
<p>Some responses are implemented, but you should not use them, because they do not conform to HTTP. The following example will lead to unclean close of the connection and more time wasted than providing the length of the content</p>
<h2><a class="anchor" id="autotoc_md65"></a>
Respond with content using a callback without content length to HTTP/1.0 clients</h2>
<div class="fragment"><div class="line"><span class="comment">//This is used as fallback for chunked responses to HTTP/1.0 Clients</span></div>
<div class="line">request-&gt;<a class="code hl_function" href="class_async_web_server_request.html#a4247e73eb8d8c7b386f9bb4ab10f3856">send</a>(<span class="stringliteral">&quot;text/plain&quot;</span>, 0, [](uint8_t *<a class="code hl_variable" href="c_j_s_o_n_8h.html#aff2566f4c366b48d73479bef43ee4d2e">buffer</a>, <span class="keywordtype">size_t</span> maxLen, <span class="keywordtype">size_t</span> <a class="code hl_variable" href="c_j_s_o_n_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a>) -&gt; <span class="keywordtype">size_t</span> {</div>
<div class="line">  <span class="comment">//Write up to &quot;maxLen&quot; bytes into &quot;buffer&quot; and return the amount written.</span></div>
<div class="line">  <span class="comment">//You will be asked for more data until 0 is returned</span></div>
<div class="line">  <span class="comment">//Keep in mind that you can not delay or yield waiting for more data!</span></div>
<div class="line">  <span class="keywordflow">return</span> mySource.read(<a class="code hl_variable" href="c_j_s_o_n_8h.html#aff2566f4c366b48d73479bef43ee4d2e">buffer</a>, maxLen);</div>
<div class="line">});</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md66"></a>
Async WebSocket Plugin</h1>
<p>The server includes a web socket plugin which lets you define different WebSocket locations to connect to without starting another listening service or using different port</p>
<h2><a class="anchor" id="autotoc_md67"></a>
Async WebSocket Event</h2>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> onEvent(<a class="code hl_class" href="class_async_web_socket.html">AsyncWebSocket</a> * server, <a class="code hl_class" href="class_async_web_socket_client.html">AsyncWebSocketClient</a> * client, <a class="code hl_enumeration" href="_async_web_socket_8h.html#a3c33b5e64d6635e10f74e3577e642293">AwsEventType</a> type, <span class="keywordtype">void</span> * arg, uint8_t *data, <span class="keywordtype">size_t</span> len){</div>
<div class="line">  <span class="keywordflow">if</span>(type == <a class="code hl_enumvalue" href="_async_web_socket_8h.html#a3c33b5e64d6635e10f74e3577e642293a8ee533e983912fa8ebff62b940cb5d57">WS_EVT_CONNECT</a>){</div>
<div class="line">    <span class="comment">//client connected</span></div>
<div class="line">    os_printf(<span class="stringliteral">&quot;ws[%s][%u] connect\n&quot;</span>, server-&gt;<a class="code hl_function" href="class_async_web_socket.html#adfffcf8b54228af5e2f5188a0a7857ed">url</a>(), client-&gt;<a class="code hl_function" href="class_async_web_socket_client.html#a9468ef28a6ccb9218a75d6fe8788f4ff">id</a>());</div>
<div class="line">    client-&gt;<a class="code hl_function" href="class_async_web_socket_client.html#acbe33cc1cd1733f5faa32fee42275de3">printf</a>(<span class="stringliteral">&quot;Hello Client %u :)&quot;</span>, client-&gt;<a class="code hl_function" href="class_async_web_socket_client.html#a9468ef28a6ccb9218a75d6fe8788f4ff">id</a>());</div>
<div class="line">    client-&gt;<a class="code hl_function" href="class_async_web_socket_client.html#a8dc0ca6269cafcdcfab9512f51c70b2a">ping</a>();</div>
<div class="line">  } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(type == <a class="code hl_enumvalue" href="_async_web_socket_8h.html#a3c33b5e64d6635e10f74e3577e642293ac27b495e6645907750b440aeaca9d014">WS_EVT_DISCONNECT</a>){</div>
<div class="line">    <span class="comment">//client disconnected</span></div>
<div class="line">    os_printf(<span class="stringliteral">&quot;ws[%s][%u] disconnect: %u\n&quot;</span>, server-&gt;<a class="code hl_function" href="class_async_web_socket.html#adfffcf8b54228af5e2f5188a0a7857ed">url</a>(), client-&gt;<a class="code hl_function" href="class_async_web_socket_client.html#a9468ef28a6ccb9218a75d6fe8788f4ff">id</a>());</div>
<div class="line">  } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(type == <a class="code hl_enumvalue" href="_async_web_socket_8h.html#a3c33b5e64d6635e10f74e3577e642293a6286c37466f0d7ab6a61aac2e24cfd51">WS_EVT_ERROR</a>){</div>
<div class="line">    <span class="comment">//error was received from the other end</span></div>
<div class="line">    os_printf(<span class="stringliteral">&quot;ws[%s][%u] error(%u): %s\n&quot;</span>, server-&gt;<a class="code hl_function" href="class_async_web_socket.html#adfffcf8b54228af5e2f5188a0a7857ed">url</a>(), client-&gt;<a class="code hl_function" href="class_async_web_socket_client.html#a9468ef28a6ccb9218a75d6fe8788f4ff">id</a>(), *((uint16_t*)arg), (<span class="keywordtype">char</span>*)data);</div>
<div class="line">  } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(type == <a class="code hl_enumvalue" href="_async_web_socket_8h.html#a3c33b5e64d6635e10f74e3577e642293a6732a7c83fea65e84830d6385be0bf8c">WS_EVT_PONG</a>){</div>
<div class="line">    <span class="comment">//pong message was received (in response to a ping request maybe)</span></div>
<div class="line">    os_printf(<span class="stringliteral">&quot;ws[%s][%u] pong[%u]: %s\n&quot;</span>, server-&gt;<a class="code hl_function" href="class_async_web_socket.html#adfffcf8b54228af5e2f5188a0a7857ed">url</a>(), client-&gt;<a class="code hl_function" href="class_async_web_socket_client.html#a9468ef28a6ccb9218a75d6fe8788f4ff">id</a>(), len, (len)?(<span class="keywordtype">char</span>*)data:<span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line">  } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(type == <a class="code hl_enumvalue" href="_async_web_socket_8h.html#a3c33b5e64d6635e10f74e3577e642293ac03ec7b81b62de01387a9a0f1e7353ef">WS_EVT_DATA</a>){</div>
<div class="line">    <span class="comment">//data packet</span></div>
<div class="line">    <a class="code hl_struct" href="struct_aws_frame_info.html">AwsFrameInfo</a> * info = (<a class="code hl_struct" href="struct_aws_frame_info.html">AwsFrameInfo</a>*)arg;</div>
<div class="line">    <span class="keywordflow">if</span>(info-&gt;<a class="code hl_variable" href="struct_aws_frame_info.html#ad6dd068167cbf7fd0cc2f4844ca7c3fb">final</a> &amp;&amp; info-&gt;<a class="code hl_variable" href="struct_aws_frame_info.html#ae7308917d1215478ff68c94e6852dad0">index</a> == 0 &amp;&amp; info-&gt;<a class="code hl_variable" href="struct_aws_frame_info.html#ae0a9784d8aa81c689d72ddc227c6b5d5">len</a> == len){</div>
<div class="line">      <span class="comment">//the whole message is in a single frame and we got all of it&#39;s data</span></div>
<div class="line">      os_printf(<span class="stringliteral">&quot;ws[%s][%u] %s-message[%llu]: &quot;</span>, server-&gt;<a class="code hl_function" href="class_async_web_socket.html#adfffcf8b54228af5e2f5188a0a7857ed">url</a>(), client-&gt;<a class="code hl_function" href="class_async_web_socket_client.html#a9468ef28a6ccb9218a75d6fe8788f4ff">id</a>(), (info-&gt;<a class="code hl_variable" href="struct_aws_frame_info.html#a925b3c00b45d55df6767a522e7e325b9">opcode</a> == <a class="code hl_enumvalue" href="_async_web_socket_8h.html#a0c697cd219515d2d6c0355f4f16bf660a123969d29e421dbc478da90771fe25ba">WS_TEXT</a>)?<span class="stringliteral">&quot;text&quot;</span>:<span class="stringliteral">&quot;binary&quot;</span>, info-&gt;len);</div>
<div class="line">      <span class="keywordflow">if</span>(info-&gt;<a class="code hl_variable" href="struct_aws_frame_info.html#a925b3c00b45d55df6767a522e7e325b9">opcode</a> == <a class="code hl_enumvalue" href="_async_web_socket_8h.html#a0c697cd219515d2d6c0355f4f16bf660a123969d29e421dbc478da90771fe25ba">WS_TEXT</a>){</div>
<div class="line">        data[len] = 0;</div>
<div class="line">        os_printf(<span class="stringliteral">&quot;%s\n&quot;</span>, (<span class="keywordtype">char</span>*)data);</div>
<div class="line">      } <span class="keywordflow">else</span> {</div>
<div class="line">        <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i=0; i &lt; info-&gt;<a class="code hl_variable" href="struct_aws_frame_info.html#ae0a9784d8aa81c689d72ddc227c6b5d5">len</a>; i++){</div>
<div class="line">          os_printf(<span class="stringliteral">&quot;%02x &quot;</span>, data[i]);</div>
<div class="line">        }</div>
<div class="line">        os_printf(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">if</span>(info-&gt;<a class="code hl_variable" href="struct_aws_frame_info.html#a925b3c00b45d55df6767a522e7e325b9">opcode</a> == <a class="code hl_enumvalue" href="_async_web_socket_8h.html#a0c697cd219515d2d6c0355f4f16bf660a123969d29e421dbc478da90771fe25ba">WS_TEXT</a>)</div>
<div class="line">        client-&gt;<a class="code hl_function" href="class_async_web_socket_client.html#a39fe017d2f6411392728eafa274da663">text</a>(<span class="stringliteral">&quot;I got your text message&quot;</span>);</div>
<div class="line">      <span class="keywordflow">else</span></div>
<div class="line">        client-&gt;<a class="code hl_function" href="class_async_web_socket_client.html#a958995b6c04ffea78a3c886e050537da">binary</a>(<span class="stringliteral">&quot;I got your binary message&quot;</span>);</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">      <span class="comment">//message is comprised of multiple frames or the frame is split into multiple packets</span></div>
<div class="line">      <span class="keywordflow">if</span>(info-&gt;<a class="code hl_variable" href="struct_aws_frame_info.html#ae7308917d1215478ff68c94e6852dad0">index</a> == 0){</div>
<div class="line">        <span class="keywordflow">if</span>(info-&gt;<a class="code hl_variable" href="struct_aws_frame_info.html#a241c5e8a92dbd8323986961da36708e7">num</a> == 0)</div>
<div class="line">          os_printf(<span class="stringliteral">&quot;ws[%s][%u] %s-message start\n&quot;</span>, server-&gt;<a class="code hl_function" href="class_async_web_socket.html#adfffcf8b54228af5e2f5188a0a7857ed">url</a>(), client-&gt;<a class="code hl_function" href="class_async_web_socket_client.html#a9468ef28a6ccb9218a75d6fe8788f4ff">id</a>(), (info-&gt;<a class="code hl_variable" href="struct_aws_frame_info.html#afc46b2071710229dc210396a07d30512">message_opcode</a> == <a class="code hl_enumvalue" href="_async_web_socket_8h.html#a0c697cd219515d2d6c0355f4f16bf660a123969d29e421dbc478da90771fe25ba">WS_TEXT</a>)?<span class="stringliteral">&quot;text&quot;</span>:<span class="stringliteral">&quot;binary&quot;</span>);</div>
<div class="line">        os_printf(<span class="stringliteral">&quot;ws[%s][%u] frame[%u] start[%llu]\n&quot;</span>, server-&gt;<a class="code hl_function" href="class_async_web_socket.html#adfffcf8b54228af5e2f5188a0a7857ed">url</a>(), client-&gt;<a class="code hl_function" href="class_async_web_socket_client.html#a9468ef28a6ccb9218a75d6fe8788f4ff">id</a>(), info-&gt;<a class="code hl_variable" href="struct_aws_frame_info.html#a241c5e8a92dbd8323986961da36708e7">num</a>, info-&gt;<a class="code hl_variable" href="struct_aws_frame_info.html#ae0a9784d8aa81c689d72ddc227c6b5d5">len</a>);</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">      os_printf(<span class="stringliteral">&quot;ws[%s][%u] frame[%u] %s[%llu - %llu]: &quot;</span>, server-&gt;<a class="code hl_function" href="class_async_web_socket.html#adfffcf8b54228af5e2f5188a0a7857ed">url</a>(), client-&gt;<a class="code hl_function" href="class_async_web_socket_client.html#a9468ef28a6ccb9218a75d6fe8788f4ff">id</a>(), info-&gt;<a class="code hl_variable" href="struct_aws_frame_info.html#a241c5e8a92dbd8323986961da36708e7">num</a>, (info-&gt;<a class="code hl_variable" href="struct_aws_frame_info.html#afc46b2071710229dc210396a07d30512">message_opcode</a> == <a class="code hl_enumvalue" href="_async_web_socket_8h.html#a0c697cd219515d2d6c0355f4f16bf660a123969d29e421dbc478da90771fe25ba">WS_TEXT</a>)?<span class="stringliteral">&quot;text&quot;</span>:<span class="stringliteral">&quot;binary&quot;</span>, info-&gt;<a class="code hl_variable" href="c_j_s_o_n_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a>, info-&gt;<a class="code hl_variable" href="c_j_s_o_n_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a> + len);</div>
<div class="line">      <span class="keywordflow">if</span>(info-&gt;<a class="code hl_variable" href="struct_aws_frame_info.html#afc46b2071710229dc210396a07d30512">message_opcode</a> == <a class="code hl_enumvalue" href="_async_web_socket_8h.html#a0c697cd219515d2d6c0355f4f16bf660a123969d29e421dbc478da90771fe25ba">WS_TEXT</a>){</div>
<div class="line">        data[len] = 0;</div>
<div class="line">        os_printf(<span class="stringliteral">&quot;%s\n&quot;</span>, (<span class="keywordtype">char</span>*)data);</div>
<div class="line">      } <span class="keywordflow">else</span> {</div>
<div class="line">        <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i=0; i &lt; len; i++){</div>
<div class="line">          os_printf(<span class="stringliteral">&quot;%02x &quot;</span>, data[i]);</div>
<div class="line">        }</div>
<div class="line">        os_printf(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">if</span>((info-&gt;<a class="code hl_variable" href="struct_aws_frame_info.html#ae7308917d1215478ff68c94e6852dad0">index</a> + len) == info-&gt;<a class="code hl_variable" href="struct_aws_frame_info.html#ae0a9784d8aa81c689d72ddc227c6b5d5">len</a>){</div>
<div class="line">        os_printf(<span class="stringliteral">&quot;ws[%s][%u] frame[%u] end[%llu]\n&quot;</span>, server-&gt;<a class="code hl_function" href="class_async_web_socket.html#adfffcf8b54228af5e2f5188a0a7857ed">url</a>(), client-&gt;<a class="code hl_function" href="class_async_web_socket_client.html#a9468ef28a6ccb9218a75d6fe8788f4ff">id</a>(), info-&gt;<a class="code hl_variable" href="struct_aws_frame_info.html#a241c5e8a92dbd8323986961da36708e7">num</a>, info-&gt;<a class="code hl_variable" href="struct_aws_frame_info.html#ae0a9784d8aa81c689d72ddc227c6b5d5">len</a>);</div>
<div class="line">        <span class="keywordflow">if</span>(info-&gt;<a class="code hl_variable" href="struct_aws_frame_info.html#ad6dd068167cbf7fd0cc2f4844ca7c3fb">final</a>){</div>
<div class="line">          os_printf(<span class="stringliteral">&quot;ws[%s][%u] %s-message end\n&quot;</span>, server-&gt;<a class="code hl_function" href="class_async_web_socket.html#adfffcf8b54228af5e2f5188a0a7857ed">url</a>(), client-&gt;<a class="code hl_function" href="class_async_web_socket_client.html#a9468ef28a6ccb9218a75d6fe8788f4ff">id</a>(), (info-&gt;<a class="code hl_variable" href="struct_aws_frame_info.html#afc46b2071710229dc210396a07d30512">message_opcode</a> == <a class="code hl_enumvalue" href="_async_web_socket_8h.html#a0c697cd219515d2d6c0355f4f16bf660a123969d29e421dbc478da90771fe25ba">WS_TEXT</a>)?<span class="stringliteral">&quot;text&quot;</span>:<span class="stringliteral">&quot;binary&quot;</span>);</div>
<div class="line">          <span class="keywordflow">if</span>(info-&gt;<a class="code hl_variable" href="struct_aws_frame_info.html#afc46b2071710229dc210396a07d30512">message_opcode</a> == <a class="code hl_enumvalue" href="_async_web_socket_8h.html#a0c697cd219515d2d6c0355f4f16bf660a123969d29e421dbc478da90771fe25ba">WS_TEXT</a>)</div>
<div class="line">            client-&gt;<a class="code hl_function" href="class_async_web_socket_client.html#a39fe017d2f6411392728eafa274da663">text</a>(<span class="stringliteral">&quot;I got your text message&quot;</span>);</div>
<div class="line">          <span class="keywordflow">else</span></div>
<div class="line">            client-&gt;<a class="code hl_function" href="class_async_web_socket_client.html#a958995b6c04ffea78a3c886e050537da">binary</a>(<span class="stringliteral">&quot;I got your binary message&quot;</span>);</div>
<div class="line">        }</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="ttc" id="a_async_web_socket_8h_html_a0c697cd219515d2d6c0355f4f16bf660a123969d29e421dbc478da90771fe25ba"><div class="ttname"><a href="_async_web_socket_8h.html#a0c697cd219515d2d6c0355f4f16bf660a123969d29e421dbc478da90771fe25ba">WS_TEXT</a></div><div class="ttdeci">@ WS_TEXT</div><div class="ttdef"><b>Definition</b> <a href="_async_web_socket_8h_source.html#l00079">AsyncWebSocket.h:79</a></div></div>
<div class="ttc" id="a_async_web_socket_8h_html_a3c33b5e64d6635e10f74e3577e642293"><div class="ttname"><a href="_async_web_socket_8h.html#a3c33b5e64d6635e10f74e3577e642293">AwsEventType</a></div><div class="ttdeci">AwsEventType</div><div class="ttdef"><b>Definition</b> <a href="_async_web_socket_8h_source.html#l00081">AsyncWebSocket.h:81</a></div></div>
<div class="ttc" id="a_async_web_socket_8h_html_a3c33b5e64d6635e10f74e3577e642293a6286c37466f0d7ab6a61aac2e24cfd51"><div class="ttname"><a href="_async_web_socket_8h.html#a3c33b5e64d6635e10f74e3577e642293a6286c37466f0d7ab6a61aac2e24cfd51">WS_EVT_ERROR</a></div><div class="ttdeci">@ WS_EVT_ERROR</div><div class="ttdef"><b>Definition</b> <a href="_async_web_socket_8h_source.html#l00081">AsyncWebSocket.h:81</a></div></div>
<div class="ttc" id="a_async_web_socket_8h_html_a3c33b5e64d6635e10f74e3577e642293a6732a7c83fea65e84830d6385be0bf8c"><div class="ttname"><a href="_async_web_socket_8h.html#a3c33b5e64d6635e10f74e3577e642293a6732a7c83fea65e84830d6385be0bf8c">WS_EVT_PONG</a></div><div class="ttdeci">@ WS_EVT_PONG</div><div class="ttdef"><b>Definition</b> <a href="_async_web_socket_8h_source.html#l00081">AsyncWebSocket.h:81</a></div></div>
<div class="ttc" id="a_async_web_socket_8h_html_a3c33b5e64d6635e10f74e3577e642293a8ee533e983912fa8ebff62b940cb5d57"><div class="ttname"><a href="_async_web_socket_8h.html#a3c33b5e64d6635e10f74e3577e642293a8ee533e983912fa8ebff62b940cb5d57">WS_EVT_CONNECT</a></div><div class="ttdeci">@ WS_EVT_CONNECT</div><div class="ttdef"><b>Definition</b> <a href="_async_web_socket_8h_source.html#l00081">AsyncWebSocket.h:81</a></div></div>
<div class="ttc" id="a_async_web_socket_8h_html_a3c33b5e64d6635e10f74e3577e642293ac03ec7b81b62de01387a9a0f1e7353ef"><div class="ttname"><a href="_async_web_socket_8h.html#a3c33b5e64d6635e10f74e3577e642293ac03ec7b81b62de01387a9a0f1e7353ef">WS_EVT_DATA</a></div><div class="ttdeci">@ WS_EVT_DATA</div><div class="ttdef"><b>Definition</b> <a href="_async_web_socket_8h_source.html#l00081">AsyncWebSocket.h:81</a></div></div>
<div class="ttc" id="a_async_web_socket_8h_html_a3c33b5e64d6635e10f74e3577e642293ac27b495e6645907750b440aeaca9d014"><div class="ttname"><a href="_async_web_socket_8h.html#a3c33b5e64d6635e10f74e3577e642293ac27b495e6645907750b440aeaca9d014">WS_EVT_DISCONNECT</a></div><div class="ttdeci">@ WS_EVT_DISCONNECT</div><div class="ttdef"><b>Definition</b> <a href="_async_web_socket_8h_source.html#l00081">AsyncWebSocket.h:81</a></div></div>
<div class="ttc" id="aclass_async_web_socket_client_html"><div class="ttname"><a href="class_async_web_socket_client.html">AsyncWebSocketClient</a></div><div class="ttdef"><b>Definition</b> <a href="_async_web_socket_8h_source.html#l00157">AsyncWebSocket.h:157</a></div></div>
<div class="ttc" id="aclass_async_web_socket_client_html_a39fe017d2f6411392728eafa274da663"><div class="ttname"><a href="class_async_web_socket_client.html#a39fe017d2f6411392728eafa274da663">AsyncWebSocketClient::text</a></div><div class="ttdeci">size_t size_t void text(const char *message, size_t len)</div><div class="ttdef"><b>Definition</b> <a href="_async_web_socket_8cpp_source.html#l00763">AsyncWebSocket.cpp:763</a></div></div>
<div class="ttc" id="aclass_async_web_socket_client_html_a8dc0ca6269cafcdcfab9512f51c70b2a"><div class="ttname"><a href="class_async_web_socket_client.html#a8dc0ca6269cafcdcfab9512f51c70b2a">AsyncWebSocketClient::ping</a></div><div class="ttdeci">void ping(uint8_t *data=NULL, size_t len=0)</div><div class="ttdef"><b>Definition</b> <a href="_async_web_socket_8cpp_source.html#l00593">AsyncWebSocket.cpp:593</a></div></div>
<div class="ttc" id="aclass_async_web_socket_client_html_a9468ef28a6ccb9218a75d6fe8788f4ff"><div class="ttname"><a href="class_async_web_socket_client.html#a9468ef28a6ccb9218a75d6fe8788f4ff">AsyncWebSocketClient::id</a></div><div class="ttdeci">uint32_t id()</div><div class="ttdef"><b>Definition</b> <a href="_async_web_socket_8h_source.html#l00184">AsyncWebSocket.h:184</a></div></div>
<div class="ttc" id="aclass_async_web_socket_client_html_a958995b6c04ffea78a3c886e050537da"><div class="ttname"><a href="class_async_web_socket_client.html#a958995b6c04ffea78a3c886e050537da">AsyncWebSocketClient::binary</a></div><div class="ttdeci">void binary(const char *message, size_t len)</div><div class="ttdef"><b>Definition</b> <a href="_async_web_socket_8cpp_source.html#l00799">AsyncWebSocket.cpp:799</a></div></div>
<div class="ttc" id="aclass_async_web_socket_client_html_acbe33cc1cd1733f5faa32fee42275de3"><div class="ttname"><a href="class_async_web_socket_client.html#acbe33cc1cd1733f5faa32fee42275de3">AsyncWebSocketClient::printf</a></div><div class="ttdeci">size_t printf(const char *format,...) __attribute__((format(printf</div><div class="ttdef"><b>Definition</b> <a href="_async_web_socket_8cpp_source.html#l00701">AsyncWebSocket.cpp:701</a></div></div>
<div class="ttc" id="aclass_async_web_socket_html"><div class="ttname"><a href="class_async_web_socket.html">AsyncWebSocket</a></div><div class="ttdef"><b>Definition</b> <a href="_async_web_socket_8h_source.html#l00243">AsyncWebSocket.h:243</a></div></div>
<div class="ttc" id="aclass_async_web_socket_html_adfffcf8b54228af5e2f5188a0a7857ed"><div class="ttname"><a href="class_async_web_socket.html#adfffcf8b54228af5e2f5188a0a7857ed">AsyncWebSocket::url</a></div><div class="ttdeci">const char * url() const</div><div class="ttdef"><b>Definition</b> <a href="_async_web_socket_8h_source.html#l00257">AsyncWebSocket.h:257</a></div></div>
<div class="ttc" id="astruct_aws_frame_info_html"><div class="ttname"><a href="struct_aws_frame_info.html">AwsFrameInfo</a></div><div class="ttdef"><b>Definition</b> <a href="_async_web_socket_8h_source.html#l00054">AsyncWebSocket.h:54</a></div></div>
<div class="ttc" id="astruct_aws_frame_info_html_a241c5e8a92dbd8323986961da36708e7"><div class="ttname"><a href="struct_aws_frame_info.html#a241c5e8a92dbd8323986961da36708e7">AwsFrameInfo::num</a></div><div class="ttdeci">uint32_t num</div><div class="ttdoc">Frame number of a fragmented message.</div><div class="ttdef"><b>Definition</b> <a href="_async_web_socket_8h_source.html#l00060">AsyncWebSocket.h:60</a></div></div>
<div class="ttc" id="astruct_aws_frame_info_html_a925b3c00b45d55df6767a522e7e325b9"><div class="ttname"><a href="struct_aws_frame_info.html#a925b3c00b45d55df6767a522e7e325b9">AwsFrameInfo::opcode</a></div><div class="ttdeci">uint8_t opcode</div><div class="ttdoc">Message type as defined by enum AwsFrameType.</div><div class="ttdef"><b>Definition</b> <a href="_async_web_socket_8h_source.html#l00068">AsyncWebSocket.h:68</a></div></div>
<div class="ttc" id="astruct_aws_frame_info_html_ad6dd068167cbf7fd0cc2f4844ca7c3fb"><div class="ttname"><a href="struct_aws_frame_info.html#ad6dd068167cbf7fd0cc2f4844ca7c3fb">AwsFrameInfo::final</a></div><div class="ttdeci">uint8_t final</div><div class="ttdoc">Is this the last frame in a fragmented message ?</div><div class="ttdef"><b>Definition</b> <a href="_async_web_socket_8h_source.html#l00062">AsyncWebSocket.h:62</a></div></div>
<div class="ttc" id="astruct_aws_frame_info_html_ae0a9784d8aa81c689d72ddc227c6b5d5"><div class="ttname"><a href="struct_aws_frame_info.html#ae0a9784d8aa81c689d72ddc227c6b5d5">AwsFrameInfo::len</a></div><div class="ttdeci">uint64_t len</div><div class="ttdoc">Length of the current frame.</div><div class="ttdef"><b>Definition</b> <a href="_async_web_socket_8h_source.html#l00071">AsyncWebSocket.h:71</a></div></div>
<div class="ttc" id="astruct_aws_frame_info_html_ae7308917d1215478ff68c94e6852dad0"><div class="ttname"><a href="struct_aws_frame_info.html#ae7308917d1215478ff68c94e6852dad0">AwsFrameInfo::index</a></div><div class="ttdeci">uint64_t index</div><div class="ttdoc">Offset of the data inside the current frame.</div><div class="ttdef"><b>Definition</b> <a href="_async_web_socket_8h_source.html#l00075">AsyncWebSocket.h:75</a></div></div>
<div class="ttc" id="astruct_aws_frame_info_html_afc46b2071710229dc210396a07d30512"><div class="ttname"><a href="struct_aws_frame_info.html#afc46b2071710229dc210396a07d30512">AwsFrameInfo::message_opcode</a></div><div class="ttdeci">uint8_t message_opcode</div><div class="ttdoc">Message type as defined by enum AwsFrameType.</div><div class="ttdef"><b>Definition</b> <a href="_async_web_socket_8h_source.html#l00058">AsyncWebSocket.h:58</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md68"></a>
Methods for sending data to a socket client</h2>
<div class="fragment"><div class="line"><span class="comment">//Server methods</span></div>
<div class="line"><a class="code hl_class" href="class_async_web_socket.html">AsyncWebSocket</a> ws(<span class="stringliteral">&quot;/ws&quot;</span>);</div>
<div class="line"><span class="comment">//printf to a client</span></div>
<div class="line">ws.printf((uint32_t)client_id, arguments...);</div>
<div class="line"><span class="comment">//printf to all clients</span></div>
<div class="line">ws.printfAll(arguments...);</div>
<div class="line"><span class="comment">//printf_P to a client</span></div>
<div class="line">ws.printf_P((uint32_t)client_id, PSTR(<a class="code hl_variable" href="c_j_s_o_n_8h.html#adb411a44855a4c49231d72a0fc9a3b3b">format</a>), arguments...);</div>
<div class="line"><span class="comment">//printfAll_P to all clients</span></div>
<div class="line">ws.printfAll_P(PSTR(<a class="code hl_variable" href="c_j_s_o_n_8h.html#adb411a44855a4c49231d72a0fc9a3b3b">format</a>), arguments...);</div>
<div class="line"><span class="comment">//send text to a client</span></div>
<div class="line">ws.text((uint32_t)client_id, (<span class="keywordtype">char</span>*)text);</div>
<div class="line">ws.text((uint32_t)client_id, (uint8_t*)text, (<span class="keywordtype">size_t</span>)len);</div>
<div class="line"><span class="comment">//send text from PROGMEM to a client</span></div>
<div class="line">ws.text((uint32_t)client_id, PSTR(<span class="stringliteral">&quot;text&quot;</span>));</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> flash_text[] <a class="code hl_variable" href="_s_p_i_f_f_s_editor_8cpp.html#a569152b81da50e484f22c99f331fa096">PROGMEM</a> = <span class="stringliteral">&quot;Text to send&quot;</span></div>
<div class="line">ws.text((uint32_t)client_id, FPSTR(flash_text));</div>
<div class="line"><span class="comment">//send text to all clients</span></div>
<div class="line">ws.textAll((<span class="keywordtype">char</span>*)text);</div>
<div class="line">ws.textAll((uint8_t*)text, (<span class="keywordtype">size_t</span>)len);</div>
<div class="line"><span class="comment">//send binary to a client</span></div>
<div class="line">ws.binary((uint32_t)client_id, (<span class="keywordtype">char</span>*)binary);</div>
<div class="line">ws.binary((uint32_t)client_id, (uint8_t*)binary, (<span class="keywordtype">size_t</span>)len);</div>
<div class="line"><span class="comment">//send binary from PROGMEM to a client</span></div>
<div class="line"><span class="keyword">const</span> uint8_t flash_binary[] <a class="code hl_variable" href="_s_p_i_f_f_s_editor_8cpp.html#a569152b81da50e484f22c99f331fa096">PROGMEM</a> = { 0x01, 0x02, 0x03, 0x04 };</div>
<div class="line">ws.binary((uint32_t)client_id, flash_binary, 4);</div>
<div class="line"><span class="comment">//send binary to all clients</span></div>
<div class="line">ws.binaryAll((<span class="keywordtype">char</span>*)binary);</div>
<div class="line">ws.binaryAll((uint8_t*)binary, (<span class="keywordtype">size_t</span>)len);</div>
<div class="line"><span class="comment">//HTTP Authenticate before switch to Websocket protocol</span></div>
<div class="line">ws.setAuthentication(<span class="stringliteral">&quot;user&quot;</span>, <span class="stringliteral">&quot;pass&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">//client methods</span></div>
<div class="line"><a class="code hl_class" href="class_async_web_socket_client.html">AsyncWebSocketClient</a> * client;</div>
<div class="line"><span class="comment">//printf</span></div>
<div class="line">client-&gt;<a class="code hl_function" href="class_async_web_socket_client.html#acbe33cc1cd1733f5faa32fee42275de3">printf</a>(arguments...);</div>
<div class="line"><span class="comment">//printf_P</span></div>
<div class="line">client-&gt;<a class="code hl_function" href="class_async_web_socket_client.html#a863eca16211cecfcbedac2aca1d4f1fd">printf_P</a>(PSTR(<a class="code hl_variable" href="c_j_s_o_n_8h.html#adb411a44855a4c49231d72a0fc9a3b3b">format</a>), arguments...);</div>
<div class="line"><span class="comment">//send text</span></div>
<div class="line">client-&gt;<a class="code hl_function" href="class_async_web_socket_client.html#a39fe017d2f6411392728eafa274da663">text</a>((<span class="keywordtype">char</span>*)text);</div>
<div class="line">client-&gt;<a class="code hl_function" href="class_async_web_socket_client.html#a39fe017d2f6411392728eafa274da663">text</a>((uint8_t*)text, (<span class="keywordtype">size_t</span>)len);</div>
<div class="line"><span class="comment">//send text from PROGMEM</span></div>
<div class="line">client-&gt;<a class="code hl_function" href="class_async_web_socket_client.html#a39fe017d2f6411392728eafa274da663">text</a>(PSTR(<span class="stringliteral">&quot;text&quot;</span>));</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> flash_text[] <a class="code hl_variable" href="_s_p_i_f_f_s_editor_8cpp.html#a569152b81da50e484f22c99f331fa096">PROGMEM</a> = <span class="stringliteral">&quot;Text to send&quot;</span>;</div>
<div class="line">client-&gt;<a class="code hl_function" href="class_async_web_socket_client.html#a39fe017d2f6411392728eafa274da663">text</a>(FPSTR(flash_text));</div>
<div class="line"><span class="comment">//send binary</span></div>
<div class="line">client-&gt;<a class="code hl_function" href="class_async_web_socket_client.html#a958995b6c04ffea78a3c886e050537da">binary</a>((<span class="keywordtype">char</span>*)binary);</div>
<div class="line">client-&gt;<a class="code hl_function" href="class_async_web_socket_client.html#a958995b6c04ffea78a3c886e050537da">binary</a>((uint8_t*)binary, (<span class="keywordtype">size_t</span>)len);</div>
<div class="line"><span class="comment">//send binary from PROGMEM</span></div>
<div class="line"><span class="keyword">const</span> uint8_t flash_binary[] <a class="code hl_variable" href="_s_p_i_f_f_s_editor_8cpp.html#a569152b81da50e484f22c99f331fa096">PROGMEM</a> = { 0x01, 0x02, 0x03, 0x04 };</div>
<div class="line">client-&gt;<a class="code hl_function" href="class_async_web_socket_client.html#a958995b6c04ffea78a3c886e050537da">binary</a>(flash_binary, 4);</div>
<div class="ttc" id="ac_j_s_o_n_8h_html_adb411a44855a4c49231d72a0fc9a3b3b"><div class="ttname"><a href="c_j_s_o_n_8h.html#adb411a44855a4c49231d72a0fc9a3b3b">format</a></div><div class="ttdeci">char const int const cJSON_bool format</div><div class="ttdef"><b>Definition</b> <a href="c_j_s_o_n_8h_source.html#l00163">cJSON.h:163</a></div></div>
<div class="ttc" id="aclass_async_web_socket_client_html_a863eca16211cecfcbedac2aca1d4f1fd"><div class="ttname"><a href="class_async_web_socket_client.html#a863eca16211cecfcbedac2aca1d4f1fd">AsyncWebSocketClient::printf_P</a></div><div class="ttdeci">size_t size_t printf_P(PGM_P formatP,...) __attribute__((format(printf</div><div class="ttdef"><b>Definition</b> <a href="_async_web_socket_8cpp_source.html#l00732">AsyncWebSocket.cpp:732</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md69"></a>
Direct access to web socket message buffer</h2>
<p>When sending a web socket message using the above methods a buffer is created. Under certain circumstances you might want to manipulate or populate this buffer directly from your application, for example to prevent unnecessary duplications of the data. This example below shows how to create a buffer and print data to it from an ArduinoJson object then send it. <br  />
</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> sendDataWs(<a class="code hl_class" href="class_async_web_socket_client.html">AsyncWebSocketClient</a> * client)</div>
<div class="line">{</div>
<div class="line">    DynamicJsonBuffer jsonBuffer;</div>
<div class="line">    JsonObject&amp; root = jsonBuffer.createObject();</div>
<div class="line">    root[<span class="stringliteral">&quot;a&quot;</span>] = <span class="stringliteral">&quot;abc&quot;</span>;</div>
<div class="line">    root[<span class="stringliteral">&quot;b&quot;</span>] = <span class="stringliteral">&quot;abcd&quot;</span>;</div>
<div class="line">    root[<span class="stringliteral">&quot;c&quot;</span>] = <span class="stringliteral">&quot;abcde&quot;</span>;</div>
<div class="line">    root[<span class="stringliteral">&quot;d&quot;</span>] = <span class="stringliteral">&quot;abcdef&quot;</span>;</div>
<div class="line">    root[<span class="stringliteral">&quot;e&quot;</span>] = <span class="stringliteral">&quot;abcdefg&quot;</span>;</div>
<div class="line">    <span class="keywordtype">size_t</span> len = root.measureLength();</div>
<div class="line">    <a class="code hl_class" href="class_async_web_socket_message_buffer.html">AsyncWebSocketMessageBuffer</a> * <a class="code hl_variable" href="c_j_s_o_n_8h.html#aff2566f4c366b48d73479bef43ee4d2e">buffer</a> = ws.makeBuffer(len); <span class="comment">//  creates a buffer (len + 1) for you.</span></div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code hl_variable" href="c_j_s_o_n_8h.html#aff2566f4c366b48d73479bef43ee4d2e">buffer</a>) {</div>
<div class="line">        root.printTo((<span class="keywordtype">char</span> *)<a class="code hl_variable" href="c_j_s_o_n_8h.html#aff2566f4c366b48d73479bef43ee4d2e">buffer</a>-&gt;get(), len + 1);</div>
<div class="line">        <span class="keywordflow">if</span> (client) {</div>
<div class="line">            client-&gt;<a class="code hl_function" href="class_async_web_socket_client.html#a39fe017d2f6411392728eafa274da663">text</a>(<a class="code hl_variable" href="c_j_s_o_n_8h.html#aff2566f4c366b48d73479bef43ee4d2e">buffer</a>);</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            ws.textAll(<a class="code hl_variable" href="c_j_s_o_n_8h.html#aff2566f4c366b48d73479bef43ee4d2e">buffer</a>);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="aclass_async_web_socket_message_buffer_html"><div class="ttname"><a href="class_async_web_socket_message_buffer.html">AsyncWebSocketMessageBuffer</a></div><div class="ttdef"><b>Definition</b> <a href="_async_web_socket_8h_source.html#l00083">AsyncWebSocket.h:83</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md70"></a>
Limiting the number of web socket clients</h2>
<p>Browsers sometimes do not correctly close the websocket connection, even when the close() function is called in javascript. This will eventually exhaust the web server's resources and will cause the server to crash. Periodically calling the cleanClients() function from the main loop() function limits the number of clients by closing the oldest client when the maximum number of clients has been exceeded. This can called be every cycle, however, if you wish to use less power, then calling as infrequently as once per second is sufficient.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> loop(){</div>
<div class="line">  ws.cleanupClients();</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md71"></a>
Async Event Source Plugin</h1>
<p>The server includes EventSource (Server-Sent Events) plugin which can be used to send short text events to the browser. Difference between EventSource and WebSockets is that EventSource is single direction, text-only protocol.</p>
<h2><a class="anchor" id="autotoc_md72"></a>
Setup Event Source on the server</h2>
<div class="fragment"><div class="line"><a class="code hl_class" href="class_async_web_server.html">AsyncWebServer</a> server(80);</div>
<div class="line"><a class="code hl_class" href="class_async_event_source.html">AsyncEventSource</a> events(<span class="stringliteral">&quot;/events&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> setup(){</div>
<div class="line">  <span class="comment">// setup ......</span></div>
<div class="line">  events.onConnect([](<a class="code hl_class" href="class_async_event_source_client.html">AsyncEventSourceClient</a> *client){</div>
<div class="line">    <span class="keywordflow">if</span>(client-&gt;<a class="code hl_function" href="class_async_event_source_client.html#a924d2a539c857e5b11d3a2c1711a8722">lastId</a>()){</div>
<div class="line">      Serial.printf(<span class="stringliteral">&quot;Client reconnected! Last message ID that it gat is: %u\n&quot;</span>, client-&gt;lastId());</div>
<div class="line">    }</div>
<div class="line">    <span class="comment">//send event with message &quot;hello!&quot;, id current millis</span></div>
<div class="line">    <span class="comment">// and set reconnect delay to 1 second</span></div>
<div class="line">    client-&gt;<a class="code hl_function" href="class_async_event_source_client.html#a7f74c5a79ac5ce90c190e935462af38b">send</a>(<span class="stringliteral">&quot;hello!&quot;</span>,NULL,millis(),1000);</div>
<div class="line">  });</div>
<div class="line">  <span class="comment">//HTTP Basic authentication</span></div>
<div class="line">  events.setAuthentication(<span class="stringliteral">&quot;user&quot;</span>, <span class="stringliteral">&quot;pass&quot;</span>);</div>
<div class="line">  server.addHandler(&amp;events);</div>
<div class="line">  <span class="comment">// setup ......</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> loop(){</div>
<div class="line">  <span class="keywordflow">if</span>(eventTriggered){ <span class="comment">// your logic here</span></div>
<div class="line">    <span class="comment">//send event &quot;myevent&quot;</span></div>
<div class="line">    events.send(<span class="stringliteral">&quot;my event content&quot;</span>,<span class="stringliteral">&quot;myevent&quot;</span>,millis());</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="ttc" id="aclass_async_event_source_client_html"><div class="ttname"><a href="class_async_event_source_client.html">AsyncEventSourceClient</a></div><div class="ttdef"><b>Definition</b> <a href="_async_event_source_8h_source.html#l00069">AsyncEventSource.h:69</a></div></div>
<div class="ttc" id="aclass_async_event_source_client_html_a7f74c5a79ac5ce90c190e935462af38b"><div class="ttname"><a href="class_async_event_source_client.html#a7f74c5a79ac5ce90c190e935462af38b">AsyncEventSourceClient::send</a></div><div class="ttdeci">void send(const char *message, const char *event=NULL, uint32_t id=0, uint32_t reconnect=0)</div><div class="ttdef"><b>Definition</b> <a href="_async_event_source_8cpp_source.html#l00232">AsyncEventSource.cpp:232</a></div></div>
<div class="ttc" id="aclass_async_event_source_client_html_a924d2a539c857e5b11d3a2c1711a8722"><div class="ttname"><a href="class_async_event_source_client.html#a924d2a539c857e5b11d3a2c1711a8722">AsyncEventSourceClient::lastId</a></div><div class="ttdeci">uint32_t lastId() const</div><div class="ttdef"><b>Definition</b> <a href="_async_event_source_8h_source.html#l00088">AsyncEventSource.h:88</a></div></div>
<div class="ttc" id="aclass_async_event_source_html"><div class="ttname"><a href="class_async_event_source.html">AsyncEventSource</a></div><div class="ttdef"><b>Definition</b> <a href="_async_event_source_8h_source.html#l00098">AsyncEventSource.h:98</a></div></div>
<div class="ttc" id="aclass_async_web_server_html"><div class="ttname"><a href="class_async_web_server.html">AsyncWebServer</a></div><div class="ttdef"><b>Definition</b> <a href="_e_s_p_async_web_server_8h_source.html#l00397">ESPAsyncWebServer.h:397</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md73"></a>
Setup Event Source in the browser</h2>
<div class="fragment"><div class="line">if (!!window.EventSource) {</div>
<div class="line">  var source = new EventSource(&#39;/events&#39;);</div>
<div class="line"> </div>
<div class="line">  source.addEventListener(&#39;open&#39;, function(e) {</div>
<div class="line">    console.log(&quot;Events Connected&quot;);</div>
<div class="line">  }, false);</div>
<div class="line"> </div>
<div class="line">  source.addEventListener(&#39;error&#39;, function(e) {</div>
<div class="line">    if (e.target.readyState != EventSource.OPEN) {</div>
<div class="line">      console.log(&quot;Events Disconnected&quot;);</div>
<div class="line">    }</div>
<div class="line">  }, false);</div>
<div class="line"> </div>
<div class="line">  source.addEventListener(&#39;message&#39;, function(e) {</div>
<div class="line">    console.log(&quot;message&quot;, e.data);</div>
<div class="line">  }, false);</div>
<div class="line"> </div>
<div class="line">  source.addEventListener(&#39;myevent&#39;, function(e) {</div>
<div class="line">    console.log(&quot;myevent&quot;, e.data);</div>
<div class="line">  }, false);</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md74"></a>
Scanning for available WiFi Networks</h1>
<div class="fragment"><div class="line"><span class="comment">//First request will return 0 results unless you start scan from somewhere else (loop/setup)</span></div>
<div class="line"><span class="comment">//Do not request more often than 3-5 seconds</span></div>
<div class="line">server.on(<span class="stringliteral">&quot;/scan&quot;</span>, <a class="code hl_enumvalue" href="_e_s_p_async_web_server_8h.html#afe35bd25c64a2d979ca5070a1578194aa4ad23c3d2f21f7502ba058ef89518166">HTTP_GET</a>, [](<a class="code hl_class" href="class_async_web_server_request.html">AsyncWebServerRequest</a> *request){</div>
<div class="line">  String json = <span class="stringliteral">&quot;[&quot;</span>;</div>
<div class="line">  <span class="keywordtype">int</span> n = WiFi.scanComplete();</div>
<div class="line">  <span class="keywordflow">if</span>(n == -2){</div>
<div class="line">    WiFi.scanNetworks(<span class="keyword">true</span>);</div>
<div class="line">  } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(n){</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; n; ++i){</div>
<div class="line">      <span class="keywordflow">if</span>(i) json += <span class="stringliteral">&quot;,&quot;</span>;</div>
<div class="line">      json += <span class="stringliteral">&quot;{&quot;</span>;</div>
<div class="line">      json += <span class="stringliteral">&quot;\&quot;rssi\&quot;:&quot;</span>+String(WiFi.RSSI(i));</div>
<div class="line">      json += <span class="stringliteral">&quot;,\&quot;ssid\&quot;:\&quot;&quot;</span>+WiFi.SSID(i)+<span class="stringliteral">&quot;\&quot;&quot;</span>;</div>
<div class="line">      json += <span class="stringliteral">&quot;,\&quot;bssid\&quot;:\&quot;&quot;</span>+WiFi.BSSIDstr(i)+<span class="stringliteral">&quot;\&quot;&quot;</span>;</div>
<div class="line">      json += <span class="stringliteral">&quot;,\&quot;channel\&quot;:&quot;</span>+String(WiFi.channel(i));</div>
<div class="line">      json += <span class="stringliteral">&quot;,\&quot;secure\&quot;:&quot;</span>+String(WiFi.encryptionType(i));</div>
<div class="line">      json += <span class="stringliteral">&quot;,\&quot;hidden\&quot;:&quot;</span>+String(WiFi.isHidden(i)?<span class="stringliteral">&quot;true&quot;</span>:<span class="stringliteral">&quot;false&quot;</span>);</div>
<div class="line">      json += <span class="stringliteral">&quot;}&quot;</span>;</div>
<div class="line">    }</div>
<div class="line">    WiFi.scanDelete();</div>
<div class="line">    <span class="keywordflow">if</span>(WiFi.scanComplete() == -2){</div>
<div class="line">      WiFi.scanNetworks(<span class="keyword">true</span>);</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">  json += <span class="stringliteral">&quot;]&quot;</span>;</div>
<div class="line">  request-&gt;<a class="code hl_function" href="class_async_web_server_request.html#a4247e73eb8d8c7b386f9bb4ab10f3856">send</a>(200, <span class="stringliteral">&quot;application/json&quot;</span>, json);</div>
<div class="line">  json = String();</div>
<div class="line">});</div>
<div class="ttc" id="a_e_s_p_async_web_server_8h_html_afe35bd25c64a2d979ca5070a1578194aa4ad23c3d2f21f7502ba058ef89518166"><div class="ttname"><a href="_e_s_p_async_web_server_8h.html#afe35bd25c64a2d979ca5070a1578194aa4ad23c3d2f21f7502ba058ef89518166">HTTP_GET</a></div><div class="ttdeci">@ HTTP_GET</div><div class="ttdef"><b>Definition</b> <a href="_e_s_p_async_web_server_8h_source.html#l00062">ESPAsyncWebServer.h:62</a></div></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md75"></a>
Remove handlers and rewrites</h1>
<p>Server goes through handlers in same order as they were added. You can't simple add handler with same path to override them. To remove handler: </p><div class="fragment"><div class="line">// save callback for particular URL path</div>
<div class="line">auto handler = server.on(&quot;/some/path&quot;, [](AsyncWebServerRequest *request){</div>
<div class="line">  //do something useful</div>
<div class="line">});</div>
<div class="line">// when you don&#39;t need handler anymore remove it</div>
<div class="line">server.removeHandler(&amp;handler);</div>
<div class="line"> </div>
<div class="line">// same with rewrites</div>
<div class="line">server.removeRewrite(&amp;someRewrite);</div>
<div class="line"> </div>
<div class="line">server.onNotFound([](AsyncWebServerRequest *request){</div>
<div class="line">  request-&gt;send(404);</div>
<div class="line">});</div>
<div class="line"> </div>
<div class="line">// remove server.onNotFound handler</div>
<div class="line">server.onNotFound(NULL);</div>
<div class="line"> </div>
<div class="line">// remove all rewrites, handlers and onNotFound/onFileUpload/onRequestBody callbacks</div>
<div class="line">server.reset();</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md76"></a>
Setting up the server</h1>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;ESPAsyncTCP.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="_e_s_p_async_web_server_8h.html">ESPAsyncWebServer.h</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><a class="code hl_class" href="class_async_web_server.html">AsyncWebServer</a> server(80);</div>
<div class="line"><a class="code hl_class" href="class_async_web_socket.html">AsyncWebSocket</a> ws(<span class="stringliteral">&quot;/ws&quot;</span>); <span class="comment">// access at ws://[esp ip]/ws</span></div>
<div class="line"><a class="code hl_class" href="class_async_event_source.html">AsyncEventSource</a> events(<span class="stringliteral">&quot;/events&quot;</span>); <span class="comment">// event source (Server-Sent events)</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span>* ssid = <span class="stringliteral">&quot;your-ssid&quot;</span>;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span>* password = <span class="stringliteral">&quot;your-pass&quot;</span>;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span>* http_username = <span class="stringliteral">&quot;admin&quot;</span>;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span>* http_password = <span class="stringliteral">&quot;admin&quot;</span>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">//flag to use from web update to reboot the ESP</span></div>
<div class="line"><span class="keywordtype">bool</span> shouldReboot = <span class="keyword">false</span>;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> onRequest(<a class="code hl_class" href="class_async_web_server_request.html">AsyncWebServerRequest</a> *request){</div>
<div class="line">  <span class="comment">//Handle Unknown Request</span></div>
<div class="line">  request-&gt;<a class="code hl_function" href="class_async_web_server_request.html#a4247e73eb8d8c7b386f9bb4ab10f3856">send</a>(404);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> onBody(<a class="code hl_class" href="class_async_web_server_request.html">AsyncWebServerRequest</a> *request, uint8_t *data, <span class="keywordtype">size_t</span> len, <span class="keywordtype">size_t</span> <a class="code hl_variable" href="c_j_s_o_n_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a>, <span class="keywordtype">size_t</span> total){</div>
<div class="line">  <span class="comment">//Handle body</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> onUpload(<a class="code hl_class" href="class_async_web_server_request.html">AsyncWebServerRequest</a> *request, String filename, <span class="keywordtype">size_t</span> <a class="code hl_variable" href="c_j_s_o_n_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a>, uint8_t *data, <span class="keywordtype">size_t</span> len, <span class="keywordtype">bool</span> <span class="keyword">final</span>){</div>
<div class="line">  <span class="comment">//Handle upload</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> onEvent(<a class="code hl_class" href="class_async_web_socket.html">AsyncWebSocket</a> * server, <a class="code hl_class" href="class_async_web_socket_client.html">AsyncWebSocketClient</a> * client, <a class="code hl_enumeration" href="_async_web_socket_8h.html#a3c33b5e64d6635e10f74e3577e642293">AwsEventType</a> type, <span class="keywordtype">void</span> * arg, uint8_t *data, <span class="keywordtype">size_t</span> len){</div>
<div class="line">  <span class="comment">//Handle WebSocket event</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> setup(){</div>
<div class="line">  Serial.begin(115200);</div>
<div class="line">  WiFi.mode(WIFI_STA);</div>
<div class="line">  WiFi.begin(ssid, password);</div>
<div class="line">  <span class="keywordflow">if</span> (WiFi.waitForConnectResult() != WL_CONNECTED) {</div>
<div class="line">    Serial.printf(<span class="stringliteral">&quot;WiFi Failed!\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// attach AsyncWebSocket</span></div>
<div class="line">  ws.onEvent(onEvent);</div>
<div class="line">  server.addHandler(&amp;ws);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// attach AsyncEventSource</span></div>
<div class="line">  server.addHandler(&amp;events);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// respond to GET requests on URL /heap</span></div>
<div class="line">  server.on(<span class="stringliteral">&quot;/heap&quot;</span>, <a class="code hl_enumvalue" href="_e_s_p_async_web_server_8h.html#afe35bd25c64a2d979ca5070a1578194aa4ad23c3d2f21f7502ba058ef89518166">HTTP_GET</a>, [](<a class="code hl_class" href="class_async_web_server_request.html">AsyncWebServerRequest</a> *request){</div>
<div class="line">    request-&gt;<a class="code hl_function" href="class_async_web_server_request.html#a4247e73eb8d8c7b386f9bb4ab10f3856">send</a>(200, <span class="stringliteral">&quot;text/plain&quot;</span>, String(ESP.getFreeHeap()));</div>
<div class="line">  });</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// upload a file to /upload</span></div>
<div class="line">  server.on(<span class="stringliteral">&quot;/upload&quot;</span>, <a class="code hl_enumvalue" href="_e_s_p_async_web_server_8h.html#afe35bd25c64a2d979ca5070a1578194aaa763023b51da2b3618f24cbf994b34bf">HTTP_POST</a>, [](<a class="code hl_class" href="class_async_web_server_request.html">AsyncWebServerRequest</a> *request){</div>
<div class="line">    request-&gt;<a class="code hl_function" href="class_async_web_server_request.html#a4247e73eb8d8c7b386f9bb4ab10f3856">send</a>(200);</div>
<div class="line">  }, onUpload);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// send a file when /index is requested</span></div>
<div class="line">  server.on(<span class="stringliteral">&quot;/index&quot;</span>, <a class="code hl_enumvalue" href="_e_s_p_async_web_server_8h.html#afe35bd25c64a2d979ca5070a1578194aa32498970693fbd48d717a129eca87df7">HTTP_ANY</a>, [](<a class="code hl_class" href="class_async_web_server_request.html">AsyncWebServerRequest</a> *request){</div>
<div class="line">    request-&gt;<a class="code hl_function" href="class_async_web_server_request.html#a4247e73eb8d8c7b386f9bb4ab10f3856">send</a>(SPIFFS, <span class="stringliteral">&quot;/index.htm&quot;</span>);</div>
<div class="line">  });</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// HTTP basic authentication</span></div>
<div class="line">  server.on(<span class="stringliteral">&quot;/login&quot;</span>, <a class="code hl_enumvalue" href="_e_s_p_async_web_server_8h.html#afe35bd25c64a2d979ca5070a1578194aa4ad23c3d2f21f7502ba058ef89518166">HTTP_GET</a>, [](<a class="code hl_class" href="class_async_web_server_request.html">AsyncWebServerRequest</a> *request){</div>
<div class="line">    <span class="keywordflow">if</span>(!request-&gt;<a class="code hl_function" href="class_async_web_server_request.html#a7dcd942309c563d42e3613d62d4a9006">authenticate</a>(http_username, http_password))</div>
<div class="line">        <span class="keywordflow">return</span> request-&gt;<a class="code hl_function" href="class_async_web_server_request.html#a03ef5c898b5bf81a5ade789b9f6d8f49">requestAuthentication</a>();</div>
<div class="line">    request-&gt;<a class="code hl_function" href="class_async_web_server_request.html#a4247e73eb8d8c7b386f9bb4ab10f3856">send</a>(200, <span class="stringliteral">&quot;text/plain&quot;</span>, <span class="stringliteral">&quot;Login Success!&quot;</span>);</div>
<div class="line">  });</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Simple Firmware Update Form</span></div>
<div class="line">  server.on(<span class="stringliteral">&quot;/update&quot;</span>, <a class="code hl_enumvalue" href="_e_s_p_async_web_server_8h.html#afe35bd25c64a2d979ca5070a1578194aa4ad23c3d2f21f7502ba058ef89518166">HTTP_GET</a>, [](<a class="code hl_class" href="class_async_web_server_request.html">AsyncWebServerRequest</a> *request){</div>
<div class="line">    request-&gt;<a class="code hl_function" href="class_async_web_server_request.html#a4247e73eb8d8c7b386f9bb4ab10f3856">send</a>(200, <span class="stringliteral">&quot;text/html&quot;</span>, <span class="stringliteral">&quot;&lt;form method=&#39;POST&#39; action=&#39;/update&#39; enctype=&#39;multipart/form-data&#39;&gt;&lt;input type=&#39;file&#39; name=&#39;update&#39;&gt;&lt;input type=&#39;submit&#39; value=&#39;Update&#39;&gt;&lt;/form&gt;&quot;</span>);</div>
<div class="line">  });</div>
<div class="line">  server.on(<span class="stringliteral">&quot;/update&quot;</span>, <a class="code hl_enumvalue" href="_e_s_p_async_web_server_8h.html#afe35bd25c64a2d979ca5070a1578194aaa763023b51da2b3618f24cbf994b34bf">HTTP_POST</a>, [](<a class="code hl_class" href="class_async_web_server_request.html">AsyncWebServerRequest</a> *request){</div>
<div class="line">    shouldReboot = !Update.hasError();</div>
<div class="line">    <a class="code hl_class" href="class_async_web_server_response.html">AsyncWebServerResponse</a> *response = request-&gt;<a class="code hl_function" href="class_async_web_server_request.html#a133a829c7bc4c486ed41f3476666ea51">beginResponse</a>(200, <span class="stringliteral">&quot;text/plain&quot;</span>, shouldReboot?<span class="stringliteral">&quot;OK&quot;</span>:<span class="stringliteral">&quot;FAIL&quot;</span>);</div>
<div class="line">    response-&gt;<a class="code hl_function" href="class_async_web_server_response.html#a56c370dbf9c75c17cb3cd8d22239205a">addHeader</a>(<span class="stringliteral">&quot;Connection&quot;</span>, <span class="stringliteral">&quot;close&quot;</span>);</div>
<div class="line">    request-&gt;<a class="code hl_function" href="class_async_web_server_request.html#a4247e73eb8d8c7b386f9bb4ab10f3856">send</a>(response);</div>
<div class="line">  },[](<a class="code hl_class" href="class_async_web_server_request.html">AsyncWebServerRequest</a> *request, String filename, <span class="keywordtype">size_t</span> <a class="code hl_variable" href="c_j_s_o_n_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a>, uint8_t *data, <span class="keywordtype">size_t</span> len, <span class="keywordtype">bool</span> <span class="keyword">final</span>){</div>
<div class="line">    <span class="keywordflow">if</span>(!<a class="code hl_variable" href="c_j_s_o_n_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a>){</div>
<div class="line">      Serial.printf(<span class="stringliteral">&quot;Update Start: %s\n&quot;</span>, filename.c_str());</div>
<div class="line">      Update.runAsync(<span class="keyword">true</span>);</div>
<div class="line">      <span class="keywordflow">if</span>(!Update.begin((ESP.getFreeSketchSpace() - 0x1000) &amp; 0xFFFFF000)){</div>
<div class="line">        Update.printError(Serial);</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span>(!Update.hasError()){</div>
<div class="line">      <span class="keywordflow">if</span>(Update.write(data, len) != len){</div>
<div class="line">        Update.printError(Serial);</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span>(<span class="keyword">final</span>){</div>
<div class="line">      <span class="keywordflow">if</span>(Update.end(<span class="keyword">true</span>)){</div>
<div class="line">        Serial.printf(<span class="stringliteral">&quot;Update Success: %uB\n&quot;</span>, <a class="code hl_variable" href="c_j_s_o_n_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a>+len);</div>
<div class="line">      } <span class="keywordflow">else</span> {</div>
<div class="line">        Update.printError(Serial);</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">  });</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// attach filesystem root at URL /fs</span></div>
<div class="line">  server.serveStatic(<span class="stringliteral">&quot;/fs&quot;</span>, SPIFFS, <span class="stringliteral">&quot;/&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Catch-All Handlers</span></div>
<div class="line">  <span class="comment">// Any request that can not find a Handler that canHandle it</span></div>
<div class="line">  <span class="comment">// ends in the callbacks below.</span></div>
<div class="line">  server.onNotFound(onRequest);</div>
<div class="line">  server.onFileUpload(onUpload);</div>
<div class="line">  server.onRequestBody(onBody);</div>
<div class="line"> </div>
<div class="line">  server.begin();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> loop(){</div>
<div class="line">  <span class="keywordflow">if</span>(shouldReboot){</div>
<div class="line">    Serial.println(<span class="stringliteral">&quot;Rebooting...&quot;</span>);</div>
<div class="line">    delay(100);</div>
<div class="line">    ESP.restart();</div>
<div class="line">  }</div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">char</span> temp[128];</div>
<div class="line">  sprintf(temp, <span class="stringliteral">&quot;Seconds since boot: %u&quot;</span>, millis()/1000);</div>
<div class="line">  events.send(temp, <span class="stringliteral">&quot;time&quot;</span>); <span class="comment">//send event &quot;time&quot;</span></div>
<div class="line">}</div>
<div class="ttc" id="a_e_s_p_async_web_server_8h_html"><div class="ttname"><a href="_e_s_p_async_web_server_8h.html">ESPAsyncWebServer.h</a></div></div>
<div class="ttc" id="a_e_s_p_async_web_server_8h_html_afe35bd25c64a2d979ca5070a1578194aa32498970693fbd48d717a129eca87df7"><div class="ttname"><a href="_e_s_p_async_web_server_8h.html#afe35bd25c64a2d979ca5070a1578194aa32498970693fbd48d717a129eca87df7">HTTP_ANY</a></div><div class="ttdeci">@ HTTP_ANY</div><div class="ttdef"><b>Definition</b> <a href="_e_s_p_async_web_server_8h_source.html#l00069">ESPAsyncWebServer.h:69</a></div></div>
<div class="ttc" id="a_e_s_p_async_web_server_8h_html_afe35bd25c64a2d979ca5070a1578194aaa763023b51da2b3618f24cbf994b34bf"><div class="ttname"><a href="_e_s_p_async_web_server_8h.html#afe35bd25c64a2d979ca5070a1578194aaa763023b51da2b3618f24cbf994b34bf">HTTP_POST</a></div><div class="ttdeci">@ HTTP_POST</div><div class="ttdef"><b>Definition</b> <a href="_e_s_p_async_web_server_8h_source.html#l00063">ESPAsyncWebServer.h:63</a></div></div>
<div class="ttc" id="aclass_async_web_server_request_html_a03ef5c898b5bf81a5ade789b9f6d8f49"><div class="ttname"><a href="class_async_web_server_request.html#a03ef5c898b5bf81a5ade789b9f6d8f49">AsyncWebServerRequest::requestAuthentication</a></div><div class="ttdeci">void requestAuthentication(const char *realm=NULL, bool isDigest=true)</div><div class="ttdef"><b>Definition</b> <a href="_web_request_8cpp_source.html#l00847">WebRequest.cpp:847</a></div></div>
<div class="ttc" id="aclass_async_web_server_request_html_a7dcd942309c563d42e3613d62d4a9006"><div class="ttname"><a href="class_async_web_server_request.html#a7dcd942309c563d42e3613d62d4a9006">AsyncWebServerRequest::authenticate</a></div><div class="ttdeci">bool authenticate(const char *hash)</div><div class="ttdef"><b>Definition</b> <a href="_web_request_8cpp_source.html#l00825">WebRequest.cpp:825</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md77"></a>
Setup global and class functions as request handlers</h2>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;Arduino.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="_e_s_p_async_web_server_8h.html">ESPAsyncWebserver.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;Hash.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;functional&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> handleRequest(<a class="code hl_class" href="class_async_web_server_request.html">AsyncWebServerRequest</a> *request){}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>WebClass {</div>
<div class="line">public :</div>
<div class="line">  <a class="code hl_class" href="class_async_web_server.html">AsyncWebServer</a> classWebServer = <a class="code hl_class" href="class_async_web_server.html">AsyncWebServer</a>(81);</div>
<div class="line"> </div>
<div class="line">  WebClass(){};</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> classRequest (<a class="code hl_class" href="class_async_web_server_request.html">AsyncWebServerRequest</a> *request){}</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> begin(){</div>
<div class="line">    <span class="comment">// attach global request handler</span></div>
<div class="line">    classWebServer.<a class="code hl_function" href="class_async_web_server.html#a210bd0ab1f056f8f081c46e4827aaab7">on</a>(<span class="stringliteral">&quot;/example&quot;</span>, <a class="code hl_enumvalue" href="_e_s_p_async_web_server_8h.html#afe35bd25c64a2d979ca5070a1578194aa32498970693fbd48d717a129eca87df7">HTTP_ANY</a>, handleRequest);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// attach class request handler</span></div>
<div class="line">    classWebServer.<a class="code hl_function" href="class_async_web_server.html#a210bd0ab1f056f8f081c46e4827aaab7">on</a>(<span class="stringliteral">&quot;/example&quot;</span>, <a class="code hl_enumvalue" href="_e_s_p_async_web_server_8h.html#afe35bd25c64a2d979ca5070a1578194aa32498970693fbd48d717a129eca87df7">HTTP_ANY</a>, std::bind(&amp;WebClass::classRequest, <span class="keyword">this</span>, std::placeholders::_1));</div>
<div class="line">  }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><a class="code hl_class" href="class_async_web_server.html">AsyncWebServer</a> globalWebServer(80);</div>
<div class="line">WebClass webClassInstance;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> setup() {</div>
<div class="line">  <span class="comment">// attach global request handler</span></div>
<div class="line">  globalWebServer.on(<span class="stringliteral">&quot;/example&quot;</span>, <a class="code hl_enumvalue" href="_e_s_p_async_web_server_8h.html#afe35bd25c64a2d979ca5070a1578194aa32498970693fbd48d717a129eca87df7">HTTP_ANY</a>, handleRequest);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// attach class request handler</span></div>
<div class="line">  globalWebServer.on(<span class="stringliteral">&quot;/example&quot;</span>, <a class="code hl_enumvalue" href="_e_s_p_async_web_server_8h.html#afe35bd25c64a2d979ca5070a1578194aa32498970693fbd48d717a129eca87df7">HTTP_ANY</a>, std::bind(&amp;WebClass::classRequest, webClassInstance, std::placeholders::_1));</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> loop() {</div>
<div class="line"> </div>
<div class="line">}</div>
<div class="ttc" id="aclass_async_web_server_html_a210bd0ab1f056f8f081c46e4827aaab7"><div class="ttname"><a href="class_async_web_server.html#a210bd0ab1f056f8f081c46e4827aaab7">AsyncWebServer::on</a></div><div class="ttdeci">AsyncCallbackWebHandler &amp; on(const char *uri, ArRequestHandlerFunction onRequest)</div><div class="ttdef"><b>Definition</b> <a href="_web_server_8cpp_source.html#l00157">WebServer.cpp:157</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md78"></a>
Methods for controlling websocket connections</h2>
<div class="fragment"><div class="line"><span class="comment">// Disable client connections if it was activated</span></div>
<div class="line"><span class="keywordflow">if</span> ( ws.enabled() )</div>
<div class="line">  ws.enable(<span class="keyword">false</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// enable client connections if it was disabled</span></div>
<div class="line"><span class="keywordflow">if</span> ( !ws.enabled() )</div>
<div class="line">  ws.enable(<span class="keyword">true</span>);</div>
</div><!-- fragment --><p>Example of OTA code</p>
<div class="fragment"><div class="line"><span class="comment">// OTA callbacks</span></div>
<div class="line">ArduinoOTA.onStart([]() {</div>
<div class="line">  <span class="comment">// Clean SPIFFS</span></div>
<div class="line">  SPIFFS.end();</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Disable client connections    </span></div>
<div class="line">  ws.enable(<span class="keyword">false</span>);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Advertise connected clients what&#39;s going on</span></div>
<div class="line">  ws.textAll(<span class="stringliteral">&quot;OTA Update Started&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Close them</span></div>
<div class="line">  ws.closeAll();</div>
<div class="line"> </div>
<div class="line">});</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md79"></a>
Adding Default Headers</h2>
<p>In some cases, such as when working with CORS, or with some sort of custom authentication system, you might need to define a header that should get added to all responses (including static, websocket and EventSource). The <a class="el" href="class_default_headers.html">DefaultHeaders</a> singleton allows you to do this.</p>
<p>Example:</p>
<div class="fragment"><div class="line"><a class="code hl_function" href="class_default_headers.html#a5cb5d4588e9afac7fba365d801009902">DefaultHeaders::Instance</a>().<a class="code hl_function" href="class_default_headers.html#aba00ce0465837ccb3e3f56c450ddb231">addHeader</a>(<span class="stringliteral">&quot;Access-Control-Allow-Origin&quot;</span>, <span class="stringliteral">&quot;*&quot;</span>);</div>
<div class="line">webServer.begin();</div>
<div class="ttc" id="aclass_default_headers_html_a5cb5d4588e9afac7fba365d801009902"><div class="ttname"><a href="class_default_headers.html#a5cb5d4588e9afac7fba365d801009902">DefaultHeaders::Instance</a></div><div class="ttdeci">static DefaultHeaders &amp; Instance()</div><div class="ttdef"><b>Definition</b> <a href="_e_s_p_async_web_server_8h_source.html#l00460">ESPAsyncWebServer.h:460</a></div></div>
<div class="ttc" id="aclass_default_headers_html_aba00ce0465837ccb3e3f56c450ddb231"><div class="ttname"><a href="class_default_headers.html#aba00ce0465837ccb3e3f56c450ddb231">DefaultHeaders::addHeader</a></div><div class="ttdeci">void addHeader(const String &amp;name, const String &amp;value)</div><div class="ttdef"><b>Definition</b> <a href="_e_s_p_async_web_server_8h_source.html#l00451">ESPAsyncWebServer.h:451</a></div></div>
</div><!-- fragment --><p><em>NOTE</em>: You will still need to respond to the OPTIONS method for CORS pre-flight in most cases. (unless you are only using GET)</p>
<p>This is one option:</p>
<div class="fragment"><div class="line">webServer.onNotFound([](<a class="code hl_class" href="class_async_web_server_request.html">AsyncWebServerRequest</a> *request) {</div>
<div class="line">  <span class="keywordflow">if</span> (request-&gt;<a class="code hl_function" href="class_async_web_server_request.html#acdaaab2f8779034df58920577e46bff1">method</a>() == <a class="code hl_enumvalue" href="_e_s_p_async_web_server_8h.html#afe35bd25c64a2d979ca5070a1578194aa86aa5540a666a38528d28bd7591cb251">HTTP_OPTIONS</a>) {</div>
<div class="line">    request-&gt;send(200);</div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    request-&gt;send(404);</div>
<div class="line">  }</div>
<div class="line">});</div>
<div class="ttc" id="a_e_s_p_async_web_server_8h_html_afe35bd25c64a2d979ca5070a1578194aa86aa5540a666a38528d28bd7591cb251"><div class="ttname"><a href="_e_s_p_async_web_server_8h.html#afe35bd25c64a2d979ca5070a1578194aa86aa5540a666a38528d28bd7591cb251">HTTP_OPTIONS</a></div><div class="ttdeci">@ HTTP_OPTIONS</div><div class="ttdef"><b>Definition</b> <a href="_e_s_p_async_web_server_8h_source.html#l00068">ESPAsyncWebServer.h:68</a></div></div>
<div class="ttc" id="aclass_async_web_server_request_html_acdaaab2f8779034df58920577e46bff1"><div class="ttname"><a href="class_async_web_server_request.html#acdaaab2f8779034df58920577e46bff1">AsyncWebServerRequest::method</a></div><div class="ttdeci">WebRequestMethodComposite method() const</div><div class="ttdef"><b>Definition</b> <a href="_e_s_p_async_web_server_8h_source.html#l00212">ESPAsyncWebServer.h:212</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md80"></a>
Path variable</h2>
<p>With path variable you can create a custom regex rule for a specific parameter in a route. For example we want a <code>sensorId</code> parameter in a route rule to match only a integer.</p>
<div class="fragment"><div class="line">server.on(<span class="stringliteral">&quot;^\\/sensor\\/([0-9]+)$&quot;</span>, <a class="code hl_enumvalue" href="_e_s_p_async_web_server_8h.html#afe35bd25c64a2d979ca5070a1578194aa4ad23c3d2f21f7502ba058ef89518166">HTTP_GET</a>, [] (<a class="code hl_class" href="class_async_web_server_request.html">AsyncWebServerRequest</a> *request) {</div>
<div class="line">    String sensorId = request-&gt;<a class="code hl_function" href="class_async_web_server_request.html#a2879b70810d171704187bad79789c09a">pathArg</a>(0);</div>
<div class="line">});</div>
<div class="ttc" id="aclass_async_web_server_request_html_a2879b70810d171704187bad79789c09a"><div class="ttname"><a href="class_async_web_server_request.html#a2879b70810d171704187bad79789c09a">AsyncWebServerRequest::pathArg</a></div><div class="ttdeci">const String &amp;ASYNCWEBSERVER_REGEX_ATTRIBUTE pathArg(size_t i) const</div><div class="ttdef"><b>Definition</b> <a href="_web_request_8cpp_source.html#l00920">WebRequest.cpp:920</a></div></div>
</div><!-- fragment --><p> <em>NOTE</em>: All regex patterns starts with <code>^</code> and ends with <code>$</code></p>
<p>To enable the <code>Path variable</code> support, you have to define the buildflag <code>-DASYNCWEBSERVER_REGEX</code>.</p>
<p>For Arduino IDE create/update <code>platform.local.txt</code>:</p>
<p><code>Windows</code>: C:\Users(username)\AppData\Local\Arduino15\packages\<code>{espxxxx}</code>\hardware\<code>espxxxx</code>\<code>{version}</code>\platform.local.txt</p>
<p><code>Linux</code>: ~/.arduino15/packages/<code>{espxxxx}</code>/hardware/<code>{espxxxx}</code>/<code>{version}</code>/platform.local.txt</p>
<p>Add/Update the following line: </p><div class="fragment"><div class="line">compiler.cpp.extra_flags=-DDASYNCWEBSERVER_REGEX</div>
</div><!-- fragment --><p>For platformio modify <code>platformio.ini</code>: </p><div class="fragment"><div class="line">[env:myboard]</div>
<div class="line">build_flags = </div>
<div class="line">  -DASYNCWEBSERVER_REGEX</div>
</div><!-- fragment --><p> <em>NOTE</em>: By enabling <code>ASYNCWEBSERVER_REGEX</code>, <code>&lt;regex&gt;</code> will be included. This will add an 100k to your binary. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.7 </li>
  </ul>
</div>
</body>
</html>
